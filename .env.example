# =============================================================================
# SQL-Databricks Bridge - Configuración de Variables de Entorno
# =============================================================================
#
# INSTRUCCIONES:
# 1. Copia este archivo a .env: cp .env.example .env
# 2. Edita .env con tus credenciales reales
# 3. NUNCA subas el archivo .env a git (ya está en .gitignore)
#
# ALTERNATIVA: Puedes exportar estas variables en ~/.bashrc o ~/.zshrc
# en lugar de usar el archivo .env
# =============================================================================

# =============================================================================
# CONFIGURACIÓN DEL SERVICIO
# =============================================================================
ENVIRONMENT=development
DEBUG=true
LOG_LEVEL=INFO
API_HOST=0.0.0.0
API_PORT=8000

# =============================================================================
# SQL SERVER - Conexión a base de datos origen
# =============================================================================
# NOTA: Estas variables son OPCIONALES si usas kantar_db_handler.
# 
# CONFIGURACIÓN MULTI-PAÍS CON kantar_db_handler:
# Si tienes kantar_db_handler instalado, el servidor y base de datos se
# seleccionan automáticamente según el país especificado en cada request.
# Las siguientes variables solo se usan como fallback si no se especifica país.
#
# CONFIGURACIÓN MANUAL (sin kantar_db_handler):
# Si no tienes kantar_db_handler, debes configurar estas variables para
# conectarte a UN servidor específico (no funcionará con múltiples países).

# Host del servidor (Azure SQL, SQL Server on-prem, etc.)
SQLSERVER_HOST=tu-servidor.database.windows.net

# Puerto (por defecto 1433)
SQLSERVER_PORT=1433

# Nombre de la base de datos
SQLSERVER_DATABASE=tu_base_de_datos

# Credenciales
SQLSERVER_USERNAME=tu_usuario
SQLSERVER_PASSWORD=tu_contraseña

# Driver ODBC (instalar si no está disponible)
# Linux: sudo apt-get install msodbcsql18
# Mac: brew install microsoft/mssql-release/msodbcsql18
SQLSERVER_DRIVER=ODBC Driver 18 for SQL Server

# Confiar en certificado del servidor (true para desarrollo)
SQLSERVER_TRUST_CERT=true

# =============================================================================
# DATABRICKS - Conexión al workspace
# =============================================================================

# URL del workspace (sin trailing slash)
# Ejemplo: https://adb-1234567890123456.7.azuredatabricks.net
DATABRICKS_HOST=https://tu-workspace.azuredatabricks.net

# ------------------------------------------------------------------------------
# AUTENTICACIÓN - Elige UNA de las siguientes opciones:
# ------------------------------------------------------------------------------

# OPCIÓN 1: Token de Acceso Personal (PAT) - Más simple para desarrollo
# Crear en: Databricks → User Settings → Developer → Access Tokens
DATABRICKS_TOKEN=dapi1234567890abcdef1234567890abcdef

# OPCIÓN 2: Service Principal - Recomendado para producción
# Crear en Azure AD → App Registrations → New Registration
# DATABRICKS_CLIENT_ID=tu-client-id-uuid
# DATABRICKS_CLIENT_SECRET=tu-client-secret

# ------------------------------------------------------------------------------
# SQL WAREHOUSE - Requerido para ejecutar queries
# ------------------------------------------------------------------------------
# Obtener en: Databricks → SQL Warehouses → Tu Warehouse → Connection Details
# El ID está en HTTP Path: /sql/1.0/warehouses/ESTE_ES_EL_ID
DATABRICKS_WAREHOUSE_ID=abc123def456

# ------------------------------------------------------------------------------
# UNITY CATALOG - Configuración de catálogo y volumen
# ------------------------------------------------------------------------------
# Catálogo donde se almacenarán los datos
DATABRICKS_CATALOG=mi_catalogo

# Schema dentro del catálogo
DATABRICKS_SCHEMA=mi_schema

# Volume para almacenar archivos Parquet
DATABRICKS_VOLUME=mi_volume

# =============================================================================
# SINCRONIZACIÓN (Databricks → SQL Server)
# =============================================================================

# Intervalo de polling para eventos (segundos)
POLLING_INTERVAL_SECONDS=10

# Máximo de eventos por ciclo de polling
MAX_EVENTS_PER_POLL=100

# Tabla de eventos en Databricks
EVENTS_TABLE=bridge.events.bridge_events

# =============================================================================
# EXTRACCIÓN (SQL Server → Databricks)
# =============================================================================

# Filas por chunk durante extracción
EXTRACTION_CHUNK_SIZE=100000

# Reintentos en caso de error
MAX_RETRIES=3
RETRY_DELAY_SECONDS=5

# =============================================================================
# AUTENTICACIÓN Y PERMISOS
# =============================================================================

# Habilitar autenticación por token (false para desarrollo local)
AUTH_ENABLED=false

# Archivo de configuración de permisos
PERMISSIONS_FILE=config/permissions.yaml

# Recargar permisos automáticamente cuando cambia el archivo
PERMISSIONS_HOT_RELOAD=true
