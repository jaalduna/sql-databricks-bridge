import{r as as}from"./tanstack-CVTt_DyG.js";const cs="msal.js.common",Pi="https://login.microsoftonline.com/common/",hs="login.microsoftonline.com",Ni="common",ls="adfs",ds="dstsv2",us=`${Pi}discovery/instance?api-version=1.1&authorization_endpoint=`,Nr=".ciamlogin.com",gs=".onmicrosoft.com",dn="|",Mi="openid",Ui="profile",bn="offline_access",fs="email",Rn="S256",ps="application/x-www-form-urlencoded;charset=utf-8",Ze="Not Available",un="/",Mr="http://169.254.169.254/metadata/instance/compute/location",ms="2020-06-01",Cs=2e3,ys="TryAutoDetect",Is="login.microsoft.com",Ts=["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"],Ur=240,ws="invalid_instance",Dr=200,As=400,Lr=400,Es=499,Ss=500,_s=599,Fe={GET:"GET",POST:"POST"},Qe=[Mi,Ui,bn],xr=[...Qe,fs],H={CONTENT_TYPE:"Content-Type",CONTENT_LENGTH:"Content-Length",RETRY_AFTER:"Retry-After",CCS_HEADER:"X-AnchorMailbox",WWWAuthenticate:"WWW-Authenticate",AuthenticationInfo:"Authentication-Info",X_MS_REQUEST_ID:"x-ms-request-id",X_MS_HTTP_VERSION:"x-ms-httpver"},Hr={ACTIVE_ACCOUNT_FILTERS:"active-account-filters"},me={COMMON:"common",ORGANIZATIONS:"organizations",CONSUMERS:"consumers"},pt={ACCESS_TOKEN:"access_token",XMS_CC:"xms_cc"},F={LOGIN:"login",SELECT_ACCOUNT:"select_account",CONSENT:"consent",NONE:"none",NO_SESSION:"no_session"},On={CODE:"code",IDTOKEN_TOKEN_REFRESHTOKEN:"id_token token refresh_token"},Pn={QUERY:"query",FRAGMENT:"fragment"},Di={AUTHORIZATION_CODE_GRANT:"authorization_code",REFRESH_TOKEN_GRANT:"refresh_token"},vs="MSSTS",ks="ADFS",Li="Generic",xi="-",gn=".",N={ID_TOKEN:"IdToken",ACCESS_TOKEN:"AccessToken",ACCESS_TOKEN_WITH_AUTH_SCHEME:"AccessToken_With_AuthScheme",REFRESH_TOKEN:"RefreshToken"},Nn="appmetadata",bs="client_info",kt="1",fn="authority-metadata",Rs=3600*24,Y={CONFIG:"config",CACHE:"cache",NETWORK:"network",HARDCODED_VALUES:"hardcoded_values"},Kr=5,Os=330,Ps=50,Hi="server-telemetry",Fr="|",Le=",",Ns="1",Ms="0",Us="unknown_error",S={BEARER:"Bearer",POP:"pop",SSH:"ssh-cert"},Ds=60,Ls=3600,Ki="throttling",xs="retry-after, h429",Hs="invalid_grant",Ks="client_mismatch",xe={FAILED_AUTO_DETECTION:"1",INTERNAL_CACHE:"2",ENVIRONMENT_VARIABLE:"3",IMDS:"4"},nn={CONFIGURED_NO_AUTO_DETECTION:"2",AUTO_DETECTION_REQUESTED_SUCCESSFUL:"4",AUTO_DETECTION_REQUESTED_FAILED:"5"},we={NOT_APPLICABLE:"0",FORCE_REFRESH_OR_CLAIMS:"1",NO_CACHED_ACCESS_TOKEN:"2",CACHED_ACCESS_TOKEN_EXPIRED:"3",PROACTIVELY_REFRESHED:"4"},Fs={Pop:"pop"},Fi=300;const ve="client_id",Bi="redirect_uri",Bs="response_type",zs="response_mode",js="grant_type",Gs="claims",Vs="scope",$s="refresh_token",Js="state",Ws="nonce",Qs="prompt",Ys="code",Xs="code_challenge",qs="code_challenge_method",Zs="code_verifier",ea="client-request-id",ta="x-client-SKU",na="x-client-VER",ra="x-client-OS",ia="x-client-CPU",oa="x-client-current-telemetry",sa="x-client-last-telemetry",aa="x-ms-lib-capability",ca="x-app-name",ha="x-app-ver",la="post_logout_redirect_uri",da="id_token_hint",ua="client_secret",ga="client_assertion",fa="client_assertion_type",zi="token_type",ji="req_cnf",Br="return_spa_code",pa="nativebroker",ma="logout_hint",Ca="sid",ya="login_hint",Ia="domain_hint",Ta="x-client-xtra-sku",bt="brk_client_id",Rt="brk_redirect_uri",pn="instance_aware",wa="ear_jwk",Aa="ear_jwe_crypto";function Mn(i){return`See https://aka.ms/msal.js.errors#${i} for details`}class _ extends Error{constructor(e,t,n){const r=t||(e?Mn(e):""),o=r?`${e}: ${r}`:e;super(o),Object.setPrototypeOf(this,_.prototype),this.errorCode=e||"",this.errorMessage=r||"",this.subError=n||"",this.name="AuthError"}setCorrelationId(e){this.correlationId=e}}function mn(i,e){return new _(i,e||Mn(i))}class Un extends _{constructor(e){super(e),this.name="ClientConfigurationError",Object.setPrototypeOf(this,Un.prototype)}}function v(i){return new Un(i)}class W{static isEmptyObj(e){if(e)try{const t=JSON.parse(e);return Object.keys(t).length===0}catch{}return!0}static startsWith(e,t){return e.indexOf(t)===0}static endsWith(e,t){return e.length>=t.length&&e.lastIndexOf(t)===e.length-t.length}static queryStringToObject(e){const t={},n=e.split("&"),r=o=>decodeURIComponent(o.replace(/\+/g," "));return n.forEach(o=>{if(o.trim()){const[s,a]=o.split(/=(.+)/g,2);s&&a&&(t[r(s)]=r(a))}}),t}static trimArrayEntries(e){return e.map(t=>t.trim())}static removeEmptyStringsFromArray(e){return e.filter(t=>!!t)}static jsonParseHelper(e){try{return JSON.parse(e)}catch{return null}}static matchPattern(e,t){return new RegExp(e.replace(/\\/g,"\\\\").replace(/\*/g,"[^ ]*").replace(/\?/g,"\\?")).test(t)}}class Dn extends _{constructor(e,t){super(e,t),this.name="ClientAuthError",Object.setPrototypeOf(this,Dn.prototype)}}function f(i,e){return new Dn(i,e)}const Ea="redirect_uri_empty",Sa="authority_uri_insecure",mt="url_parse_error",_a="empty_url_error",va="empty_input_scopes_error",Gi="invalid_claims",ka="token_request_empty",ba="logout_request_empty",Vi="pkce_params_missing",$i="invalid_cloud_discovery_metadata",Ra="invalid_authority_metadata",Oa="untrusted_authority",Ln="missing_ssh_jwk",Pa="missing_ssh_kid",Na="cannot_set_OIDCOptions",Ma="cannot_allow_platform_broker",Ua="authority_mismatch",Da="invalid_request_method_for_EAR";const Ji="client_info_decoding_error",La="client_info_empty_error",Wi="token_parsing_error",xa="null_or_empty_token",de="endpoints_resolution_error",Ha="network_error",Ka="openid_config_error",Fa="hash_not_deserialized",st="invalid_state",Ba="state_mismatch",zr="state_not_found",za="nonce_mismatch",Qi="auth_time_not_found",ja="max_age_transpired",Ga="multiple_matching_appMetadata",Va="request_cannot_be_made",$a="cannot_remove_empty_scope",Ja="cannot_append_scopeset",jr="empty_input_scopeset",Yi="no_account_in_silent_request",Wa="invalid_cache_record",Xi="invalid_cache_environment",Gr="no_account_found",qi="no_crypto_object",Ee="token_refresh_required",Qa="token_claims_cnf_required_for_signedjwt",Ya="authorization_code_missing_from_server_response",Xa="binding_key_not_removed",qa="end_session_endpoint_not_supported",Zi="key_id_missing",T="method_not_implemented";class D{constructor(e){const t=e?W.trimArrayEntries([...e]):[],n=t?W.removeEmptyStringsFromArray(t):[];if(!n||!n.length)throw v(va);this.scopes=new Set,n.forEach(r=>this.scopes.add(r))}static fromString(e){const n=(e||"").split(" ");return new D(n)}static createSearchScopes(e){const t=e&&e.length>0?e:[...Qe],n=new D(t);return n.containsOnlyOIDCScopes()?n.removeScope(bn):n.removeOIDCScopes(),n}containsScope(e){const t=this.printScopesLowerCase().split(" "),n=new D(t);return e?n.scopes.has(e.toLowerCase()):!1}containsScopeSet(e){return!e||e.scopes.size<=0?!1:this.scopes.size>=e.scopes.size&&e.asArray().every(t=>this.containsScope(t))}containsOnlyOIDCScopes(){let e=0;return xr.forEach(t=>{this.containsScope(t)&&(e+=1)}),this.scopes.size===e}appendScope(e){e&&this.scopes.add(e.trim())}appendScopes(e){try{e.forEach(t=>this.appendScope(t))}catch{throw f(Ja)}}removeScope(e){if(!e)throw f($a);this.scopes.delete(e.trim())}removeOIDCScopes(){xr.forEach(e=>{this.scopes.delete(e)})}unionScopeSets(e){if(!e)throw f(jr);const t=new Set;return e.scopes.forEach(n=>t.add(n.toLowerCase())),this.scopes.forEach(n=>t.add(n.toLowerCase())),t}intersectingScopeSets(e){if(!e)throw f(jr);e.containsOnlyOIDCScopes()||e.removeOIDCScopes();const t=this.unionScopeSets(e),n=e.getScopeCount(),r=this.getScopeCount();return t.size<r+n}getScopeCount(){return this.scopes.size}asArray(){const e=[];return this.scopes.forEach(t=>e.push(t)),e}printScopes(){return this.scopes?this.asArray().join(" "):""}printScopesLowerCase(){return this.printScopes().toLowerCase()}}function jt(i,e,t){if(!e)return;const n=i.get(ve);n&&i.has(bt)&&t?.addFields({embeddedClientId:n,embeddedRedirectUri:i.get(Bi)},e)}function xn(i,e){i.set(Bs,e)}function Za(i,e){i.set(zs,e||Pn.QUERY)}function ec(i){i.set(pa,"1")}function Hn(i,e,t=!0,n=Qe){t&&!n.includes("openid")&&!e.includes("openid")&&n.push("openid");const r=t?[...e||[],...n]:e||[],o=new D(r);i.set(Vs,o.printScopes())}function Kn(i,e){i.set(ve,e)}function Fn(i,e){i.set(Bi,e)}function tc(i,e){i.set(la,e)}function nc(i,e){i.set(da,e)}function rc(i,e){i.set(Ia,e)}function Ct(i,e){i.set(ya,e)}function Ot(i,e){i.set(H.CCS_HEADER,`UPN:${e}`)}function rt(i,e){i.set(H.CCS_HEADER,`Oid:${e.uid}@${e.utid}`)}function Vr(i,e){i.set(Ca,e)}function Bn(i,e,t){const n=hc(e,t);try{JSON.parse(n)}catch{throw v(Gi)}i.set(Gs,n)}function zn(i,e){i.set(ea,e)}function jn(i,e){i.set(ta,e.sku),i.set(na,e.version),e.os&&i.set(ra,e.os),e.cpu&&i.set(ia,e.cpu)}function Gn(i,e){e?.appName&&i.set(ca,e.appName),e?.appVersion&&i.set(ha,e.appVersion)}function ic(i,e){i.set(Qs,e)}function eo(i,e){e&&i.set(Js,e)}function oc(i,e){i.set(Ws,e)}function Vn(i,e,t){if(e&&t)i.set(Xs,e),i.set(qs,t);else throw v(Vi)}function sc(i,e){i.set(Ys,e)}function ac(i,e){i.set($s,e)}function cc(i,e){i.set(Zs,e)}function to(i,e){i.set(ua,e)}function no(i,e){e&&i.set(ga,e)}function ro(i,e){e&&i.set(fa,e)}function io(i,e){i.set(js,e)}function $n(i){i.set(bs,"1")}function oo(i){i.has(pn)||i.set(pn,"true")}function se(i,e){Object.entries(e).forEach(([t,n])=>{!i.has(t)&&n&&i.set(t,n)})}function hc(i,e){let t;if(!i)t={};else try{t=JSON.parse(i)}catch{throw v(Gi)}return e&&e.length>0&&(t.hasOwnProperty(pt.ACCESS_TOKEN)||(t[pt.ACCESS_TOKEN]={}),t[pt.ACCESS_TOKEN][pt.XMS_CC]={values:e}),JSON.stringify(t)}function Jn(i,e){e&&(i.set(zi,S.POP),i.set(ji,e))}function so(i,e){e&&(i.set(zi,S.SSH),i.set(ji,e))}function ao(i,e){i.set(oa,e.generateCurrentRequestHeaderValue()),i.set(sa,e.generateLastRequestHeaderValue())}function co(i){i.set(aa,xs)}function lc(i,e){i.set(ma,e)}function Gt(i,e,t){i.has(bt)||i.set(bt,e),i.has(Rt)||i.set(Rt,t)}function dc(i,e){i.set(wa,encodeURIComponent(e)),i.set(Aa,"eyJhbGciOiJkaXIiLCJlbmMiOiJBMjU2R0NNIn0")}function $r(i){if(!i)return i;let e=i.toLowerCase();return W.endsWith(e,"?")?e=e.slice(0,-1):W.endsWith(e,"?/")&&(e=e.slice(0,-2)),W.endsWith(e,"/")||(e+="/"),e}function ho(i){return i.startsWith("#/")?i.substring(2):i.startsWith("#")||i.startsWith("?")?i.substring(1):i}function Pt(i){if(!i||i.indexOf("=")<0)return null;try{const e=ho(i),t=Object.fromEntries(new URLSearchParams(e));if(t.code||t.ear_jwe||t.error||t.error_description||t.state)return t}catch{throw f(Fa)}return null}function at(i){const e=new Array;return i.forEach((t,n)=>{e.push(`${n}=${encodeURIComponent(t)}`)}),e.join("&")}function Jr(i){if(!i)return i;const e=i.split("#")[0];try{const t=new URL(e),n=t.origin+t.pathname+t.search;return $r(n)}catch{return $r(e)}}const Nt={createNewGuid:()=>{throw f(T)},base64Decode:()=>{throw f(T)},base64Encode:()=>{throw f(T)},base64UrlEncode:()=>{throw f(T)},encodeKid:()=>{throw f(T)},async getPublicKeyThumbprint(){throw f(T)},async removeTokenBindingKey(){throw f(T)},async clearKeystore(){throw f(T)},async signJwt(){throw f(T)},async hashString(){throw f(T)}};var k;(function(i){i[i.Error=0]="Error",i[i.Warning=1]="Warning",i[i.Info=2]="Info",i[i.Verbose=3]="Verbose",i[i.Trace=4]="Trace"})(k||(k={}));const uc=50,gc=500,Ae=new Map;function fc(i,e){Ae.delete(i),Ae.set(i,e)}function pc(i,e){const t=Date.now();let n=Ae.get(i);if(n)fc(i,n);else if(n={logs:[],firstEventTime:t},Ae.set(i,n),Ae.size>uc){const r=Ae.keys().next().value;r&&Ae.delete(r)}n.logs.push({...e,milliseconds:t-n.firstEventTime}),n.logs.length>gc&&n.logs.shift()}function mc(i){if(i.length!==6)return!1;for(let e=0;e<i.length;e++){const t=i[e];if(!(t>="a"&&t<="z"||t>="A"&&t<="Z"||t>="0"&&t<="9"))return!1}return!0}class te{constructor(e,t,n){this.level=k.Info;const r=()=>{},o=e||te.createDefaultLoggerOptions();this.localCallback=o.loggerCallback||r,this.piiLoggingEnabled=o.piiLoggingEnabled||!1,this.level=typeof o.logLevel=="number"?o.logLevel:k.Info,this.packageName=t||"",this.packageVersion=n||""}static createDefaultLoggerOptions(){return{loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:k.Info}}clone(e,t){return new te({loggerCallback:this.localCallback,piiLoggingEnabled:this.piiLoggingEnabled,logLevel:this.level},e,t)}logMessage(e,t){const n=t.correlationId;if(mc(e)){const c={hash:e,level:t.logLevel,containsPii:t.containsPii||!1,milliseconds:0};pc(n,c)}if(t.logLevel>this.level||!this.piiLoggingEnabled&&t.containsPii)return;const a=`${`[${new Date().toUTCString()}] : [${n}]`} : ${this.packageName}@${this.packageVersion} : ${k[t.logLevel]} - ${e}`;this.executeCallback(t.logLevel,a,t.containsPii||!1)}executeCallback(e,t,n){this.localCallback&&this.localCallback(e,t,n)}error(e,t){this.logMessage(e,{logLevel:k.Error,containsPii:!1,correlationId:t})}errorPii(e,t){this.logMessage(e,{logLevel:k.Error,containsPii:!0,correlationId:t})}warning(e,t){this.logMessage(e,{logLevel:k.Warning,containsPii:!1,correlationId:t})}warningPii(e,t){this.logMessage(e,{logLevel:k.Warning,containsPii:!0,correlationId:t})}info(e,t){this.logMessage(e,{logLevel:k.Info,containsPii:!1,correlationId:t})}infoPii(e,t){this.logMessage(e,{logLevel:k.Info,containsPii:!0,correlationId:t})}verbose(e,t){this.logMessage(e,{logLevel:k.Verbose,containsPii:!1,correlationId:t})}verbosePii(e,t){this.logMessage(e,{logLevel:k.Verbose,containsPii:!0,correlationId:t})}trace(e,t){this.logMessage(e,{logLevel:k.Trace,containsPii:!1,correlationId:t})}tracePii(e,t){this.logMessage(e,{logLevel:k.Trace,containsPii:!0,correlationId:t})}isPiiLoggingEnabled(){return this.piiLoggingEnabled||!1}}const Vt="@azure/msal-common",dt="16.0.3";const Wn={None:"none"};function Wr(i,e){return!!i&&!!e&&i===e.split(".")[1]}function Ye(i,e,t,n){if(n){const{oid:r,sub:o,tid:s,name:a,tfp:c,acr:h,preferred_username:l,upn:d,login_hint:g}=n,p=s||c||h||"";return{tenantId:p,localAccountId:r||o||"",name:a,username:l||d||"",loginHint:g,isHomeTenant:Wr(p,i)}}else return{tenantId:t,localAccountId:e,username:"",isHomeTenant:Wr(t,i)}}function Qn(i,e,t,n){let r=i;if(e){const{isHomeTenant:o,...s}=e;r={...i,...s}}if(t){const{isHomeTenant:o,...s}=Ye(i.homeAccountId,i.localAccountId,i.tenantId,t);return r={...r,...s,idTokenClaims:t,idToken:n},r}return r}function ae(i,e){const t=Cc(i);try{const n=e(t);return JSON.parse(n)}catch{throw f(Wi)}}function Se(i){if(!i.signin_state)return!1;const e=["kmsi","dvc_dmjd"];return i.signin_state.some(t=>e.includes(t.trim().toLowerCase()))}function Cc(i){if(!i)throw f(xa);const t=/^([^\.\s]*)\.([^\.\s]+)\.([^\.\s]*)$/.exec(i);if(!t||t.length<4)throw f(Wi);return t[2]}function lo(i,e){if(e===0||Date.now()-3e5>i+e)throw f(ja)}class E{get urlString(){return this._urlString}constructor(e){if(this._urlString=e,!this._urlString)throw v(_a);e.includes("#")||(this._urlString=E.canonicalizeUri(e))}static canonicalizeUri(e){if(e){let t=e.toLowerCase();return W.endsWith(t,"?")?t=t.slice(0,-1):W.endsWith(t,"?/")&&(t=t.slice(0,-2)),W.endsWith(t,"/")||(t+="/"),t}return e}validateAsUri(){let e;try{e=this.getUrlComponents()}catch{throw v(mt)}if(!e.HostNameAndPort||!e.PathSegments)throw v(mt);if(!e.Protocol||e.Protocol.toLowerCase()!=="https:")throw v(Sa)}static appendQueryString(e,t){return t?e.indexOf("?")<0?`${e}?${t}`:`${e}&${t}`:e}static removeHashFromUrl(e){return E.canonicalizeUri(e.split("#")[0])}replaceTenantPath(e){const t=this.getUrlComponents(),n=t.PathSegments;return e&&n.length!==0&&(n[0]===me.COMMON||n[0]===me.ORGANIZATIONS)&&(n[0]=e),E.constructAuthorityUriFromObject(t)}getUrlComponents(){const e=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),t=this.urlString.match(e);if(!t)throw v(mt);const n={Protocol:t[1],HostNameAndPort:t[4],AbsolutePath:t[5],QueryString:t[7]};let r=n.AbsolutePath.split("/");return r=r.filter(o=>o&&o.length>0),n.PathSegments=r,n.QueryString&&n.QueryString.endsWith("/")&&(n.QueryString=n.QueryString.substring(0,n.QueryString.length-1)),n}static getDomainFromUrl(e){const t=RegExp("^([^:/?#]+://)?([^/?#]*)"),n=e.match(t);if(!n)throw v(mt);return n[2]}static getAbsoluteUrl(e,t){if(e[0]===un){const r=new E(t).getUrlComponents();return r.Protocol+"//"+r.HostNameAndPort+e}return e}static constructAuthorityUriFromObject(e){return new E(e.Protocol+"//"+e.HostNameAndPort+"/"+e.PathSegments.join("/"))}}const yc=[{host:"login.microsoftonline.com"},{host:"login.chinacloudapi.cn",issuerHost:"login.partner.microsoftonline.cn"},{host:"login.microsoftonline.us"},{host:"login.sovcloud-identity.fr"},{host:"login.sovcloud-identity.de"},{host:"login.sovcloud-identity.sg"}];function Ic(i,e){return{token_endpoint:`https://${i}/{tenantid}/oauth2/v2.0/token`,jwks_uri:`https://${i}/{tenantid}/discovery/v2.0/keys`,issuer:`https://${e}/{tenantid}/v2.0`,authorization_endpoint:`https://${i}/{tenantid}/oauth2/v2.0/authorize`,end_session_endpoint:`https://${i}/{tenantid}/oauth2/v2.0/logout`}}const Tc=yc.reduce((i,{host:e,issuerHost:t})=>(i[e]=Ic(e,t||e),i),{}),uo={endpointMetadata:Tc,instanceDiscoveryMetadata:{metadata:[{preferred_network:"login.microsoftonline.com",preferred_cache:"login.windows.net",aliases:["login.microsoftonline.com","login.windows.net","login.microsoft.com","sts.windows.net"]},{preferred_network:"login.partner.microsoftonline.cn",preferred_cache:"login.partner.microsoftonline.cn",aliases:["login.partner.microsoftonline.cn","login.chinacloudapi.cn"]},{preferred_network:"login.microsoftonline.de",preferred_cache:"login.microsoftonline.de",aliases:["login.microsoftonline.de"]},{preferred_network:"login.microsoftonline.us",preferred_cache:"login.microsoftonline.us",aliases:["login.microsoftonline.us","login.usgovcloudapi.net"]},{preferred_network:"login-us.microsoftonline.com",preferred_cache:"login-us.microsoftonline.com",aliases:["login-us.microsoftonline.com"]}]}},Qr=uo.endpointMetadata,Yn=uo.instanceDiscoveryMetadata,go=new Set;Yn.metadata.forEach(i=>{i.aliases.forEach(e=>{go.add(e)})});function wc(i,e,t){let n;const r=i.canonicalAuthority;if(r){const o=new E(r).getUrlComponents().HostNameAndPort;n=Yr(e,t,o,i.cloudDiscoveryMetadata?.metadata)||Yr(e,t,o,Yn.metadata)||i.knownAuthorities}return n||[]}function Yr(i,e,t,n,r){if(i.trace("1bmquz",e),t&&n){const o=Mt(n,t);if(o)return i.trace("1fotbt",e),o.aliases;i.trace("14avvj",e)}return null}function Ac(i){return Mt(Yn.metadata,i)}function Mt(i,e){for(let t=0;t<i.length;t++){const n=i[t];if(n.aliases.includes(e))return n}return null}const Cn="cache_quota_exceeded",Ec="cache_error_unknown";class Be extends Error{constructor(e,t){const n=t||Mn(e);super(n),Object.setPrototypeOf(this,Be.prototype),this.name="CacheError",this.errorCode=e,this.errorMessage=n}}function yn(i){return i instanceof Error?i.name==="QuotaExceededError"||i.name==="NS_ERROR_DOM_QUOTA_REACHED"||i.message.includes("exceeded the quota")?new Be(Cn):new Be(i.name,i.message):new Be(Ec)}function Ut(i,e){if(!i)throw f(La);try{const t=e(i);return JSON.parse(t)}catch{throw f(Ji)}}function ze(i){if(!i)throw f(Ji);const e=i.split(gn,2);return{uid:e[0],utid:e.length<2?"":e[1]}}const q={Default:0,Adfs:1,Dsts:2,Ciam:3};function Xn(i){return i&&(i.tid||i.tfp||i.acr)||null}const B={AAD:"AAD",OIDC:"OIDC",EAR:"EAR"};function ke(i){const e=i.tenantProfiles||[];return e.length===0&&i.realm&&i.localAccountId&&e.push(Ye(i.homeAccountId,i.localAccountId,i.realm)),{homeAccountId:i.homeAccountId,environment:i.environment,tenantId:i.realm,username:i.username,localAccountId:i.localAccountId,loginHint:i.loginHint,name:i.name,nativeAccountId:i.nativeAccountId,authorityType:i.authorityType,tenantProfiles:new Map(e.map(t=>[t.tenantId,t])),dataBoundary:i.dataBoundary}}function Sc(i,e,t){let n;e.authorityType===q.Adfs?n=ks:e.protocolMode===B.OIDC?n=Li:n=vs;let r,o;i.clientInfo&&t&&(r=Ut(i.clientInfo,t),r.xms_tdbr&&(o=r.xms_tdbr==="EU"?"EU":"None"));const s=i.environment||e&&e.getPreferredCache();if(!s)throw f(Xi);const a=i.idTokenClaims?.preferred_username||i.idTokenClaims?.upn,c=i.idTokenClaims?.emails?i.idTokenClaims.emails[0]:null,h=a||c||"",l=i.idTokenClaims?.login_hint,d=r?.utid||Xn(i.idTokenClaims)||"",g=r?.uid||i.idTokenClaims?.oid||i.idTokenClaims?.sub||"";let p;return i.tenantProfiles?p=i.tenantProfiles:p=[Ye(i.homeAccountId,g,d,i.idTokenClaims)],{homeAccountId:i.homeAccountId,environment:s,realm:d,localAccountId:g,username:h,authorityType:n,loginHint:l,clientInfo:i.clientInfo,name:i.idTokenClaims?.name||"",lastModificationTime:void 0,lastModificationApp:void 0,cloudGraphHostName:i.cloudGraphHostName,msGraphHost:i.msGraphHost,nativeAccountId:i.nativeAccountId,tenantProfiles:p,dataBoundary:o}}function _c(i,e,t){const n=Array.from(i.tenantProfiles?.values()||[]);return n.length===0&&i.tenantId&&i.localAccountId&&n.push(Ye(i.homeAccountId,i.localAccountId,i.tenantId,i.idTokenClaims)),{authorityType:i.authorityType||Li,homeAccountId:i.homeAccountId,localAccountId:i.localAccountId,nativeAccountId:i.nativeAccountId,realm:i.tenantId,environment:i.environment,username:i.username,loginHint:i.loginHint,name:i.name,cloudGraphHostName:e,msGraphHost:t,tenantProfiles:n,dataBoundary:i.dataBoundary}}function fo(i,e,t,n,r,o){if(!(e===q.Adfs||e===q.Dsts)){if(i)try{const s=Ut(i,n.base64Decode);if(s.uid&&s.utid)return`${s.uid}.${s.utid}`}catch{}t.warning("1ub6wv",r)}return o?.sub||""}function vc(i){return i?i.hasOwnProperty("homeAccountId")&&i.hasOwnProperty("environment")&&i.hasOwnProperty("realm")&&i.hasOwnProperty("localAccountId")&&i.hasOwnProperty("username")&&i.hasOwnProperty("authorityType"):!1}class In{constructor(e,t,n,r,o){this.clientId=e,this.cryptoImpl=t,this.commonLogger=n.clone(Vt,dt),this.staticAuthorityOptions=o,this.performanceClient=r}getAllAccounts(e={},t){return this.buildTenantProfiles(this.getAccountsFilteredBy(e,t),t,e)}getAccountInfoFilteredBy(e,t){const n=this.getAllAccounts(e,t);return n.length>1?n.sort(o=>o.idTokenClaims?-1:1)[0]:n.length===1?n[0]:null}getBaseAccountInfo(e,t){const n=this.getAccountsFilteredBy(e,t);return n.length>0?ke(n[0]):null}buildTenantProfiles(e,t,n){return e.flatMap(r=>this.getTenantProfilesFromAccountEntity(r,t,n?.tenantId,n))}getTenantedAccountInfoByFilter(e,t,n,r,o){let s=null,a;if(o&&!this.tenantProfileMatchesFilter(n,o))return null;const c=this.getIdToken(e,r,t,n.tenantId);return c&&(a=ae(c.secret,this.cryptoImpl.base64Decode),!this.idTokenClaimsMatchTenantProfileFilter(a,o))?null:(s=Qn(e,n,a,c?.secret),s)}getTenantProfilesFromAccountEntity(e,t,n,r){const o=ke(e);let s=o.tenantProfiles||new Map;const a=this.getTokenKeys();if(n){const h=s.get(n);if(h)s=new Map([[n,h]]);else return[]}const c=[];return s.forEach(h=>{const l=this.getTenantedAccountInfoByFilter(o,a,h,t,r);l&&c.push(l)}),c}tenantProfileMatchesFilter(e,t){return!(t.localAccountId&&!this.matchLocalAccountIdFromTenantProfile(e,t.localAccountId)||t.name&&e.name!==t.name||t.isHomeTenant!==void 0&&e.isHomeTenant!==t.isHomeTenant)}idTokenClaimsMatchTenantProfileFilter(e,t){return!(t&&(t.localAccountId&&!this.matchLocalAccountIdFromTokenClaims(e,t.localAccountId)||t.loginHint&&!this.matchLoginHintFromTokenClaims(e,t.loginHint)||t.username&&!this.matchUsername(e.preferred_username,t.username)||t.name&&!this.matchName(e,t.name)||t.sid&&!this.matchSid(e,t.sid)))}async saveCacheRecord(e,t,n,r,o){if(!e)throw f(Wa);try{e.account&&await this.setAccount(e.account,t,n,r),e.idToken&&o?.idToken!==!1&&await this.setIdTokenCredential(e.idToken,t,n),e.accessToken&&o?.accessToken!==!1&&await this.saveAccessToken(e.accessToken,t,n),e.refreshToken&&o?.refreshToken!==!1&&await this.setRefreshTokenCredential(e.refreshToken,t,n),e.appMetadata&&this.setAppMetadata(e.appMetadata,t)}catch(s){throw this.commonLogger?.error("0j476p",t),s instanceof _?s:yn(s)}}async saveAccessToken(e,t,n){const r={clientId:e.clientId,credentialType:e.credentialType,environment:e.environment,homeAccountId:e.homeAccountId,realm:e.realm,tokenType:e.tokenType},o=this.getTokenKeys(),s=D.fromString(e.target);o.accessToken.forEach(a=>{if(!this.accessTokenKeyMatchesFilter(a,r,!1))return;const c=this.getAccessTokenCredential(a,t);c&&this.credentialMatchesFilter(c,r,t)&&D.fromString(c.target).intersectingScopeSets(s)&&this.removeAccessToken(a,t)}),await this.setAccessTokenCredential(e,t,n)}getAccountsFilteredBy(e,t){const n=this.getAccountKeys(),r=[];return n.forEach(o=>{const s=this.getAccount(o,t);if(!s||e.homeAccountId&&!this.matchHomeAccountId(s,e.homeAccountId)||e.username&&!this.matchUsername(s.username,e.username)||e.environment&&!this.matchEnvironment(s,e.environment,t)||e.realm&&!this.matchRealm(s,e.realm)||e.nativeAccountId&&!this.matchNativeAccountId(s,e.nativeAccountId)||e.authorityType&&!this.matchAuthorityType(s,e.authorityType))return;const a={localAccountId:e?.localAccountId,name:e?.name},c=s.tenantProfiles?.filter(h=>this.tenantProfileMatchesFilter(h,a));c&&c.length===0||r.push(s)}),r}credentialMatchesFilter(e,t,n){return!(t.clientId&&!this.matchClientId(e,t.clientId)||t.userAssertionHash&&!this.matchUserAssertionHash(e,t.userAssertionHash)||typeof t.homeAccountId=="string"&&!this.matchHomeAccountId(e,t.homeAccountId)||t.environment&&!this.matchEnvironment(e,t.environment,n)||t.realm&&!this.matchRealm(e,t.realm)||t.credentialType&&!this.matchCredentialType(e,t.credentialType)||t.familyId&&!this.matchFamilyId(e,t.familyId)||t.target&&!this.matchTarget(e,t.target)||e.credentialType===N.ACCESS_TOKEN_WITH_AUTH_SCHEME&&(t.tokenType&&!this.matchTokenType(e,t.tokenType)||t.tokenType===S.SSH&&t.keyId&&!this.matchKeyId(e,t.keyId)))}getAppMetadataFilteredBy(e,t){const n=this.getKeys(),r={};return n.forEach(o=>{if(!this.isAppMetadata(o))return;const s=this.getAppMetadata(o,t);s&&(e.environment&&!this.matchEnvironment(s,e.environment,t)||e.clientId&&!this.matchClientId(s,e.clientId)||(r[o]=s))}),r}getAuthorityMetadataByAlias(e,t){const n=this.getAuthorityMetadataKeys();let r=null;return n.forEach(o=>{if(!this.isAuthorityMetadata(o)||o.indexOf(this.clientId)===-1)return;const s=this.getAuthorityMetadata(o,t);s&&s.aliases.indexOf(e)!==-1&&(r=s)}),r}removeAllAccounts(e){this.getAllAccounts({},e).forEach(n=>{this.removeAccount(n,e)})}removeAccount(e,t){this.removeAccountContext(e,t);const n=this.getAccountKeys(),r=o=>o.includes(e.homeAccountId)&&o.includes(e.environment);n.filter(r).forEach(o=>{this.removeItem(o,t),this.performanceClient.incrementFields({accountsRemoved:1},t)})}removeAccountContext(e,t){const n=this.getTokenKeys(),r=o=>o.includes(e.homeAccountId)&&o.includes(e.environment);n.idToken.filter(r).forEach(o=>{this.removeIdToken(o,t)}),n.accessToken.filter(r).forEach(o=>{this.removeAccessToken(o,t)}),n.refreshToken.filter(r).forEach(o=>{this.removeRefreshToken(o,t)})}removeAccessToken(e,t){const n=this.getAccessTokenCredential(e,t);if(n&&(this.removeItem(e,t),this.performanceClient.incrementFields({accessTokensRemoved:1},t),n.credentialType.toLowerCase()===N.ACCESS_TOKEN_WITH_AUTH_SCHEME.toLowerCase()&&n.tokenType===S.POP)){const o=n.keyId;o&&this.cryptoImpl.removeTokenBindingKey(o,t).catch(()=>{this.commonLogger.error("0cx291",t),this.performanceClient?.incrementFields({removeTokenBindingKeyFailure:1},t)})}}removeAppMetadata(e){return this.getKeys().forEach(n=>{this.isAppMetadata(n)&&this.removeItem(n,e)}),!0}getIdToken(e,t,n,r){this.commonLogger.trace("1drz22",t);const o={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:N.ID_TOKEN,clientId:this.clientId,realm:r},s=this.getIdTokensByFilter(o,t,n),a=s.size;if(a<1)return this.commonLogger.info("1atvtd",t),null;if(a>1){let c=s;if(!r){const h=new Map;s.forEach((d,g)=>{d.realm===e.tenantId&&h.set(g,d)});const l=h.size;if(l<1)return this.commonLogger.info("0ooalx",t),s.values().next().value;if(l===1)return this.commonLogger.info("1eq2vc",t),h.values().next().value;c=h}return this.commonLogger.info("1ws328",t),c.forEach((h,l)=>{this.removeIdToken(l,t)}),this.performanceClient.addFields({multiMatchedID:s.size},t),null}return this.commonLogger.info("1sm769",t),s.values().next().value}getIdTokensByFilter(e,t,n){const r=n&&n.idToken||this.getTokenKeys().idToken,o=new Map;return r.forEach(s=>{if(!this.idTokenKeyMatchesFilter(s,{clientId:this.clientId,...e}))return;const a=this.getIdTokenCredential(s,t);a&&this.credentialMatchesFilter(a,e,t)&&o.set(s,a)}),o}idTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}removeIdToken(e,t){this.removeItem(e,t)}removeRefreshToken(e,t){this.removeItem(e,t)}getAccessToken(e,t,n,r){const o=t.correlationId;this.commonLogger.trace("1t7hz1",o);const s=D.createSearchScopes(t.scopes),a=t.authenticationScheme||S.BEARER,c=a.toLowerCase()!==S.BEARER.toLowerCase()?N.ACCESS_TOKEN_WITH_AUTH_SCHEME:N.ACCESS_TOKEN,h={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:c,clientId:this.clientId,realm:r||e.tenantId,target:s,tokenType:a,keyId:t.sshKid},l=n&&n.accessToken||this.getTokenKeys().accessToken,d=[];l.forEach(p=>{if(this.accessTokenKeyMatchesFilter(p,h,!0)){const I=this.getAccessTokenCredential(p,o);I&&this.credentialMatchesFilter(I,h,o)&&d.push(I)}});const g=d.length;return g<1?(this.commonLogger.info("1nckna",o),null):g>1?(this.commonLogger.info("1wkfwp",o),d.forEach(p=>{this.removeAccessToken(this.generateCredentialKey(p),o)}),this.performanceClient.addFields({multiMatchedAT:d.length},o),null):(this.commonLogger.info("06yt98",o),d[0])}accessTokenKeyMatchesFilter(e,t,n){const r=e.toLowerCase();if(t.clientId&&r.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&r.indexOf(t.homeAccountId.toLowerCase())===-1||t.realm&&r.indexOf(t.realm.toLowerCase())===-1)return!1;if(t.target){const o=t.target.asArray();for(let s=0;s<o.length;s++){if(n&&!r.includes(o[s].toLowerCase()))return!1;if(!n&&r.includes(o[s].toLowerCase()))return!0}}return!0}getAccessTokensByFilter(e,t){const n=this.getTokenKeys(),r=[];return n.accessToken.forEach(o=>{if(!this.accessTokenKeyMatchesFilter(o,e,!0))return;const s=this.getAccessTokenCredential(o,t);s&&this.credentialMatchesFilter(s,e,t)&&r.push(s)}),r}getRefreshToken(e,t,n,r){this.commonLogger.trace("0x53vi",n);const o=t?kt:void 0,s={homeAccountId:e.homeAccountId,environment:e.environment,credentialType:N.REFRESH_TOKEN,clientId:this.clientId,familyId:o},a=r&&r.refreshToken||this.getTokenKeys().refreshToken,c=[];a.forEach(l=>{if(this.refreshTokenKeyMatchesFilter(l,s)){const d=this.getRefreshTokenCredential(l,n);d&&this.credentialMatchesFilter(d,s,n)&&c.push(d)}});const h=c.length;return h<1?(this.commonLogger.info("0dlw11",n),null):(h>1&&this.performanceClient.addFields({multiMatchedRT:h},n),this.commonLogger.info("0wcnep",n),c[0])}refreshTokenKeyMatchesFilter(e,t){const n=e.toLowerCase();return!(t.familyId&&n.indexOf(t.familyId.toLowerCase())===-1||!t.familyId&&t.clientId&&n.indexOf(t.clientId.toLowerCase())===-1||t.homeAccountId&&n.indexOf(t.homeAccountId.toLowerCase())===-1)}readAppMetadataFromCache(e,t){const n={environment:e,clientId:this.clientId},r=this.getAppMetadataFilteredBy(n,t),o=Object.keys(r).map(a=>r[a]),s=o.length;if(s<1)return null;if(s>1)throw f(Ga);return o[0]}isAppMetadataFOCI(e,t){const n=this.readAppMetadataFromCache(e,t);return!!(n&&n.familyId===kt)}matchHomeAccountId(e,t){return typeof e.homeAccountId=="string"&&t===e.homeAccountId}matchLocalAccountIdFromTokenClaims(e,t){const n=e.oid||e.sub;return t===n}matchLocalAccountIdFromTenantProfile(e,t){return e.localAccountId===t}matchName(e,t){return t.toLowerCase()===e.name?.toLowerCase()}matchUsername(e,t){return!!(e&&typeof e=="string"&&t?.toLowerCase()===e.toLowerCase())}matchUserAssertionHash(e,t){return!!(e.userAssertionHash&&t===e.userAssertionHash)}matchEnvironment(e,t,n){if(this.staticAuthorityOptions){const o=wc(this.staticAuthorityOptions,this.commonLogger,n);if(o.includes(t)&&o.includes(e.environment))return!0}const r=this.getAuthorityMetadataByAlias(t,n);return!!(r&&r.aliases.indexOf(e.environment)>-1)}matchCredentialType(e,t){return e.credentialType&&t.toLowerCase()===e.credentialType.toLowerCase()}matchClientId(e,t){return!!(e.clientId&&t===e.clientId)}matchFamilyId(e,t){return!!(e.familyId&&t===e.familyId)}matchRealm(e,t){return e.realm?.toLowerCase()===t.toLowerCase()}matchNativeAccountId(e,t){return!!(e.nativeAccountId&&t===e.nativeAccountId)}matchLoginHintFromTokenClaims(e,t){return e.login_hint===t||e.preferred_username===t||e.upn===t}matchSid(e,t){return e.sid===t}matchAuthorityType(e,t){return!!(e.authorityType&&t.toLowerCase()===e.authorityType.toLowerCase())}matchTarget(e,t){return e.credentialType!==N.ACCESS_TOKEN&&e.credentialType!==N.ACCESS_TOKEN_WITH_AUTH_SCHEME||!e.target?!1:D.fromString(e.target).containsScopeSet(t)}matchTokenType(e,t){return!!(e.tokenType&&e.tokenType===t)}matchKeyId(e,t){return!!(e.keyId&&e.keyId===t)}isAppMetadata(e){return e.indexOf(Nn)!==-1}isAuthorityMetadata(e){return e.indexOf(fn)!==-1}generateAuthorityMetadataCacheKey(e){return`${fn}-${this.clientId}-${e}`}static toObject(e,t){for(const n in t)e[n]=t[n];return e}}class kc extends In{async setAccount(){throw f(T)}getAccount(){throw f(T)}async setIdTokenCredential(){throw f(T)}getIdTokenCredential(){throw f(T)}async setAccessTokenCredential(){throw f(T)}getAccessTokenCredential(){throw f(T)}async setRefreshTokenCredential(){throw f(T)}getRefreshTokenCredential(){throw f(T)}setAppMetadata(){throw f(T)}getAppMetadata(){throw f(T)}setServerTelemetry(){throw f(T)}getServerTelemetry(){throw f(T)}setAuthorityMetadata(){throw f(T)}getAuthorityMetadata(){throw f(T)}getAuthorityMetadataKeys(){throw f(T)}setThrottlingCache(){throw f(T)}getThrottlingCache(){throw f(T)}removeItem(){throw f(T)}getKeys(){throw f(T)}getAccountKeys(){throw f(T)}getTokenKeys(){throw f(T)}generateCredentialKey(){throw f(T)}generateAccountKey(){throw f(T)}}const bc={InProgress:1};class po{generateId(){return"callback-id"}startMeasurement(e,t){return{end:()=>null,discard:()=>{},add:()=>{},increment:()=>{},event:{eventId:this.generateId(),status:bc.InProgress,authority:"",libraryName:"",libraryVersion:"",clientId:"",name:e,startTimeMs:Date.now(),correlationId:t||""}}}endMeasurement(){return null}discardMeasurements(){}removePerformanceCallback(){return!0}addPerformanceCallback(){return""}emitEvents(){}addFields(){}incrementFields(){}cacheEventByCorrelationId(){}}const mo={tokenRenewalOffsetSeconds:Fi,preventCorsPreflight:!1},Rc={loggerCallback:()=>{},piiLoggingEnabled:!1,logLevel:k.Info,correlationId:""},Oc={async sendGetRequestAsync(){throw f(T)},async sendPostRequestAsync(){throw f(T)}},Pc={sku:cs,version:dt,cpu:"",os:""},Nc={clientSecret:"",clientAssertion:void 0},Mc={azureCloudInstance:Wn.None,tenant:`${Ni}`},Uc={application:{appName:"",appVersion:""}};function qn({authOptions:i,systemOptions:e,loggerOptions:t,storageInterface:n,networkInterface:r,cryptoInterface:o,clientCredentials:s,libraryInfo:a,telemetry:c,serverTelemetryManager:h,persistencePlugin:l,serializableCache:d}){const g={...Rc,...t};return{authOptions:Dc(i),systemOptions:{...mo,...e},loggerOptions:g,storageInterface:n||new kc(i.clientId,Nt,new te(g),new po),networkInterface:r||Oc,cryptoInterface:o||Nt,clientCredentials:s||Nc,libraryInfo:{...Pc,...a},telemetry:{...Uc,...c},serverTelemetryManager:h||null,persistencePlugin:l||null,serializableCache:d||null}}function Dc(i){return{clientCapabilities:[],azureCloudOptions:Mc,instanceAware:!1,...i}}function Co(i){return i.authOptions.authority.options.protocolMode===B.OIDC}class Me extends _{constructor(e,t,n,r,o){super(e,t,n),this.name="ServerError",this.errorNo=r,this.status=o,Object.setPrototypeOf(this,Me.prototype)}}const Tn="no_tokens_found",Lc="native_account_unavailable",yo="refresh_token_expired",Io="ux_not_allowed",xc="interaction_required",Hc="consent_required",Kc="login_required",Zn="bad_token";const Xr=[xc,Hc,Kc,Zn,Io],Fc=["message_only","additional_action","basic_action","user_password_expired","consent_required","bad_token","ux_not_allowed"];class ne extends _{constructor(e,t,n,r,o,s,a,c){super(e,t,n),Object.setPrototypeOf(this,ne.prototype),this.timestamp=r||"",this.traceId=o||"",this.correlationId=s||"",this.claims=a||"",this.name="InteractionRequiredAuthError",this.errorNo=c}}function To(i,e,t){const n=!!i&&Xr.indexOf(i)>-1,r=!!t&&Fc.indexOf(t)>-1,o=!!e&&Xr.some(s=>e.indexOf(s)>-1);return n||o||r}function Dt(i,e){return new ne(i,e)}function Bc(i,e,t){const n=zc(i,t);return e?`${n}${dn}${e}`:n}function zc(i,e){if(!i)throw f(qi);const t={id:i.createNewGuid()};e&&(t.meta=e);const n=JSON.stringify(t);return i.base64Encode(n)}function ut(i,e){if(!i)throw f(qi);if(!e)throw f(st);try{const t=e.split(dn),n=t[0],r=t.length>1?t.slice(1).join(dn):"",o=i(n),s=JSON.parse(o);return{userRequestState:r||"",libraryState:s}}catch{throw f(st)}}function re(){return Math.round(new Date().getTime()/1e3)}function qr(i){return i.getTime()/1e3}function At(i){return i?new Date(Number(i)*1e3):new Date}function Lt(i,e){const t=Number(i)||0;return re()+e>t}function Zr(i,e){const t=Number(i)+e*24*60*60*1e3;return Date.now()>t}function jc(i){return Number(i)>re()}const Gc="networkClientSendPostRequestAsync",Vc="refreshTokenClientExecutePostToTokenEndpoint",$c="authorizationCodeClientExecutePostToTokenEndpoint",Jc="refreshTokenClientExecuteTokenRequest",Wc="refreshTokenClientAcquireToken",rn="refreshTokenClientAcquireTokenWithCachedRefreshToken",Qc="refreshTokenClientCreateTokenRequestBody",Yc="silentFlowClientGenerateResultFromCacheRecord",er="getAuthCodeUrl",wo="handleCodeResponseFromServer",Xc="authClientExecuteTokenRequest",qc="authClientCreateTokenRequestBody",Zc="updateTokenEndpointAuthority",gt="popTokenGenerateCnf",tr="handleServerTokenResponse",eh="authorityResolveEndpointsAsync",th="authorityGetCloudDiscoveryMetadataFromNetwork",nh="authorityUpdateCloudDiscoveryMetadata",rh="authorityGetEndpointMetadataFromNetwork",ih="authorityUpdateEndpointMetadata",ei="authorityUpdateMetadataWithRegionalInformation",oh="regionDiscoveryDetectRegion",ti="regionDiscoveryGetRegionFromIMDS",sh="regionDiscoveryGetCurrentVersion",ah="cacheManagerGetRefreshToken",ch="setUserData";const ee=(i,e,t,n,r)=>(...o)=>{t.trace("1plfzx",r);const s=n.startMeasurement(e,r);if(r){const a=e+"CallCount";n.incrementFields({[a]:1},r)}try{const a=i(...o);return s.end({success:!0}),t.trace("1g8n6a",r),a}catch(a){t.trace("0cfd8i",r);try{t.trace(JSON.stringify(a),r)}catch{t.trace("00dty7",r)}throw s.end({success:!1},a),a}},u=(i,e,t,n,r)=>(...o)=>{t.trace("1plfzx",r);const s=n.startMeasurement(e,r);if(r){const a=e+"CallCount";n.incrementFields({[a]:1},r)}return i(...o).then(a=>(t.trace("1g8n6a",r),s.end({success:!0}),a)).catch(a=>{t.trace("0cfd8i",r);try{t.trace(JSON.stringify(a),r)}catch{t.trace("00dty7",r)}throw s.end({success:!1},a),a})};const hh={SW:"sw"};class Je{constructor(e,t){this.cryptoUtils=e,this.performanceClient=t}async generateCnf(e,t){const n=await u(this.generateKid.bind(this),gt,t,this.performanceClient,e.correlationId)(e),r=this.cryptoUtils.base64UrlEncode(JSON.stringify(n));return{kid:n.kid,reqCnfString:r}}async generateKid(e){return{kid:await this.cryptoUtils.getPublicKeyThumbprint(e),xms_ksl:hh.SW}}async signPopToken(e,t,n){return this.signPayload(e,t,n)}async signPayload(e,t,n,r){const{resourceRequestMethod:o,resourceRequestUri:s,shrClaims:a,shrNonce:c,shrOptions:h}=n,d=(s?new E(s):void 0)?.getUrlComponents();return this.cryptoUtils.signJwt({at:e,ts:re(),m:o?.toUpperCase(),u:d?.HostNameAndPort,nonce:c||this.cryptoUtils.createNewGuid(),p:d?.AbsolutePath,q:d?.QueryString?[[],d.QueryString]:void 0,client_claims:a||void 0,...r},t,h,n.correlationId)}}class lh{constructor(e,t){this.cache=e,this.hasChanged=t}get cacheHasChanged(){return this.hasChanged}get tokenCache(){return this.cache}}function nr(i,e,t,n,r){return{credentialType:N.ID_TOKEN,homeAccountId:i,environment:e,clientId:n,secret:t,realm:r,lastUpdatedAt:Date.now().toString()}}function rr(i,e,t,n,r,o,s,a,c,h,l,d,g){const p={homeAccountId:i,credentialType:N.ACCESS_TOKEN,secret:t,cachedAt:re().toString(),expiresOn:s.toString(),extendedExpiresOn:a.toString(),environment:e,clientId:n,realm:r,target:o,tokenType:l||S.BEARER,lastUpdatedAt:Date.now().toString()};if(d&&(p.userAssertionHash=d),h&&(p.refreshOn=h.toString()),p.tokenType?.toLowerCase()!==S.BEARER.toLowerCase())switch(p.credentialType=N.ACCESS_TOKEN_WITH_AUTH_SCHEME,p.tokenType){case S.POP:const I=ae(t,c);if(!I?.cnf?.kid)throw f(Qa);p.keyId=I.cnf.kid;break;case S.SSH:p.keyId=g}return p}function dh(i,e,t,n,r,o,s){const a={credentialType:N.REFRESH_TOKEN,homeAccountId:i,environment:e,clientId:n,secret:t,lastUpdatedAt:Date.now().toString()};return o&&(a.userAssertionHash=o),r&&(a.familyId=r),s&&(a.expiresOn=s.toString()),a}function $t(i){return i.hasOwnProperty("homeAccountId")&&i.hasOwnProperty("environment")&&i.hasOwnProperty("credentialType")&&i.hasOwnProperty("clientId")&&i.hasOwnProperty("secret")}function ni(i){return i?$t(i)&&i.hasOwnProperty("realm")&&i.hasOwnProperty("target")&&(i.credentialType===N.ACCESS_TOKEN||i.credentialType===N.ACCESS_TOKEN_WITH_AUTH_SCHEME):!1}function uh(i){return i?$t(i)&&i.hasOwnProperty("realm")&&i.credentialType===N.ID_TOKEN:!1}function ri(i){return i?$t(i)&&i.credentialType===N.REFRESH_TOKEN:!1}function gh(i,e){const t=i.indexOf(Hi)===0;let n=!0;return e&&(n=e.hasOwnProperty("failedRequests")&&e.hasOwnProperty("errors")&&e.hasOwnProperty("cacheHits")),t&&n}function fh(i,e){let t=!1;i&&(t=i.indexOf(Ki)===0);let n=!0;return e&&(n=e.hasOwnProperty("throttleTime")),t&&n}function ph({environment:i,clientId:e}){return[Nn,i,e].join(xi).toLowerCase()}function mh(i,e){return e?i.indexOf(Nn)===0&&e.hasOwnProperty("clientId")&&e.hasOwnProperty("environment"):!1}function Ch(i,e){return e?i.indexOf(fn)===0&&e.hasOwnProperty("aliases")&&e.hasOwnProperty("preferred_cache")&&e.hasOwnProperty("preferred_network")&&e.hasOwnProperty("canonical_authority")&&e.hasOwnProperty("authorization_endpoint")&&e.hasOwnProperty("token_endpoint")&&e.hasOwnProperty("issuer")&&e.hasOwnProperty("aliasesFromNetwork")&&e.hasOwnProperty("endpointsFromNetwork")&&e.hasOwnProperty("expiresAt")&&e.hasOwnProperty("jwks_uri"):!1}function ii(){return re()+Rs}function yt(i,e,t){i.authorization_endpoint=e.authorization_endpoint,i.token_endpoint=e.token_endpoint,i.end_session_endpoint=e.end_session_endpoint,i.issuer=e.issuer,i.endpointsFromNetwork=t,i.jwks_uri=e.jwks_uri}function on(i,e,t){i.aliases=e.aliases,i.preferred_cache=e.preferred_cache,i.preferred_network=e.preferred_network,i.aliasesFromNetwork=t}function oi(i){return i.expiresAt<=re()}class be{constructor(e,t,n,r,o,s,a){this.clientId=e,this.cacheStorage=t,this.cryptoObj=n,this.logger=r,this.performanceClient=o,this.serializableCache=s,this.persistencePlugin=a}validateTokenResponse(e,t,n){if(e.error||e.error_description||e.suberror){const r=`Error(s): ${e.error_codes||Ze} - Timestamp: ${e.timestamp||Ze} - Description: ${e.error_description||Ze} - Correlation ID: ${e.correlation_id||Ze} - Trace ID: ${e.trace_id||Ze}`,o=e.error_codes?.length?e.error_codes[0]:void 0,s=new Me(e.error,r,e.suberror,o,e.status);if(n&&e.status&&e.status>=Ss&&e.status<=_s){this.logger.warning("16ks7j",t);return}else if(n&&e.status&&e.status>=As&&e.status<=Es){this.logger.warning("0g61x3",t);return}throw To(e.error,e.error_description,e.suberror)?new ne(e.error,e.error_description,e.suberror,e.timestamp||"",e.trace_id||"",e.correlation_id||"",e.claims||"",o):s}}async handleServerTokenResponse(e,t,n,r,o,s,a,c,h,l){let d;if(e.id_token){if(d=ae(e.id_token||"",this.cryptoObj.base64Decode),s&&s.nonce&&d.nonce!==s.nonce)throw f(za);if(r.maxAge||r.maxAge===0){const A=d.auth_time;if(!A)throw f(Qi);lo(A,r.maxAge)}}this.homeAccountIdentifier=fo(e.client_info||"",t.authorityType,this.logger,this.cryptoObj,r.correlationId,d);let g;s&&s.state&&(g=ut(this.cryptoObj.base64Decode,s.state)),e.key_id=e.key_id||r.sshKid||void 0;const p=this.generateCacheRecord(e,t,n,r,d,a,s);let I;try{if(this.persistencePlugin&&this.serializableCache&&(this.logger.verbose("0jbz5k",r.correlationId),I=new lh(this.serializableCache,!0),await this.persistencePlugin.beforeCacheAccess(I)),c&&!h&&p.account&&this.cacheStorage.getAllAccounts({homeAccountId:p.account.homeAccountId,environment:p.account.environment},r.correlationId).length<1)return this.logger.warning("1gmt66",r.correlationId),this.performanceClient?.addFields({acntLoggedOut:!0},r.correlationId),await be.generateAuthenticationResult(this.cryptoObj,t,p,!1,r,this.performanceClient,d,g,void 0,l);await this.cacheStorage.saveCacheRecord(p,r.correlationId,Se(d||{}),o,r.storeInCache)}finally{this.persistencePlugin&&this.serializableCache&&I&&(this.logger.verbose("1bh17u",r.correlationId),await this.persistencePlugin.afterCacheAccess(I))}return be.generateAuthenticationResult(this.cryptoObj,t,p,!1,r,this.performanceClient,d,g,e,l)}generateCacheRecord(e,t,n,r,o,s,a){const c=t.getPreferredCache();if(!c)throw f(Xi);const h=Xn(o);let l,d;e.id_token&&o&&(l=nr(this.homeAccountIdentifier,c,e.id_token,this.clientId,h||""),d=Ao(this.cacheStorage,t,this.homeAccountIdentifier,this.cryptoObj.base64Decode,r.correlationId,o,e.client_info,c,h,a,void 0,this.logger));let g=null;if(e.access_token){const A=e.scope?D.fromString(e.scope):new D(r.scopes||[]),O=(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,j=(typeof e.ext_expires_in=="string"?parseInt(e.ext_expires_in,10):e.ext_expires_in)||0,b=(typeof e.refresh_in=="string"?parseInt(e.refresh_in,10):e.refresh_in)||void 0,G=n+O,Te=G+j,Ue=b&&b>0?n+b:void 0;g=rr(this.homeAccountIdentifier,c,e.access_token,this.clientId,h||t.tenant||"",A.printScopes(),G,Te,this.cryptoObj.base64Decode,Ue,e.token_type,s,e.key_id)}let p=null;if(e.refresh_token){let A;if(e.refresh_token_expires_in){const O=typeof e.refresh_token_expires_in=="string"?parseInt(e.refresh_token_expires_in,10):e.refresh_token_expires_in;A=n+O,this.performanceClient?.addFields({ntwkRtExpiresOnSeconds:A},r.correlationId)}p=dh(this.homeAccountIdentifier,c,e.refresh_token,this.clientId,e.foci,s,A)}let I=null;return e.foci&&(I={clientId:this.clientId,environment:c,familyId:e.foci}),{account:d,idToken:l,accessToken:g,refreshToken:p,appMetadata:I}}static async generateAuthenticationResult(e,t,n,r,o,s,a,c,h,l){let d="",g=[],p=null,I,A,O="";if(n.accessToken){if(n.accessToken.tokenType===S.POP&&!o.popKid){const Te=new Je(e,s),{secret:Ue,keyId:De}=n.accessToken;if(!De)throw f(Zi);d=await Te.signPopToken(Ue,De,o)}else d=n.accessToken.secret;g=D.fromString(n.accessToken.target).asArray(),p=At(n.accessToken.expiresOn),I=At(n.accessToken.extendedExpiresOn),n.accessToken.refreshOn&&(A=At(n.accessToken.refreshOn))}n.appMetadata&&(O=n.appMetadata.familyId===kt?kt:"");const j=a?.oid||a?.sub||"",b=a?.tid||"";h?.spa_accountid&&n.account&&(n.account.nativeAccountId=h?.spa_accountid);const G=n.account?Qn(ke(n.account),void 0,a,n.idToken?.secret):null;return{authority:t.canonicalAuthority,uniqueId:j,tenantId:b,scopes:g,account:G,idToken:n?.idToken?.secret||"",idTokenClaims:a||{},accessToken:d,fromCache:r,expiresOn:p,extExpiresOn:I,refreshOn:A,correlationId:o.correlationId,requestId:l||"",familyId:O,tokenType:n.accessToken?.tokenType||"",state:c?c.userRequestState:"",cloudGraphHostName:n.account?.cloudGraphHostName||"",msGraphHost:n.account?.msGraphHost||"",code:h?.spa_code,fromPlatformBroker:!1}}}function Ao(i,e,t,n,r,o,s,a,c,h,l,d){d?.verbose("09jz0t",r);const p=i.getAccountKeys().find(b=>b.startsWith(t));let I=null;p&&(I=i.getAccount(p,r));const A=I||Sc({homeAccountId:t,idTokenClaims:o,clientInfo:s,environment:a,cloudGraphHostName:h?.cloud_graph_host_name,msGraphHost:h?.msgraph_host,nativeAccountId:l},e,n),O=A.tenantProfiles||[],j=c||A.realm;if(j&&!O.find(b=>b.tenantId===j)){const b=Ye(t,A.localAccountId,j,o);O.push(b)}return A.tenantProfiles=O,A}const Z={HOME_ACCOUNT_ID:"home_account_id",UPN:"UPN"};async function Eo(i,e,t){return typeof i=="string"?i:i({clientId:e,tokenEndpoint:t})}function Jt(i,e,t){return{clientId:i,authority:e.authority,scopes:e.scopes,homeAccountIdentifier:t,claims:e.claims,authenticationScheme:e.authenticationScheme,resourceRequestMethod:e.resourceRequestMethod,resourceRequestUri:e.resourceRequestUri,shrClaims:e.shrClaims,sshKid:e.sshKid,embeddedClientId:e.embeddedClientId||e.extraParameters?.clientId}}class ie{static generateThrottlingStorageKey(e){return`${Ki}.${JSON.stringify(e)}`}static preProcess(e,t,n){const r=ie.generateThrottlingStorageKey(t),o=e.getThrottlingCache(r,n);if(o){if(o.throttleTime<Date.now()){e.removeItem(r,n);return}throw new Me(o.errorCodes?.join(" ")||"",o.errorMessage,o.subError)}}static postProcess(e,t,n,r){if(ie.checkResponseStatus(n)||ie.checkResponseForRetryAfter(n)){const o={throttleTime:ie.calculateThrottleTime(parseInt(n.headers[H.RETRY_AFTER])),error:n.body.error,errorCodes:n.body.error_codes,errorMessage:n.body.error_description,subError:n.body.suberror};e.setThrottlingCache(ie.generateThrottlingStorageKey(t),o,r)}}static checkResponseStatus(e){return e.status===429||e.status>=500&&e.status<600}static checkResponseForRetryAfter(e){return e.headers?e.headers.hasOwnProperty(H.RETRY_AFTER)&&(e.status<200||e.status>=300):!1}static calculateThrottleTime(e){const t=e<=0?0:e,n=Date.now()/1e3;return Math.floor(Math.min(n+(t||Ds),n+Ls)*1e3)}static removeThrottle(e,t,n,r){const o=Jt(t,n,r),s=this.generateThrottlingStorageKey(o);e.removeItem(s,n.correlationId)}}class Wt extends _{constructor(e,t,n){super(e.errorCode,e.errorMessage,e.subError),Object.setPrototypeOf(this,Wt.prototype),this.name="NetworkError",this.error=e,this.httpStatus=t,this.responseHeaders=n}}function nt(i,e,t,n){return i.errorMessage=`${i.errorMessage}, additionalErrorInfo: error.name:${n?.name}, error.message:${n?.message}`,new Wt(i,e,t)}function So(i,e,t){const n={};if(n[H.CONTENT_TYPE]=ps,!e&&t)switch(t.type){case Z.HOME_ACCOUNT_ID:try{const r=ze(t.credential);n[H.CCS_HEADER]=`Oid:${r.uid}@${r.utid}`}catch{i.verbose("1qhtee","")}break;case Z.UPN:n[H.CCS_HEADER]=`UPN: ${t.credential}`;break}return n}function _o(i,e,t,n){const r=new Map;return i.embeddedClientId&&Gt(r,e,t),i.extraQueryParameters&&se(r,i.extraQueryParameters),zn(r,i.correlationId),jt(r,i.correlationId,n),at(r)}async function vo(i,e,t,n,r,o,s,a,c,h){const l=await yh(n,i,{body:e,headers:t},r,o,s,a,c);return h&&l.status<500&&l.status!==429&&h.clearTelemetryCache(),l}async function yh(i,e,t,n,r,o,s,a){ie.preProcess(r,i,n);let c;try{c=await u(o.sendPostRequestAsync.bind(o),Gc,s,a,n)(e,t);const h=c.headers||{};a?.addFields({refreshTokenSize:c.body.refresh_token?.length||0,httpVerToken:h[H.X_MS_HTTP_VERSION]||"",requestId:h[H.X_MS_REQUEST_ID]||""},n)}catch(h){if(h instanceof Wt){const l=h.responseHeaders;throw l&&a?.addFields({httpVerToken:l[H.X_MS_HTTP_VERSION]||"",requestId:l[H.X_MS_REQUEST_ID]||"",contentTypeHeader:l[H.CONTENT_TYPE]||void 0,contentLengthHeader:l[H.CONTENT_LENGTH]||void 0,httpStatus:h.httpStatus},n),h.error}throw h instanceof _?h:f(Ha)}return ie.postProcess(r,i,c,n),c}function Ih(i){return i.hasOwnProperty("authorization_endpoint")&&i.hasOwnProperty("token_endpoint")&&i.hasOwnProperty("issuer")&&i.hasOwnProperty("jwks_uri")}function Th(i){return i.hasOwnProperty("tenant_discovery_endpoint")&&i.hasOwnProperty("metadata")}function wh(i){return i.hasOwnProperty("error")&&i.hasOwnProperty("error_description")}class Qt{constructor(e,t,n,r){this.networkInterface=e,this.logger=t,this.performanceClient=n,this.correlationId=r}async detectRegion(e,t){let n=e;if(n)t.region_source=xe.ENVIRONMENT_VARIABLE;else{const r=Qt.IMDS_OPTIONS;try{const o=await u(this.getRegionFromIMDS.bind(this),ti,this.logger,this.performanceClient,this.correlationId)(ms,r);if(o.status===Dr&&(n=o.body,t.region_source=xe.IMDS),o.status===Lr){const s=await u(this.getCurrentVersion.bind(this),sh,this.logger,this.performanceClient,this.correlationId)(r);if(!s)return t.region_source=xe.FAILED_AUTO_DETECTION,null;const a=await u(this.getRegionFromIMDS.bind(this),ti,this.logger,this.performanceClient,this.correlationId)(s,r);a.status===Dr&&(n=a.body,t.region_source=xe.IMDS)}}catch{return t.region_source=xe.FAILED_AUTO_DETECTION,null}}return n||(t.region_source=xe.FAILED_AUTO_DETECTION),n||null}async getRegionFromIMDS(e,t){return this.networkInterface.sendGetRequestAsync(`${Mr}?api-version=${e}&format=text`,t,Cs)}async getCurrentVersion(e){try{const t=await this.networkInterface.sendGetRequestAsync(`${Mr}?format=json`,e);return t.status===Lr&&t.body&&t.body["newest-versions"]&&t.body["newest-versions"].length>0?t.body["newest-versions"][0]:null}catch{return null}}}Qt.IMDS_OPTIONS={headers:{Metadata:"true"}};class K{constructor(e,t,n,r,o,s,a,c){this.canonicalAuthority=e,this._canonicalAuthority.validateAsUri(),this.networkInterface=t,this.cacheManager=n,this.authorityOptions=r,this.regionDiscoveryMetadata={region_used:void 0,region_source:void 0,region_outcome:void 0},this.logger=o,this.performanceClient=a,this.correlationId=s,this.managedIdentity=c||!1,this.regionDiscovery=new Qt(t,this.logger,this.performanceClient,this.correlationId)}getAuthorityType(e){if(e.HostNameAndPort.endsWith(Nr))return q.Ciam;const t=e.PathSegments;if(t.length)switch(t[0].toLowerCase()){case ls:return q.Adfs;case ds:return q.Dsts}return q.Default}get authorityType(){return this.getAuthorityType(this.canonicalAuthorityUrlComponents)}get protocolMode(){return this.authorityOptions.protocolMode}get options(){return this.authorityOptions}get canonicalAuthority(){return this._canonicalAuthority.urlString}set canonicalAuthority(e){this._canonicalAuthority=new E(e),this._canonicalAuthority.validateAsUri(),this._canonicalAuthorityUrlComponents=null}get canonicalAuthorityUrlComponents(){return this._canonicalAuthorityUrlComponents||(this._canonicalAuthorityUrlComponents=this._canonicalAuthority.getUrlComponents()),this._canonicalAuthorityUrlComponents}get hostnameAndPort(){return this.canonicalAuthorityUrlComponents.HostNameAndPort.toLowerCase()}get tenant(){return this.canonicalAuthorityUrlComponents.PathSegments[0]}get authorizationEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.authorization_endpoint);throw f(de)}get tokenEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint);throw f(de)}get deviceCodeEndpoint(){if(this.discoveryComplete())return this.replacePath(this.metadata.token_endpoint.replace("/token","/devicecode"));throw f(de)}get endSessionEndpoint(){if(this.discoveryComplete()){if(!this.metadata.end_session_endpoint)throw f(qa);return this.replacePath(this.metadata.end_session_endpoint)}else throw f(de)}get selfSignedJwtAudience(){if(this.discoveryComplete())return this.replacePath(this.metadata.issuer);throw f(de)}get jwksUri(){if(this.discoveryComplete())return this.replacePath(this.metadata.jwks_uri);throw f(de)}canReplaceTenant(e){return e.PathSegments.length===1&&!K.reservedTenantDomains.has(e.PathSegments[0])&&this.getAuthorityType(e)===q.Default&&this.protocolMode!==B.OIDC}replaceTenant(e){return e.replace(/{tenant}|{tenantid}/g,this.tenant)}replacePath(e){let t=e;const r=new E(this.metadata.canonical_authority).getUrlComponents(),o=r.PathSegments;return this.canonicalAuthorityUrlComponents.PathSegments.forEach((a,c)=>{let h=o[c];if(c===0&&this.canReplaceTenant(r)){const l=new E(this.metadata.authorization_endpoint).getUrlComponents().PathSegments[0];h!==l&&(this.logger.verbose("1q3g2x",this.correlationId),h=l)}a!==h&&(t=t.replace(`/${h}/`,`/${a}/`))}),this.replaceTenant(t)}get defaultOpenIdConfigurationEndpoint(){const e=this.hostnameAndPort;return this.canonicalAuthority.endsWith("v2.0/")||this.authorityType===q.Adfs||this.protocolMode===B.OIDC&&!this.isAliasOfKnownMicrosoftAuthority(e)?`${this.canonicalAuthority}.well-known/openid-configuration`:`${this.canonicalAuthority}v2.0/.well-known/openid-configuration`}discoveryComplete(){return!!this.metadata}async resolveEndpointsAsync(){const e=this.getCurrentMetadataEntity(),t=await u(this.updateCloudDiscoveryMetadata.bind(this),nh,this.logger,this.performanceClient,this.correlationId)(e);this.canonicalAuthority=this.canonicalAuthority.replace(this.hostnameAndPort,e.preferred_network);const n=await u(this.updateEndpointMetadata.bind(this),ih,this.logger,this.performanceClient,this.correlationId)(e);this.updateCachedMetadata(e,t,{source:n}),this.performanceClient?.addFields({cloudDiscoverySource:t,authorityEndpointSource:n},this.correlationId)}getCurrentMetadataEntity(){let e=this.cacheManager.getAuthorityMetadataByAlias(this.hostnameAndPort,this.correlationId);return e||(e={aliases:[],preferred_cache:this.hostnameAndPort,preferred_network:this.hostnameAndPort,canonical_authority:this.canonicalAuthority,authorization_endpoint:"",token_endpoint:"",end_session_endpoint:"",issuer:"",aliasesFromNetwork:!1,endpointsFromNetwork:!1,expiresAt:ii(),jwks_uri:""}),e}updateCachedMetadata(e,t,n){t!==Y.CACHE&&n?.source!==Y.CACHE&&(e.expiresAt=ii(),e.canonical_authority=this.canonicalAuthority);const r=this.cacheManager.generateAuthorityMetadataCacheKey(e.preferred_cache,this.correlationId);this.cacheManager.setAuthorityMetadata(r,e,this.correlationId),this.metadata=e}async updateEndpointMetadata(e){const t=this.updateEndpointMetadataFromLocalSources(e);if(t){if(t.source===Y.HARDCODED_VALUES&&this.authorityOptions.azureRegionConfiguration?.azureRegion&&t.metadata){const r=await u(this.updateMetadataWithRegionalInformation.bind(this),ei,this.logger,this.performanceClient,this.correlationId)(t.metadata);yt(e,r,!1),e.canonical_authority=this.canonicalAuthority}return t.source}let n=await u(this.getEndpointMetadataFromNetwork.bind(this),rh,this.logger,this.performanceClient,this.correlationId)();if(n)return this.authorityOptions.azureRegionConfiguration?.azureRegion&&(n=await u(this.updateMetadataWithRegionalInformation.bind(this),ei,this.logger,this.performanceClient,this.correlationId)(n)),yt(e,n,!0),Y.NETWORK;throw f(Ka,this.defaultOpenIdConfigurationEndpoint)}updateEndpointMetadataFromLocalSources(e){this.logger.verbose("1fi0kc",this.correlationId);const t=this.getEndpointMetadataFromConfig();if(t)return this.logger.verbose("06t0uj",this.correlationId),yt(e,t,!1),{source:Y.CONFIG};this.logger.verbose("151k0p",this.correlationId);const n=this.getEndpointMetadataFromHardcodedValues();if(n)return yt(e,n,!1),{source:Y.HARDCODED_VALUES,metadata:n};this.logger.verbose("1imop5",this.correlationId);const r=oi(e);return this.isAuthoritySameType(e)&&e.endpointsFromNetwork&&!r?(this.logger.verbose("16uq31",""),{source:Y.CACHE}):(r&&this.logger.verbose("0uoibc",""),null)}isAuthoritySameType(e){return new E(e.canonical_authority).getUrlComponents().PathSegments.length===this.canonicalAuthorityUrlComponents.PathSegments.length}getEndpointMetadataFromConfig(){if(this.authorityOptions.authorityMetadata)try{return JSON.parse(this.authorityOptions.authorityMetadata)}catch{throw v(Ra)}return null}async getEndpointMetadataFromNetwork(){const e={},t=this.defaultOpenIdConfigurationEndpoint;this.logger.verbose("1y65x6",this.correlationId);try{const n=await this.networkInterface.sendGetRequestAsync(t,e);return Ih(n.body)?n.body:(this.logger.verbose("1koyv8",this.correlationId),null)}catch{return this.logger.verbose("0a9wik",this.correlationId),null}}getEndpointMetadataFromHardcodedValues(){return this.hostnameAndPort in Qr?Qr[this.hostnameAndPort]:null}async updateMetadataWithRegionalInformation(e){const t=this.authorityOptions.azureRegionConfiguration?.azureRegion;if(t){if(t!==ys)return this.regionDiscoveryMetadata.region_outcome=nn.CONFIGURED_NO_AUTO_DETECTION,this.regionDiscoveryMetadata.region_used=t,K.replaceWithRegionalInformation(e,t);const n=await u(this.regionDiscovery.detectRegion.bind(this.regionDiscovery),oh,this.logger,this.performanceClient,this.correlationId)(this.authorityOptions.azureRegionConfiguration?.environmentRegion,this.regionDiscoveryMetadata);if(n)return this.regionDiscoveryMetadata.region_outcome=nn.AUTO_DETECTION_REQUESTED_SUCCESSFUL,this.regionDiscoveryMetadata.region_used=n,K.replaceWithRegionalInformation(e,n);this.regionDiscoveryMetadata.region_outcome=nn.AUTO_DETECTION_REQUESTED_FAILED}return e}async updateCloudDiscoveryMetadata(e){const t=this.updateCloudDiscoveryMetadataFromLocalSources(e);if(t)return t;const n=await u(this.getCloudDiscoveryMetadataFromNetwork.bind(this),th,this.logger,this.performanceClient,this.correlationId)();if(n)return on(e,n,!0),Y.NETWORK;throw v(Oa)}updateCloudDiscoveryMetadataFromLocalSources(e){this.logger.verbose("0jhlgt",this.correlationId),this.logger.verbosePii("1fy7uz",this.correlationId),this.logger.verbosePii("08zabj",this.correlationId),this.logger.verbosePii("1o1kv3",this.correlationId);const t=this.getCloudDiscoveryMetadataFromConfig();if(t)return this.logger.verbose("1nakio",this.correlationId),on(e,t,!1),Y.CONFIG;this.logger.verbose("1x74aj",this.correlationId);const n=Ac(this.hostnameAndPort);if(n)return this.logger.verbose("0by47c",this.correlationId),on(e,n,!1),Y.HARDCODED_VALUES;this.logger.verbose("0r2fzy",this.correlationId);const r=oi(e);return this.isAuthoritySameType(e)&&e.aliasesFromNetwork&&!r?(this.logger.verbose("1uffgh",""),Y.CACHE):(r&&this.logger.verbose("0uoibc",""),null)}getCloudDiscoveryMetadataFromConfig(){if(this.authorityType===q.Ciam)return this.logger.verbose("04y84h",this.correlationId),K.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort);if(this.authorityOptions.cloudDiscoveryMetadata){this.logger.verbose("0gszr3",this.correlationId);try{this.logger.verbose("1iifkx",this.correlationId);const e=JSON.parse(this.authorityOptions.cloudDiscoveryMetadata),t=Mt(e.metadata,this.hostnameAndPort);if(this.logger.verbose("0q67e3",""),t)return this.logger.verbose("0hzfao",this.correlationId),t;this.logger.verbose("1ajz3u",this.correlationId)}catch{throw this.logger.verbose("1wq5tu",this.correlationId),v($i)}}return this.isInKnownAuthorities()?(this.logger.verbose("0mt9al",this.correlationId),K.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)):null}async getCloudDiscoveryMetadataFromNetwork(){const e=`${us}${this.canonicalAuthority}oauth2/v2.0/authorize`,t={};let n=null;try{const r=await this.networkInterface.sendGetRequestAsync(e,t);let o,s;if(Th(r.body))o=r.body,s=o.metadata,this.logger.verbosePii("1vglyt",this.correlationId);else if(wh(r.body)){if(this.logger.warning("062uto",this.correlationId),o=r.body,o.error===ws)return this.logger.error("1x90tm",this.correlationId),null;this.logger.warning("0wchdm",this.correlationId),this.logger.warning("1s5mpv",this.correlationId),this.logger.warning("1yhqpw",this.correlationId),s=[]}else return this.logger.error("0768g0",this.correlationId),null;this.logger.verbose("1lrobr",this.correlationId),n=Mt(s,this.hostnameAndPort)}catch(r){return r instanceof _?this.logger.error("0vwhc7",this.correlationId):this.logger.error("0s2z41",this.correlationId),null}return n||(this.logger.warning("0jp28q",this.correlationId),this.logger.verbose("130sd8",this.correlationId),n=K.createCloudDiscoveryMetadataFromHost(this.hostnameAndPort)),n}isInKnownAuthorities(){return this.authorityOptions.knownAuthorities.filter(t=>t&&E.getDomainFromUrl(t).toLowerCase()===this.hostnameAndPort).length>0}static generateAuthority(e,t){let n;if(t&&t.azureCloudInstance!==Wn.None){const r=t.tenant?t.tenant:Ni;n=`${t.azureCloudInstance}/${r}/`}return n||e}static createCloudDiscoveryMetadataFromHost(e){return{preferred_network:e,preferred_cache:e,aliases:[e]}}getPreferredCache(){if(this.managedIdentity)return hs;if(this.discoveryComplete())return this.metadata.preferred_cache;throw f(de)}isAlias(e){return this.metadata.aliases.indexOf(e)>-1}isAliasOfKnownMicrosoftAuthority(e){return go.has(e)}static isPublicCloudAuthority(e){return Ts.indexOf(e)>=0}static buildRegionalAuthorityString(e,t,n){const r=new E(e);r.validateAsUri();const o=r.getUrlComponents();let s=`${t}.${o.HostNameAndPort}`;this.isPublicCloudAuthority(o.HostNameAndPort)&&(s=`${t}.${Is}`);const a=E.constructAuthorityUriFromObject({...r.getUrlComponents(),HostNameAndPort:s}).urlString;return n?`${a}?${n}`:a}static replaceWithRegionalInformation(e,t){const n={...e};return n.authorization_endpoint=K.buildRegionalAuthorityString(n.authorization_endpoint,t),n.token_endpoint=K.buildRegionalAuthorityString(n.token_endpoint,t),n.end_session_endpoint&&(n.end_session_endpoint=K.buildRegionalAuthorityString(n.end_session_endpoint,t)),n}static transformCIAMAuthority(e){let t=e;const r=new E(e).getUrlComponents();if(r.PathSegments.length===0&&r.HostNameAndPort.endsWith(Nr)){const o=r.HostNameAndPort.split(".")[0];t=`${t}${o}${gs}`}return t}}K.reservedTenantDomains=new Set(["{tenant}","{tenantid}",me.COMMON,me.CONSUMERS,me.ORGANIZATIONS]);function Ah(i){const n=new E(i).getUrlComponents().PathSegments.slice(-1)[0]?.toLowerCase();switch(n){case me.COMMON:case me.ORGANIZATIONS:case me.CONSUMERS:return;default:return n}}function ko(i){return i.endsWith(un)?i:`${i}${un}`}function Eh(i){const e=i.cloudDiscoveryMetadata;let t;if(e)try{t=JSON.parse(e)}catch{throw v($i)}return{canonicalAuthority:i.authority?ko(i.authority):void 0,knownAuthorities:i.knownAuthorities,cloudDiscoveryMetadata:t}}async function bo(i,e,t,n,r,o,s){const a=K.transformCIAMAuthority(ko(i)),c=new K(a,e,t,n,r,o,s);try{return await u(c.resolveEndpointsAsync.bind(c),eh,r,s,o)(),c}catch{throw f(de)}}class Ro{constructor(e,t){this.includeRedirectUri=!0,this.config=qn(e),this.logger=new te(this.config.loggerOptions,Vt,dt),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t,this.oidcDefaultScopes=this.config.authOptions.authority.options.OIDCOptions?.defaultScopes}async acquireToken(e,t,n){if(!e.code)throw f(Va);n&&n.cloud_instance_host_name&&await u(this.updateTokenEndpointAuthority.bind(this),Zc,this.logger,this.performanceClient,e.correlationId)(n.cloud_instance_host_name,e.correlationId);const r=re(),o=await u(this.executeTokenRequest.bind(this),Xc,this.logger,this.performanceClient,e.correlationId)(this.authority,e,this.serverTelemetryManager),s=o.headers?.[H.X_MS_REQUEST_ID],a=new be(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return a.validateTokenResponse(o.body,e.correlationId),u(a.handleServerTokenResponse.bind(a),tr,this.logger,this.performanceClient,e.correlationId)(o.body,this.authority,r,e,t,n,void 0,void 0,void 0,s)}getLogoutUri(e){if(!e)throw v(ba);const t=this.createLogoutUrlQueryString(e);return E.appendQueryString(this.authority.endSessionEndpoint,t)}async executeTokenRequest(e,t,n){const r=_o(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),o=E.appendQueryString(e.tokenEndpoint,r),s=await u(this.createTokenRequestBody.bind(this),qc,this.logger,this.performanceClient,t.correlationId)(t);let a;if(t.clientInfo)try{const l=Ut(t.clientInfo,this.cryptoUtils.base64Decode);a={credential:`${l.uid}${gn}${l.utid}`,type:Z.HOME_ACCOUNT_ID}}catch{this.logger.verbose("0wznt3",t.correlationId)}const c=So(this.logger,this.config.systemOptions.preventCorsPreflight,a||t.ccsCredential),h=Jt(this.config.authOptions.clientId,t);return u(vo,$c,this.logger,this.performanceClient,t.correlationId)(o,s,c,h,t.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,n)}async createTokenRequestBody(e){const t=new Map;if(Kn(t,e.embeddedClientId||e.extraParameters?.[ve]||this.config.authOptions.clientId),this.includeRedirectUri)Fn(t,e.redirectUri);else if(!e.redirectUri)throw v(Ea);if(Hn(t,e.scopes,!0,this.oidcDefaultScopes),sc(t,e.code),jn(t,this.config.libraryInfo),Gn(t,this.config.telemetry.application),co(t),this.serverTelemetryManager&&!Co(this.config)&&ao(t,this.serverTelemetryManager),e.codeVerifier&&cc(t,e.codeVerifier),this.config.clientCredentials.clientSecret&&to(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const r=this.config.clientCredentials.clientAssertion;no(t,await Eo(r.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),ro(t,r.assertionType)}if(io(t,Di.AUTHORIZATION_CODE_GRANT),$n(t),e.authenticationScheme===S.POP){const r=new Je(this.cryptoUtils,this.performanceClient);let o;e.popKid?o=this.cryptoUtils.encodeKid(e.popKid):o=(await u(r.generateCnf.bind(r),gt,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Jn(t,o)}else if(e.authenticationScheme===S.SSH)if(e.sshJwk)so(t,e.sshJwk);else throw v(Ln);(!W.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Bn(t,e.claims,this.config.authOptions.clientCapabilities);let n;if(e.clientInfo)try{const r=Ut(e.clientInfo,this.cryptoUtils.base64Decode);n={credential:`${r.uid}${gn}${r.utid}`,type:Z.HOME_ACCOUNT_ID}}catch{this.logger.verbose("0wznt3",e.correlationId)}else n=e.ccsCredential;if(this.config.systemOptions.preventCorsPreflight&&n)switch(n.type){case Z.HOME_ACCOUNT_ID:try{const r=ze(n.credential);rt(t,r)}catch{this.logger.verbose("1qhtee",e.correlationId)}break;case Z.UPN:Ot(t,n.credential);break}return e.embeddedClientId&&Gt(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&se(t,e.extraParameters),e.enableSpaAuthorizationCode&&(!e.extraParameters||!e.extraParameters[Br])&&se(t,{[Br]:"1"}),jt(t,e.correlationId,this.performanceClient),at(t)}createLogoutUrlQueryString(e){const t=new Map;return e.postLogoutRedirectUri&&tc(t,e.postLogoutRedirectUri),e.correlationId&&zn(t,e.correlationId),e.idTokenHint&&nc(t,e.idTokenHint),e.state&&eo(t,e.state),e.logoutHint&&lc(t,e.logoutHint),e.extraQueryParameters&&se(t,e.extraQueryParameters),this.config.authOptions.instanceAware&&oo(t),at(t)}async updateTokenEndpointAuthority(e,t){const n=`https://${e}/${this.authority.tenant}/`,r=await bo(n,this.networkClient,this.cacheManager,this.authority.options,this.logger,t,this.performanceClient);this.authority=r}}const Sh=300;class _h{constructor(e,t){this.config=qn(e),this.logger=new te(this.config.loggerOptions,Vt,dt),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireToken(e,t){const n=re(),r=await u(this.executeTokenRequest.bind(this),Jc,this.logger,this.performanceClient,e.correlationId)(e,this.authority),o=r.headers?.[H.X_MS_REQUEST_ID],s=new be(this.config.authOptions.clientId,this.cacheManager,this.cryptoUtils,this.logger,this.performanceClient,this.config.serializableCache,this.config.persistencePlugin);return s.validateTokenResponse(r.body,e.correlationId),u(s.handleServerTokenResponse.bind(s),tr,this.logger,this.performanceClient,e.correlationId)(r.body,this.authority,n,e,t,void 0,void 0,!0,e.forceCache,o)}async acquireTokenByRefreshToken(e,t){if(!e)throw v(ka);if(!e.account)throw f(Yi);if(this.cacheManager.isAppMetadataFOCI(e.account.environment,e.correlationId))try{return await u(this.acquireTokenWithCachedRefreshToken.bind(this),rn,this.logger,this.performanceClient,e.correlationId)(e,!0,t)}catch(r){const o=r instanceof ne&&r.errorCode===Tn,s=r instanceof Me&&r.errorCode===Hs&&r.subError===Ks;if(o||s)return u(this.acquireTokenWithCachedRefreshToken.bind(this),rn,this.logger,this.performanceClient,e.correlationId)(e,!1,t);throw r}return u(this.acquireTokenWithCachedRefreshToken.bind(this),rn,this.logger,this.performanceClient,e.correlationId)(e,!1,t)}async acquireTokenWithCachedRefreshToken(e,t,n){const r=ee(this.cacheManager.getRefreshToken.bind(this.cacheManager),ah,this.logger,this.performanceClient,e.correlationId)(e.account,t,e.correlationId,void 0);if(!r)throw Dt(Tn);if(r.expiresOn){const s=e.refreshTokenExpirationOffsetSeconds||Sh;if(this.performanceClient?.addFields({cacheRtExpiresOnSeconds:Number(r.expiresOn),rtOffsetSeconds:s},e.correlationId),Lt(r.expiresOn,s))throw Dt(yo)}const o={...e,refreshToken:r.secret,authenticationScheme:e.authenticationScheme||S.BEARER,ccsCredential:{credential:e.account.homeAccountId,type:Z.HOME_ACCOUNT_ID}};try{return await u(this.acquireToken.bind(this),Wc,this.logger,this.performanceClient,e.correlationId)(o,n)}catch(s){if(s instanceof ne&&s.subError===Zn){this.logger.verbose("1pg3ap",e.correlationId);const a=this.cacheManager.generateCredentialKey(r);this.cacheManager.removeRefreshToken(a,e.correlationId)}throw s}}async executeTokenRequest(e,t){const n=_o(e,this.config.authOptions.clientId,this.config.authOptions.redirectUri,this.performanceClient),r=E.appendQueryString(t.tokenEndpoint,n),o=await u(this.createTokenRequestBody.bind(this),Qc,this.logger,this.performanceClient,e.correlationId)(e),s=So(this.logger,this.config.systemOptions.preventCorsPreflight,e.ccsCredential),a=Jt(this.config.authOptions.clientId,e);return u(vo,Vc,this.logger,this.performanceClient,e.correlationId)(r,o,s,a,e.correlationId,this.cacheManager,this.networkClient,this.logger,this.performanceClient,this.serverTelemetryManager)}async createTokenRequestBody(e){const t=new Map;if(Kn(t,e.embeddedClientId||e.extraParameters?.[ve]||this.config.authOptions.clientId),e.redirectUri&&Fn(t,e.redirectUri),Hn(t,e.scopes,!0,this.config.authOptions.authority.options.OIDCOptions?.defaultScopes),io(t,Di.REFRESH_TOKEN_GRANT),$n(t),jn(t,this.config.libraryInfo),Gn(t,this.config.telemetry.application),co(t),this.serverTelemetryManager&&!Co(this.config)&&ao(t,this.serverTelemetryManager),ac(t,e.refreshToken),this.config.clientCredentials.clientSecret&&to(t,this.config.clientCredentials.clientSecret),this.config.clientCredentials.clientAssertion){const n=this.config.clientCredentials.clientAssertion;no(t,await Eo(n.assertion,this.config.authOptions.clientId,e.resourceRequestUri)),ro(t,n.assertionType)}if(e.authenticationScheme===S.POP){const n=new Je(this.cryptoUtils,this.performanceClient);let r;e.popKid?r=this.cryptoUtils.encodeKid(e.popKid):r=(await u(n.generateCnf.bind(n),gt,this.logger,this.performanceClient,e.correlationId)(e,this.logger)).reqCnfString,Jn(t,r)}else if(e.authenticationScheme===S.SSH)if(e.sshJwk)so(t,e.sshJwk);else throw v(Ln);if((!W.isEmptyObj(e.claims)||this.config.authOptions.clientCapabilities&&this.config.authOptions.clientCapabilities.length>0)&&Bn(t,e.claims,this.config.authOptions.clientCapabilities),this.config.systemOptions.preventCorsPreflight&&e.ccsCredential)switch(e.ccsCredential.type){case Z.HOME_ACCOUNT_ID:try{const n=ze(e.ccsCredential.credential);rt(t,n)}catch{this.logger.verbose("1qhtee",e.correlationId)}break;case Z.UPN:Ot(t,e.ccsCredential.credential);break}return e.embeddedClientId&&Gt(t,this.config.authOptions.clientId,this.config.authOptions.redirectUri),e.extraParameters&&se(t,{...e.extraParameters}),jt(t,e.correlationId,this.performanceClient),at(t)}}class vh{constructor(e,t){this.config=qn(e),this.logger=new te(this.config.loggerOptions,Vt,dt),this.cryptoUtils=this.config.cryptoInterface,this.cacheManager=this.config.storageInterface,this.networkClient=this.config.networkInterface,this.serverTelemetryManager=this.config.serverTelemetryManager,this.authority=this.config.authOptions.authority,this.performanceClient=t}async acquireCachedToken(e){let t=we.NOT_APPLICABLE;if(e.forceRefresh||!W.isEmptyObj(e.claims))throw this.setCacheOutcome(we.FORCE_REFRESH_OR_CLAIMS,e.correlationId),f(Ee);if(!e.account)throw f(Yi);const n=e.account.tenantId||Ah(e.authority),r=this.cacheManager.getTokenKeys(),o=this.cacheManager.getAccessToken(e.account,e,r,n);if(o){if(jc(o.cachedAt)||Lt(o.expiresOn,this.config.systemOptions.tokenRenewalOffsetSeconds))throw this.setCacheOutcome(we.CACHED_ACCESS_TOKEN_EXPIRED,e.correlationId),f(Ee);o.refreshOn&&Lt(o.refreshOn,0)&&(t=we.PROACTIVELY_REFRESHED)}else throw this.setCacheOutcome(we.NO_CACHED_ACCESS_TOKEN,e.correlationId),f(Ee);const s=e.authority||this.authority.getPreferredCache(),a={account:this.cacheManager.getAccount(this.cacheManager.generateAccountKey(e.account),e.correlationId),accessToken:o,idToken:this.cacheManager.getIdToken(e.account,e.correlationId,r,n),refreshToken:null,appMetadata:this.cacheManager.readAppMetadataFromCache(s,e.correlationId)};return this.setCacheOutcome(t,e.correlationId),this.config.serverTelemetryManager&&this.config.serverTelemetryManager.incrementCacheHits(),[await u(this.generateResultFromCacheRecord.bind(this),Yc,this.logger,this.performanceClient,e.correlationId)(a,e),t]}setCacheOutcome(e,t){this.serverTelemetryManager?.setCacheOutcome(e),this.performanceClient?.addFields({cacheOutcome:e},t),e!==we.NOT_APPLICABLE&&this.logger.info("09ingz",t)}async generateResultFromCacheRecord(e,t){let n;if(e.idToken&&(n=ae(e.idToken.secret,this.config.cryptoInterface.base64Decode)),t.maxAge||t.maxAge===0){const r=n?.auth_time;if(!r)throw f(Qi);lo(r,t.maxAge)}return be.generateAuthenticationResult(this.cryptoUtils,this.authority,e,!0,t,this.performanceClient,n)}}const kh={sendGetRequestAsync:()=>Promise.reject(f(T)),sendPostRequestAsync:()=>Promise.reject(f(T))};function bh(i,e,t,n){const r=e.correlationId,o=new Map;Kn(o,e.embeddedClientId||e.extraQueryParameters?.[ve]||i.clientId);const s=[...e.scopes||[],...e.extraScopesToConsent||[]];if(Hn(o,s,!0,i.authority.options.OIDCOptions?.defaultScopes),Fn(o,e.redirectUri),zn(o,r),Za(o,e.responseMode),$n(o),e.prompt&&(ic(o,e.prompt),n?.addFields({prompt:e.prompt},r)),e.domainHint&&(rc(o,e.domainHint),n?.addFields({domainHintFromRequest:!0},r)),e.prompt!==F.SELECT_ACCOUNT)if(e.sid&&e.prompt===F.NONE)t.verbose("1tvqyx",e.correlationId),Vr(o,e.sid),n?.addFields({sidFromRequest:!0},r);else if(e.account){const a=Ph(e.account);let c=Nh(e.account);if(c&&e.domainHint&&(t.warning("0wkg3v",e.correlationId),c=null),c){t.verbose("1eyfsw",e.correlationId),Ct(o,c),n?.addFields({loginHintFromClaim:!0},r);try{const h=ze(e.account.homeAccountId);rt(o,h)}catch{t.verbose("12ugck",e.correlationId)}}else if(a&&e.prompt===F.NONE){t.verbose("1rmd8s",e.correlationId),Vr(o,a),n?.addFields({sidFromClaim:!0},r);try{const h=ze(e.account.homeAccountId);rt(o,h)}catch{t.verbose("12ugck",e.correlationId)}}else if(e.loginHint)t.verbose("0y3007",e.correlationId),Ct(o,e.loginHint),Ot(o,e.loginHint),n?.addFields({loginHintFromRequest:!0},r);else if(e.account.username){t.verbose("02f507",e.correlationId),Ct(o,e.account.username),n?.addFields({loginHintFromUpn:!0},r);try{const h=ze(e.account.homeAccountId);rt(o,h)}catch{t.verbose("12ugck",e.correlationId)}}}else e.loginHint&&(t.verbose("0g01ey",e.correlationId),Ct(o,e.loginHint),Ot(o,e.loginHint),n?.addFields({loginHintFromRequest:!0},r));else t.verbose("169k9v",e.correlationId);return e.nonce&&oc(o,e.nonce),e.state&&eo(o,e.state),(e.claims||i.clientCapabilities&&i.clientCapabilities.length>0)&&Bn(o,e.claims,i.clientCapabilities),e.embeddedClientId&&Gt(o,i.clientId,i.redirectUri),i.instanceAware&&(!e.extraQueryParameters||!Object.keys(e.extraQueryParameters).includes(pn))&&oo(o),o}function ir(i,e){const t=at(e);return E.appendQueryString(i.authorizationEndpoint,t)}function Rh(i,e){if(Oo(i,e),!i.code)throw f(Ya);return i}function Oo(i,e){if(!i.state||!e)throw i.state?f(zr,"Cached State"):f(zr,"Server State");let t,n;try{t=decodeURIComponent(i.state)}catch{throw f(st,i.state)}try{n=decodeURIComponent(e)}catch{throw f(st,i.state)}if(t!==n)throw f(Ba);if(i.error||i.error_description||i.suberror){const r=Oh(i);throw To(i.error,i.error_description,i.suberror)?new ne(i.error||"",i.error_description,i.suberror,i.timestamp||"",i.trace_id||"",i.correlation_id||"",i.claims||"",r):new Me(i.error||"",i.error_description,i.suberror,r)}}function Oh(i){const e="code=",t=i.error_uri?.lastIndexOf(e);return t&&t>=0?i.error_uri?.substring(t+e.length):void 0}function Ph(i){return i.idTokenClaims?.sid||null}function Nh(i){return i.loginHint||i.idTokenClaims?.login_hint||null}const wn="unexpected_error";const si=",",Po="|";function Mh(i){const{skus:e,libraryName:t,libraryVersion:n,extensionName:r,extensionVersion:o}=i,s=new Map([[0,[t,n]],[2,[r,o]]]);let a=[];if(e?.length){if(a=e.split(si),a.length<4)return e}else a=Array.from({length:4},()=>Po);return s.forEach((c,h)=>{c.length===2&&c[0]?.length&&c[1]?.length&&Uh({skuArr:a,index:h,skuName:c[0],skuVersion:c[1]})}),a.join(si)}function Uh(i){const{skuArr:e,index:t,skuName:n,skuVersion:r}=i;t>=e.length||(e[t]=[n,r].join(Po))}class ct{constructor(e,t){this.cacheOutcome=we.NOT_APPLICABLE,this.cacheManager=t,this.apiId=e.apiId,this.correlationId=e.correlationId,this.wrapperSKU=e.wrapperSKU||"",this.wrapperVer=e.wrapperVer||"",this.telemetryCacheKey=Hi+xi+e.clientId}generateCurrentRequestHeaderValue(){const e=`${this.apiId}${Le}${this.cacheOutcome}`,t=[this.wrapperSKU,this.wrapperVer],n=this.getNativeBrokerErrorCode();n?.length&&t.push(`broker_error=${n}`);const r=t.join(Le),o=this.getRegionDiscoveryFields(),s=[e,o].join(Le);return[Kr,s,r].join(Fr)}generateLastRequestHeaderValue(){const e=this.getLastRequests(),t=ct.maxErrorsToSend(e),n=e.failedRequests.slice(0,2*t).join(Le),r=e.errors.slice(0,t).join(Le),o=e.errors.length,s=t<o?Ns:Ms,a=[o,s].join(Le);return[Kr,e.cacheHits,n,r,a].join(Fr)}cacheFailedRequest(e){const t=this.getLastRequests();t.errors.length>=Ps&&(t.failedRequests.shift(),t.failedRequests.shift(),t.errors.shift()),t.failedRequests.push(this.apiId,this.correlationId),e instanceof Error&&e&&e.toString()?e instanceof _?e.subError?t.errors.push(e.subError):e.errorCode?t.errors.push(e.errorCode):t.errors.push(e.toString()):t.errors.push(e.toString()):t.errors.push(Us),this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}incrementCacheHits(){const e=this.getLastRequests();return e.cacheHits+=1,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId),e.cacheHits}getLastRequests(){const e={failedRequests:[],errors:[],cacheHits:0};return this.cacheManager.getServerTelemetry(this.telemetryCacheKey,this.correlationId)||e}clearTelemetryCache(){const e=this.getLastRequests(),t=ct.maxErrorsToSend(e),n=e.errors.length;if(t===n)this.cacheManager.removeItem(this.telemetryCacheKey,this.correlationId);else{const r={failedRequests:e.failedRequests.slice(t*2),errors:e.errors.slice(t),cacheHits:0};this.cacheManager.setServerTelemetry(this.telemetryCacheKey,r,this.correlationId)}}static maxErrorsToSend(e){let t,n=0,r=0;const o=e.errors.length;for(t=0;t<o;t++){const s=e.failedRequests[2*t]||"",a=e.failedRequests[2*t+1]||"",c=e.errors[t]||"";if(r+=s.toString().length+a.toString().length+c.length+3,r<Os)n+=1;else break}return n}getRegionDiscoveryFields(){const e=[];return e.push(this.regionUsed||""),e.push(this.regionSource||""),e.push(this.regionOutcome||""),e.join(",")}updateRegionDiscoveryMetadata(e){this.regionUsed=e.region_used,this.regionSource=e.region_source,this.regionOutcome=e.region_outcome}setCacheOutcome(e){this.cacheOutcome=e}setNativeBrokerErrorCode(e){const t=this.getLastRequests();t.nativeBrokerErrorCode=e,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,t,this.correlationId)}getNativeBrokerErrorCode(){return this.getLastRequests().nativeBrokerErrorCode}clearNativeBrokerErrorCode(){const e=this.getLastRequests();delete e.nativeBrokerErrorCode,this.cacheManager.setServerTelemetry(this.telemetryCacheKey,e,this.correlationId)}static makeExtraSkuString(e){return Mh(e)}}class or extends _{constructor(e,t){super(e,t),this.name="JoseHeaderError",Object.setPrototypeOf(this,or.prototype)}}function ai(i){return new or(i)}const Dh="missing_kid_error",Lh="missing_alg_error";class sr{constructor(e){this.typ=e.typ,this.alg=e.alg,this.kid=e.kid}static getShrHeaderString(e){if(!e.kid)throw ai(Dh);if(!e.alg)throw ai(Lh);const t=new sr({typ:e.typ||Fs.Pop,kid:e.kid,alg:e.alg});return JSON.stringify(t)}}function Yt(i){return`See https://aka.ms/msal.js.errors#${i} for details`}class ft extends _{constructor(e,t){super(e,Yt(e),t),Object.setPrototypeOf(this,ft.prototype),this.name="BrowserAuthError"}}function m(i,e){return new ft(i,e)}const $={INVALID_GRANT_ERROR:"invalid_grant",POPUP_WIDTH:483,POPUP_HEIGHT:600,POPUP_NAME_PREFIX:"msal",MSAL_SKU:"msal.js.browser"},J={CHANNEL_ID:"53ee284d-920a-4b59-9d30-a60315b26836",PREFERRED_EXTENSION_ID:"ppnbnpeolgkicgegkbkbjmhlideopiji",MATS_TELEMETRY:"MATS",MICROSOFT_ENTRA_BROKERID:"MicrosoftEntra",DOM_API_NAME:"DOM API",PLATFORM_DOM_APIS:"get-token-and-sign-out",PLATFORM_DOM_PROVIDER:"PlatformAuthDOMHandler",PLATFORM_EXTENSION_PROVIDER:"PlatformAuthExtensionHandler"},et={HandshakeRequest:"Handshake",HandshakeResponse:"HandshakeResponse",GetToken:"GetToken",Response:"Response"},Q={LocalStorage:"localStorage",SessionStorage:"sessionStorage",MemoryStorage:"memoryStorage"},ci={GET:"GET",POST:"POST"},ge={SIGNIN:"signin",SIGNOUT:"signout"},R={ORIGIN_URI:"request.origin",URL_HASH:"urlHash",REQUEST_PARAMS:"request.params",VERIFIER:"code.verifier",INTERACTION_STATUS_KEY:"interaction.status",NATIVE_REQUEST:"request.native"},It={WRAPPER_SKU:"wrapper.sku",WRAPPER_VER:"wrapper.version"},w={acquireTokenRedirect:861,acquireTokenPopup:862,ssoSilent:863,acquireTokenSilent_authCode:864,handleRedirectPromise:865,acquireTokenByCode:866,acquireTokenSilent_silentFlow:61,logout:961,logoutPopup:962,hydrateCache:963,loadExternalTokens:964},hi={861:"acquireTokenRedirect",862:"acquireTokenPopup",863:"ssoSilent",864:"acquireTokenSilent_authCode",865:"handleRedirectPromise",866:"acquireTokenByCode",61:"acquireTokenSilent_silentFlow",961:"logout",962:"logoutPopup",963:"hydrateCache",964:"loadExternalTokens"},xh=i=>typeof i=="number"&&i in hi?hi[i]:"unknown";var C;(function(i){i.Redirect="redirect",i.Popup="popup",i.Silent="silent",i.None="none"})(C||(C={}));const Hh={None:"none"},li={scopes:Qe},No="jwk",An="msal.db",Kh=1,Fh=`${An}.keys`,x={Default:0,AccessToken:1,AccessTokenAndRefreshToken:2,RefreshToken:3,RefreshTokenAndNetwork:4,Skip:5},Bh=[x.Default,x.Skip,x.RefreshTokenAndNetwork];function Tt(i){return encodeURIComponent(ht(i).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"))}function Ie(i){return Mo(i).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ht(i){return Mo(new TextEncoder().encode(i))}function Mo(i){const e=Array.from(i,t=>String.fromCodePoint(t)).join("");return btoa(e)}const Uo="pkce_not_created",Do="ear_jwk_empty",zh="ear_jwe_empty",di="crypto_nonexistent",ar="empty_navigate_uri",jh="hash_empty_error",cr="no_state_in_hash",Gh="hash_does_not_contain_known_properties",Lo="unable_to_parse_state",Vh="state_interaction_type_mismatch",$h="interaction_in_progress",Jh="interaction_in_progress_cancelled",Wh="popup_window_error",Qh="empty_window_error",En="user_cancelled",Yh="redirect_bridge_empty_response",Xh="redirect_in_iframe",qh="block_iframe_reload",Zh="block_nested_popups",hr="silent_logout_unsupported",el="no_account_error",tl="no_token_request_cache_error",nl="unable_to_parse_token_request_cache_error",xo="non_browser_environment",tt="database_not_open",Sn="no_network_connectivity",rl="post_request_failed",il="get_request_failed",ui="failed_to_parse_response",Ho="crypto_key_not_found",ol="auth_code_required",sl="auth_code_or_nativeAccountId_required",al="spa_code_and_nativeAccountId_present",Ko="database_unavailable",cl="unable_to_acquire_token_from_native_platform",hl="native_handshake_timeout",ll="native_extension_not_installed",Fo="native_connection_not_established",Et="uninitialized_public_client_application",dl="native_prompt_not_supported",ul="invalid_base64_string",gl="invalid_pop_token_request",fl="failed_to_build_headers",pl="failed_to_parse_headers",sn="failed_to_decrypt_ear_response",xt="timed_out",ml="empty_response";function V(i){return new TextDecoder().decode(Ce(i))}function Ce(i){let e=i.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw m(ul)}const t=atob(e);return Uint8Array.from(t,n=>n.codePointAt(0)||0)}const Cl="RSASSA-PKCS1-v1_5",Xe="AES-GCM",Bo="HKDF",lr="SHA-256",yl=2048,Il=new Uint8Array([1,0,1]),gi="0123456789abcdef",fi=new Uint32Array(1),dr="raw",zo="encrypt",ur="decrypt",Tl="deriveKey",wl="crypto_subtle_undefined",gr={name:Cl,hash:lr,modulusLength:yl,publicExponent:Il};function Al(i){if(!window)throw m(xo);if(!window.crypto)throw m(di);if(!i&&!window.crypto.subtle)throw m(di,wl)}async function jo(i){const t=new TextEncoder().encode(i);return window.crypto.subtle.digest(lr,t)}function El(i){return window.crypto.getRandomValues(i)}function an(){return window.crypto.getRandomValues(fi),fi[0]}function Re(){const i=Date.now(),e=an()*1024+(an()&1023),t=new Uint8Array(16),n=Math.trunc(e/2**30),r=e&2**30-1,o=an();t[0]=i/2**40,t[1]=i/2**32,t[2]=i/2**24,t[3]=i/2**16,t[4]=i/2**8,t[5]=i,t[6]=112|n>>>8,t[7]=n,t[8]=128|r>>>24,t[9]=r>>>16,t[10]=r>>>8,t[11]=r,t[12]=o>>>24,t[13]=o>>>16,t[14]=o>>>8,t[15]=o;let s="";for(let a=0;a<t.length;a++)s+=gi.charAt(t[a]>>>4),s+=gi.charAt(t[a]&15),(a===3||a===5||a===7||a===9)&&(s+="-");return s}async function Sl(i,e){return window.crypto.subtle.generateKey(gr,i,e)}async function cn(i){return window.crypto.subtle.exportKey(No,i)}async function _l(i,e,t){return window.crypto.subtle.importKey(No,i,gr,e,t)}async function vl(i,e){return window.crypto.subtle.sign(gr,i,e)}async function fr(){const i=await Go(),t={alg:"dir",kty:"oct",k:Ie(new Uint8Array(i))};return ht(JSON.stringify(t))}async function kl(i){const e=V(i),n=JSON.parse(e).k,r=Ce(n);return window.crypto.subtle.importKey(dr,r,Xe,!1,[ur])}async function bl(i,e){const t=e.split(".");if(t.length!==5)throw m(sn,"jwe_length");const n=await kl(i).catch(()=>{throw m(sn,"import_key")});try{const r=new TextEncoder().encode(t[0]),o=Ce(t[2]),s=Ce(t[3]),a=Ce(t[4]),c=a.byteLength*8,h=new Uint8Array(s.length+a.length);h.set(s),h.set(a,s.length);const l=await window.crypto.subtle.decrypt({name:Xe,iv:o,tagLength:c,additionalData:r},n,h);return new TextDecoder().decode(l)}catch{throw m(sn,"decrypt")}}async function Go(){const i=await window.crypto.subtle.generateKey({name:Xe,length:256},!0,[zo,ur]);return window.crypto.subtle.exportKey(dr,i)}async function pi(i){return window.crypto.subtle.importKey(dr,i,Bo,!1,[Tl])}async function Vo(i,e,t){return window.crypto.subtle.deriveKey({name:Bo,salt:e,hash:lr,info:new TextEncoder().encode(t)},i,{name:Xe,length:256},!1,[zo,ur])}async function Rl(i,e,t){const n=new TextEncoder().encode(e),r=window.crypto.getRandomValues(new Uint8Array(16)),o=await Vo(i,r,t),s=await window.crypto.subtle.encrypt({name:Xe,iv:new Uint8Array(12)},o,n);return{data:Ie(new Uint8Array(s)),nonce:Ie(r)}}async function mi(i,e,t,n){const r=Ce(n),o=await Vo(i,Ce(e),t),s=await window.crypto.subtle.decrypt({name:Xe,iv:new Uint8Array(12)},o,r);return new TextDecoder().decode(s)}async function Ol(i){const e=await jo(i),t=new Uint8Array(e);return Ie(t)}class pr extends _{constructor(e,t){super(e,t),this.name="BrowserConfigurationAuthError",Object.setPrototypeOf(this,pr.prototype)}}function P(i){return new pr(i,Yt(i))}const $o="storage_not_supported",L="stubbed_public_client_application_called",Pl="in_mem_redirect_unavailable";function Nl(){const i=window.location.hash,e=window.location.search;let t=!1,n=!1,r="",o;if(i&&i.length>1){const l=i.charAt(0)==="#"?i.substring(1):i,d=new URLSearchParams(l);d.has("state")&&(t=!0,r=l,o=d)}if(e&&e.length>1){const l=e.charAt(0)==="?"?e.substring(1):e,d=new URLSearchParams(l);d.has("state")&&(n=!0,r=l,o=d)}if(t&&n){const l=e.charAt(0)==="?"?e.substring(1):e,d=i.charAt(0)==="#"?i.substring(1):i;r=`${l}${d}`,o=new URLSearchParams(r)}if(!r||!o)throw m(ml);const s=o.get("state");if(!s)throw m(cr);const{libraryState:a}=ut(V,s),{id:c,meta:h}=a;if(!c||!h)throw m(Lo,"missing_library_state");return{params:o,payload:r,urlHash:i,urlQuery:e,hasResponseInHash:t,hasResponseInQuery:n,libraryState:{id:c,meta:h}}}function Jo(i){i.location.hash="",typeof i.history.replaceState=="function"&&i.history.replaceState(null,"",`${i.location.origin}${i.location.pathname}${i.location.search}`)}function Ml(i){const e=i.split("#");e.shift(),window.location.hash=e.length>0?e.join("#"):""}function Xt(){return window.parent!==window}function Ul(){if(Xt())return!1;try{const{libraryState:i}=Nl(),{meta:e}=i;return e.interactionType===C.Popup}catch{return!1}}let fe=null;function Dl(i,e){fe&&(i.verbose("18y01k",e),clearTimeout(fe.timeoutId),fe.channel.close(),fe.reject(m(Jh)),fe=null)}async function Ke(i,e,t,n){return new Promise((r,o)=>{e.verbose("1rf6em",n.correlationId);const{libraryState:s}=ut(t.base64Decode,n.state||""),a=new BroadcastChannel(s.id);let c;const h=window.setTimeout(()=>{fe=null,a.close(),o(m(xt,"redirect_bridge_timeout"))},i);fe={timeoutId:h,channel:a,reject:o},a.onmessage=l=>{c=l.data.payload,fe=null,clearTimeout(h),a.close(),c?r(c):o(m(Yh))}})}function pe(){return typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:""}function Ll(){const e=new E(window.location.href).getUrlComponents();return`${e.Protocol}//${e.HostNameAndPort}/`}function xl(){if(Pt(window.location.hash)&&Xt())throw m(qh)}function Hl(i){if(Xt()&&!i)throw m(Xh)}function Kl(){if(Ul())throw m(Zh)}function Wo(){if(typeof window>"u")throw m(xo)}function Qo(i){if(!i)throw m(Et)}function mr(i){Wo(),xl(),Kl(),Qo(i)}function Ci(i,e){if(mr(i),Hl(e.system.allowRedirectInIframe),e.cache.cacheLocation===Q.MemoryStorage)throw P(Pl)}function Yo(i){const e=document.createElement("link");e.rel="preconnect",e.href=new URL(i).origin,e.crossOrigin="anonymous",document.head.appendChild(e),window.setTimeout(()=>{try{document.head.removeChild(e)}catch{}},1e4)}function _n(){return Re()}const Fl="acquireTokenFromCache",Bl="acquireTokenByRefreshToken",zl="acquireTokenSilentAsync",jl="cryptoOptsGetPublicKeyThumbprint",Gl="cryptoOptsSignJwt",Vl="silentCacheClientAcquireToken",$l="silentIframeClientAcquireToken",Jl="awaitConcurrentIframe",Wl="silentRefreshClientAcquireToken",_e="standardInteractionClientGetDiscoveredAuthority",Xo="nativeInteractionClientAcquireToken",Ql="refreshTokenClientAcquireTokenByRefreshToken",yi="acquireTokenBySilentIframe",Cr="initializeBaseRequest",Yl="initializeSilentRequest",Xl="initializeCache",Ii="silentIframeClientTokenHelper",hn="silentHandlerInitiateAuthRequest",Ht="silentHandlerMonitorIframeForHash",ql="silentHandlerLoadFrameSync",ye="standardInteractionClientCreateAuthCodeClient",qt="standardInteractionClientGetClientConfiguration",Zt="standardInteractionClientInitializeAuthorizationRequest",Zl="silentFlowClientAcquireCachedToken",ed="getStandardParams",td="handleCodeResponse",yr="handleResponseEar",qo="handleResponsePlatformBroker",je="handleResponseCode",nd="authClientAcquireToken",it="deserializeResponse",rd="authorityFactoryCreateDiscoveredInstance",id="acquireTokenByCodeAsync",od="handleRedirectPromise",sd="handleNativeRedirectPromise",ad="nativeMessageHandlerHandshake",cd="importExistingCache",Oe="generatePkceCodes",hd="generateCodeVerifier",ld="generateCodeChallengeFromVerifier",dd="sha256Digest",ud="getRandomValues",Ti="generateHKDF",gd="generateBaseKey",fd="base64Decode",pd="urlEncodeArr",md="encrypt",wi="decrypt",Ir="generateEarKey",Cd="decryptEarResponse";class yd{constructor(){this.dbName=An,this.version=Kh,this.tableName=Fh,this.dbOpen=!1}async open(){return new Promise((e,t)=>{const n=window.indexedDB.open(this.dbName,this.version);n.addEventListener("upgradeneeded",r=>{r.target.result.createObjectStore(this.tableName)}),n.addEventListener("success",r=>{const o=r;this.db=o.target.result,this.dbOpen=!0,e()}),n.addEventListener("error",()=>t(m(Ko)))})}closeConnection(){const e=this.db;e&&this.dbOpen&&(e.close(),this.dbOpen=!1)}async validateDbIsOpen(){if(!this.dbOpen)return this.open()}async getItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(m(tt));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).get(e);s.addEventListener("success",a=>{const c=a;this.closeConnection(),t(c.target.result)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async setItem(e,t){return await this.validateDbIsOpen(),new Promise((n,r)=>{if(!this.db)return r(m(tt));const a=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).put(t,e);a.addEventListener("success",()=>{this.closeConnection(),n()}),a.addEventListener("error",c=>{this.closeConnection(),r(c)})})}async removeItem(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(m(tt));const s=this.db.transaction([this.tableName],"readwrite").objectStore(this.tableName).delete(e);s.addEventListener("success",()=>{this.closeConnection(),t()}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async getKeys(){return await this.validateDbIsOpen(),new Promise((e,t)=>{if(!this.db)return t(m(tt));const o=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).getAllKeys();o.addEventListener("success",s=>{const a=s;this.closeConnection(),e(a.target.result)}),o.addEventListener("error",s=>{this.closeConnection(),t(s)})})}async containsKey(e){return await this.validateDbIsOpen(),new Promise((t,n)=>{if(!this.db)return n(m(tt));const s=this.db.transaction([this.tableName],"readonly").objectStore(this.tableName).count(e);s.addEventListener("success",a=>{const c=a;this.closeConnection(),t(c.target.result===1)}),s.addEventListener("error",a=>{this.closeConnection(),n(a)})})}async deleteDatabase(){return this.db&&this.dbOpen&&this.closeConnection(),new Promise((e,t)=>{const n=window.indexedDB.deleteDatabase(An),r=setTimeout(()=>t(!1),200);n.addEventListener("success",()=>(clearTimeout(r),e(!0))),n.addEventListener("blocked",()=>(clearTimeout(r),e(!0))),n.addEventListener("error",()=>(clearTimeout(r),t(!1)))})}}class en{constructor(){this.cache=new Map}async initialize(){}getItem(e){return this.cache.get(e)||null}getUserData(e){return this.getItem(e)}setItem(e,t){this.cache.set(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){this.cache.delete(e)}getKeys(){const e=[];return this.cache.forEach((t,n)=>{e.push(n)}),e}containsKey(e){return this.cache.has(e)}clear(){this.cache.clear()}decryptData(){return Promise.resolve(null)}}class Id{constructor(e){this.inMemoryCache=new en,this.indexedDBCache=new yd,this.logger=e}handleDatabaseAccessError(e,t){if(e instanceof ft&&e.errorCode===Ko)this.logger.error("1wx7zz",t);else throw e}async getItem(e,t){const n=this.inMemoryCache.getItem(e);if(!n)try{return this.logger.verbose("0naxpl",t),await this.indexedDBCache.getItem(e)}catch(r){this.handleDatabaseAccessError(r,t)}return n}async setItem(e,t,n){this.inMemoryCache.setItem(e,t);try{await this.indexedDBCache.setItem(e,t)}catch(r){this.handleDatabaseAccessError(r,n)}}async removeItem(e,t){this.inMemoryCache.removeItem(e);try{await this.indexedDBCache.removeItem(e)}catch(n){this.handleDatabaseAccessError(n,t)}}async getKeys(e){const t=this.inMemoryCache.getKeys();if(t.length===0)try{return this.logger.verbose("1iqrbq",e),await this.indexedDBCache.getKeys()}catch(n){this.handleDatabaseAccessError(n,e)}return t}async containsKey(e,t){const n=this.inMemoryCache.containsKey(e);if(!n)try{return this.logger.verbose("03zl2j",t),await this.indexedDBCache.containsKey(e)}catch(r){this.handleDatabaseAccessError(r,t)}return n}clearInMemory(e){this.logger.verbose("03r21p",e),this.inMemoryCache.clear(),this.logger.verbose("0uksk1",e)}async clearPersistent(e){try{this.logger.verbose("0rdqut",e);const t=await this.indexedDBCache.deleteDatabase();return t&&this.logger.verbose("149ouc",e),t}catch(t){return this.handleDatabaseAccessError(t,e),!1}}}class he{constructor(e,t,n){this.logger=e,Al(n??!1),this.cache=new Id(this.logger),this.performanceClient=t}createNewGuid(){return Re()}base64Encode(e){return ht(e)}base64Decode(e){return V(e)}base64UrlEncode(e){return Tt(e)}encodeKid(e){return this.base64UrlEncode(JSON.stringify({kid:e}))}async getPublicKeyThumbprint(e){const t=this.performanceClient?.startMeasurement(jl,e.correlationId),n=await Sl(he.EXTRACTABLE,he.POP_KEY_USAGES),r=await cn(n.publicKey),o={e:r.e,kty:r.kty,n:r.n},s=Ai(o),a=await this.hashString(s),c=await cn(n.privateKey),h=await _l(c,!1,["sign"]);return await this.cache.setItem(a,{privateKey:h,publicKey:n.publicKey,requestMethod:e.resourceRequestMethod,requestUri:e.resourceRequestUri},e.correlationId),t&&t.end({success:!0}),a}async removeTokenBindingKey(e,t){if(await this.cache.removeItem(e,t),await this.cache.containsKey(e,t))throw f(Xa)}async clearKeystore(e){this.cache.clearInMemory(e);try{return await this.cache.clearPersistent(e),!0}catch(t){return t instanceof Error?this.logger.error("1owpn8",e):this.logger.error("0yrmwo",e),!1}}async signJwt(e,t,n,r){const o=this.performanceClient?.startMeasurement(Gl,r),s=await this.cache.getItem(t,r||"");if(!s)throw m(Ho);const a=await cn(s.publicKey),c=Ai(a),h=Tt(JSON.stringify({kid:t})),l=sr.getShrHeaderString({...n?.header,alg:a.alg,kid:h}),d=Tt(l);e.cnf={jwk:JSON.parse(c)};const g=Tt(JSON.stringify(e)),p=`${d}.${g}`,A=new TextEncoder().encode(p),O=await vl(s.privateKey,A),j=Ie(new Uint8Array(O)),b=`${p}.${j}`;return o&&o.end({success:!0}),b}async hashString(e){return Ol(e)}}he.POP_KEY_USAGES=["sign","verify"];he.EXTRACTABLE=!0;function Ai(i){return JSON.stringify(i,Object.keys(i).sort())}const Td="acquireTokenSilent",wd="acquireTokenByCode",Ad="acquireTokenPopup",Ed="acquireTokenPreRedirect",ln="acquireTokenRedirect",Sd="ssoSilent",_d="initializeClientApplication",vd="localStorageUpdated";const M="msal",Tr="browser",Ei="|",U=2,St=2,kd=`${M}.${Tr}.log.level`,bd=`${M}.${Tr}.log.pii`,Rd=`${M}.${Tr}.platform.auth.dom`,Si=`${M}.version`,_i="account.keys",vi="token.keys";function Ge(i=St){return i<1?`${M}.${_i}`:`${M}.${i}.${_i}`}function Ve(i,e=U){return e<1?`${M}.${vi}.${i}`:`${M}.${e}.${vi}.${i}`}const Od=1440*60*1e3,vn={Lax:"Lax",None:"None"};class Zo{initialize(){return Promise.resolve()}getItem(e){const t=`${encodeURIComponent(e)}`,n=document.cookie.split(";");for(let r=0;r<n.length;r++){const o=n[r],[s,...a]=decodeURIComponent(o).trim().split("="),c=a.join("=");if(s===t)return c}return""}getUserData(){throw f(T)}setItem(e,t,n,r=!0,o=vn.Lax){let s=`${encodeURIComponent(e)}=${encodeURIComponent(t)};path=/;SameSite=${o};`;if(n){const a=Pd(n);s+=`expires=${a};`}(r||o===vn.None)&&(s+="Secure;"),document.cookie=s}async setUserData(){return Promise.reject(f(T))}removeItem(e){this.setItem(e,"",-1)}getKeys(){const e=document.cookie.split(";"),t=[];return e.forEach(n=>{const r=decodeURIComponent(n).trim().split("=");t.push(r[0])}),t}containsKey(e){return this.getKeys().includes(e)}decryptData(){return Promise.resolve(null)}}function Pd(i){const e=new Date;return new Date(e.getTime()+i*Od).toUTCString()}function ue(i,e){const t=i.getItem(Ge(e));return t?JSON.parse(t):[]}function X(i,e,t){const n=e.getItem(Ve(i,t));if(n){const r=JSON.parse(n);if(r&&r.hasOwnProperty("idToken")&&r.hasOwnProperty("accessToken")&&r.hasOwnProperty("refreshToken"))return r}return{idToken:[],accessToken:[],refreshToken:[]}}function _t(i){return i.hasOwnProperty("id")&&i.hasOwnProperty("nonce")&&i.hasOwnProperty("data")}const ki="msal.cache.encryption",Nd="msal.broadcast.cache";class Md{constructor(e,t,n){if(!window.localStorage)throw P($o);this.memoryStorage=new en,this.initialized=!1,this.clientId=e,this.logger=t,this.performanceClient=n,this.broadcast=new BroadcastChannel(Nd)}async initialize(e){const t=new Zo,n=t.getItem(ki);let r={key:"",id:""};if(n)try{r=JSON.parse(n)}catch{}if(r.key&&r.id){const o=ee(Ce,fd,this.logger,this.performanceClient,e)(r.key);this.encryptionCookie={id:r.id,key:await u(pi,Ti,this.logger,this.performanceClient,e)(o)}}else{const o=Re(),s=await u(Go,gd,this.logger,this.performanceClient,e)(),a=ee(Ie,pd,this.logger,this.performanceClient,e)(new Uint8Array(s));this.encryptionCookie={id:o,key:await u(pi,Ti,this.logger,this.performanceClient,e)(s)};const c={id:o,key:a};t.setItem(ki,JSON.stringify(c),0,!0,vn.None)}await u(this.importExistingCache.bind(this),cd,this.logger,this.performanceClient,e)(e),this.broadcast.addEventListener("message",o=>{this.updateCache(o,e)}),this.initialized=!0}getItem(e){return window.localStorage.getItem(e)}getUserData(e){if(!this.initialized)throw m(Et);return this.memoryStorage.getItem(e)}async decryptData(e,t,n){if(!this.initialized||!this.encryptionCookie)throw m(Et);if(t.id!==this.encryptionCookie.id)return this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},n),null;const r=await u(mi,wi,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t.nonce,this.getContext(e),t.data);if(!r)return null;try{return{...JSON.parse(r),lastUpdatedAt:t.lastUpdatedAt}}catch{return this.performanceClient.incrementFields({encryptedCacheCorruptionCount:1},n),null}}setItem(e,t){window.localStorage.setItem(e,t)}async setUserData(e,t,n,r,o){if(!this.initialized||!this.encryptionCookie)throw m(Et);if(o)this.setItem(e,t);else{const{data:s,nonce:a}=await u(Rl,md,this.logger,this.performanceClient,n)(this.encryptionCookie.key,t,this.getContext(e)),c={id:this.encryptionCookie.id,nonce:a,data:s,lastUpdatedAt:r};this.setItem(e,JSON.stringify(c))}this.memoryStorage.setItem(e,t),this.broadcast.postMessage({key:e,value:t,context:this.getContext(e)})}removeItem(e){this.memoryStorage.containsKey(e)&&(this.memoryStorage.removeItem(e),this.broadcast.postMessage({key:e,value:null,context:this.getContext(e)})),window.localStorage.removeItem(e)}getKeys(){return Object.keys(window.localStorage)}containsKey(e){return window.localStorage.hasOwnProperty(e)}clear(){this.memoryStorage.clear(),ue(this).forEach(n=>this.removeItem(n));const t=X(this.clientId,this);t.idToken.forEach(n=>this.removeItem(n)),t.accessToken.forEach(n=>this.removeItem(n)),t.refreshToken.forEach(n=>this.removeItem(n)),this.getKeys().forEach(n=>{(n.startsWith(M)||n.indexOf(this.clientId)!==-1)&&this.removeItem(n)})}async importExistingCache(e){if(!this.encryptionCookie)return;let t=ue(this);t=await this.importArray(t,e),t.length?this.setItem(Ge(),JSON.stringify(t)):this.removeItem(Ge());const n=X(this.clientId,this);n.idToken=await this.importArray(n.idToken,e),n.accessToken=await this.importArray(n.accessToken,e),n.refreshToken=await this.importArray(n.refreshToken,e),n.idToken.length||n.accessToken.length||n.refreshToken.length?this.setItem(Ve(this.clientId),JSON.stringify(n)):this.removeItem(Ve(this.clientId))}async getItemFromEncryptedCache(e,t){if(!this.encryptionCookie)return null;const n=this.getItem(e);if(!n)return null;let r;try{r=JSON.parse(n)}catch{return null}return _t(r)?r.id!==this.encryptionCookie.id?(this.performanceClient.incrementFields({encryptedCacheExpiredCount:1},t),null):(this.performanceClient.incrementFields({encryptedCacheCount:1},t),u(mi,wi,this.logger,this.performanceClient,t)(this.encryptionCookie.key,r.nonce,this.getContext(e),r.data)):(this.performanceClient.incrementFields({unencryptedCacheCount:1},t),n)}async importArray(e,t){const n=[],r=[];return e.forEach(o=>{const s=this.getItemFromEncryptedCache(o,t).then(a=>{a?(this.memoryStorage.setItem(o,a),n.push(o)):this.removeItem(o)});r.push(s)}),await Promise.all(r),n}getContext(e){let t="";return e.includes(this.clientId)&&(t=this.clientId),t}updateCache(e,t){this.logger.trace("17cxcm",t);const n=this.performanceClient.startMeasurement(vd);n.add({isBackground:!0});const{key:r,value:o,context:s}=e.data;if(!r){this.logger.error("0e10qr",t),n.end({success:!1,errorCode:"noKey"});return}if(s&&s!==this.clientId){this.logger.trace("04rtdy",t),n.end({success:!1,errorCode:"contextMismatch"});return}o?(this.memoryStorage.setItem(r,o),this.logger.verbose("1vzsgt",t)):(this.memoryStorage.removeItem(r),this.logger.verbose("04ypih",t)),n.end({success:!0})}}class Ud{constructor(){if(!window.sessionStorage)throw P($o)}async initialize(){}getItem(e){return window.sessionStorage.getItem(e)}getUserData(e){return this.getItem(e)}setItem(e,t){window.sessionStorage.setItem(e,t)}async setUserData(e,t){this.setItem(e,t)}removeItem(e){window.sessionStorage.removeItem(e)}getKeys(){return Object.keys(window.sessionStorage)}containsKey(e){return window.sessionStorage.hasOwnProperty(e)}decryptData(){return Promise.resolve(null)}}const y={INITIALIZE_START:"msal:initializeStart",INITIALIZE_END:"msal:initializeEnd",ACTIVE_ACCOUNT_CHANGED:"msal:activeAccountChanged",LOGIN_SUCCESS:"msal:loginSuccess",ACQUIRE_TOKEN_START:"msal:acquireTokenStart",BROKERED_REQUEST_START:"msal:brokeredRequestStart",ACQUIRE_TOKEN_SUCCESS:"msal:acquireTokenSuccess",BROKERED_REQUEST_SUCCESS:"msal:brokeredRequestSuccess",ACQUIRE_TOKEN_FAILURE:"msal:acquireTokenFailure",BROKERED_REQUEST_FAILURE:"msal:brokeredRequestFailure",ACQUIRE_TOKEN_NETWORK_START:"msal:acquireTokenFromNetworkStart",HANDLE_REDIRECT_START:"msal:handleRedirectStart",HANDLE_REDIRECT_END:"msal:handleRedirectEnd",POPUP_OPENED:"msal:popupOpened",LOGOUT_START:"msal:logoutStart",LOGOUT_SUCCESS:"msal:logoutSuccess",LOGOUT_FAILURE:"msal:logoutFailure",LOGOUT_END:"msal:logoutEnd",RESTORE_FROM_BFCACHE:"msal:restoreFromBFCache",BROKER_CONNECTION_ESTABLISHED:"msal:brokerConnectionEstablished"};const Dd="@azure/msal-browser",Pe="5.1.0";function le(i,e){const t=i.indexOf(e);t>-1&&i.splice(t,1)}class kn extends In{constructor(e,t,n,r,o,s,a){super(e,n,r,o,a),this.cacheConfig=t,this.logger=r,this.internalStorage=new en,this.browserStorage=bi(e,t.cacheLocation,r,o),this.temporaryCacheStorage=bi(e,Q.SessionStorage,r,o),this.cookieStorage=new Zo,this.eventHandler=s}async initialize(e){this.performanceClient.addFields({cacheLocation:this.cacheConfig.cacheLocation,cacheRetentionDays:this.cacheConfig.cacheRetentionDays},e),await this.browserStorage.initialize(e),await this.migrateExistingCache(e),this.trackVersionChanges(e)}async migrateExistingCache(e){let t=ue(this.browserStorage),n=X(this.clientId,this.browserStorage);this.performanceClient.addFields({preMigrateAcntCount:t.length,preMigrateATCount:n.accessToken.length,preMigrateITCount:n.idToken.length,preMigrateRTCount:n.refreshToken.length},e);for(let o=0;o<St;o++){const s=o;await this.removeStaleAccounts(o,s,e)}for(let o=0;o<U;o++){const s=o;await this.migrateIdTokens(o,s,e)}const r=this.getKMSIValues();for(let o=0;o<U;o++)await this.migrateAccessTokens(o,r,e),await this.migrateRefreshTokens(o,r,e);t=ue(this.browserStorage),n=X(this.clientId,this.browserStorage),this.performanceClient.addFields({postMigrateAcntCount:t.length,postMigrateATCount:n.accessToken.length,postMigrateITCount:n.idToken.length,postMigrateRTCount:n.refreshToken.length},e)}async updateOldEntry(e,t){const n=this.browserStorage.getItem(e),r=this.validateAndParseJson(n||"");if(!r)return this.browserStorage.removeItem(e),null;if(!r.lastUpdatedAt)r.lastUpdatedAt=Date.now().toString(),this.setItem(e,JSON.stringify(r),t);else if(Zr(r.lastUpdatedAt,this.cacheConfig.cacheRetentionDays))return this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null;const o=_t(r)?await this.browserStorage.decryptData(e,r,t):r;return!o||!$t(o)?(this.performanceClient.incrementFields({invalidCacheCount:1},t),null):(ni(o)||ri(o))&&o.expiresOn&&Lt(o.expiresOn,Fi)?(this.browserStorage.removeItem(e),this.performanceClient.incrementFields({expiredCacheRemovedCount:1},t),null):o}async removeStaleAccounts(e,t,n){const r=ue(this.browserStorage,e);if(r.length!==0){for(const o of[...r]){this.performanceClient.incrementFields({oldAcntCount:1},n);const s=this.browserStorage.getItem(o),a=this.validateAndParseJson(s||"");if(!a){le(r,o);continue}if(a.lastUpdatedAt)Zr(a.lastUpdatedAt,this.cacheConfig.cacheRetentionDays)&&(await this.removeAccountOldSchema(o,a,t,n),le(r,o));else{a.lastUpdatedAt=Date.now().toString(),this.setItem(o,JSON.stringify(a),n);continue}}this.setAccountKeys(r,n,e)}}async removeAccountOldSchema(e,t,n,r){const s=(_t(t)?await this.browserStorage.decryptData(e,t,r):t)?.homeAccountId;if(s){const a=this.getTokenKeys(n);[...a.idToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),le(a.idToken,c)}),[...a.accessToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),le(a.accessToken,c)}),[...a.refreshToken].filter(c=>c.includes(s)).forEach(c=>{this.browserStorage.removeItem(c),le(a.refreshToken,c)}),this.setTokenKeys(a,r,n)}this.performanceClient.incrementFields({expiredAcntRemovedCount:1},r),this.browserStorage.removeItem(e)}getKMSIValues(){const e={},t=this.getTokenKeys().idToken;for(const n of t){const r=this.browserStorage.getUserData(n);if(r){const o=JSON.parse(r),s=ae(o.secret,V);s&&(e[o.homeAccountId]=Se(s))}}return e}async migrateIdTokens(e,t,n){const r=X(this.clientId,this.browserStorage,e);if(r.idToken.length===0)return;const o=X(this.clientId,this.browserStorage,U),s=ue(this.browserStorage),a=ue(this.browserStorage,t);for(const c of[...r.idToken]){this.performanceClient.incrementFields({oldITCount:1},n);const h=await this.updateOldEntry(c,n);if(!h){le(r.idToken,c);continue}const l=s.find(b=>b.includes(h.homeAccountId)),d=a.find(b=>b.includes(h.homeAccountId));let g=null;if(l)g=this.getAccount(l,n);else if(d){const b=this.browserStorage.getItem(d),G=this.validateAndParseJson(b||"");g=G&&_t(G)?await this.browserStorage.decryptData(d,G,n):G}if(!g){this.performanceClient.incrementFields({skipITMigrateCount:1},n);continue}const p=ae(h.secret,V),I=this.generateCredentialKey(h),A=this.getIdTokenCredential(I,n),O=Object.keys(p).includes("signin_state"),j=A&&Object.keys(ae(A.secret,V)||{}).includes("signin_state");if(!A||h.lastUpdatedAt>A.lastUpdatedAt&&(O||!j)){const b=g.tenantProfiles||[],G=Xn(p)||g.realm;if(G&&!b.find(De=>De.tenantId===G)){const De=Ye(g.homeAccountId,g.localAccountId,G,p);b.push(De)}g.tenantProfiles=b;const Te=this.generateAccountKey(ke(g)),Ue=Se(p);await this.setUserData(Te,JSON.stringify(g),n,g.lastUpdatedAt,Ue),s.includes(Te)||s.push(Te),await this.setUserData(I,JSON.stringify(h),n,h.lastUpdatedAt,Ue),this.performanceClient.incrementFields({migratedITCount:1},n),o.idToken.push(I)}}this.setTokenKeys(r,n,e),this.setTokenKeys(o,n),this.setAccountKeys(s,n)}async migrateAccessTokens(e,t,n){const r=X(this.clientId,this.browserStorage,e);if(r.accessToken.length===0)return;const o=X(this.clientId,this.browserStorage,U);for(const s of[...r.accessToken]){this.performanceClient.incrementFields({oldATCount:1},n);const a=await this.updateOldEntry(s,n);if(!a){le(r.accessToken,s);continue}if(!(a.homeAccountId in t)){this.performanceClient.incrementFields({skipATMigrateCount:1},n);continue}const c=this.generateCredentialKey(a),h=t[a.homeAccountId];if(!o.accessToken.includes(c))await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,h),this.performanceClient.incrementFields({migratedATCount:1},n),o.accessToken.push(c);else{const l=this.getAccessTokenCredential(c,n);(!l||a.lastUpdatedAt>l.lastUpdatedAt)&&(await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,h),this.performanceClient.incrementFields({migratedATCount:1},n))}}this.setTokenKeys(r,n,e),this.setTokenKeys(o,n)}async migrateRefreshTokens(e,t,n){const r=X(this.clientId,this.browserStorage,e);if(r.refreshToken.length===0)return;const o=X(this.clientId,this.browserStorage,U);for(const s of[...r.refreshToken]){this.performanceClient.incrementFields({oldRTCount:1},n);const a=await this.updateOldEntry(s,n);if(!a){le(r.refreshToken,s);continue}if(!(a.homeAccountId in t)){this.performanceClient.incrementFields({skipRTMigrateCount:1},n);continue}const c=this.generateCredentialKey(a),h=t[a.homeAccountId];if(!o.refreshToken.includes(c))await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,h),this.performanceClient.incrementFields({migratedRTCount:1},n),o.refreshToken.push(c);else{const l=this.getRefreshTokenCredential(c,n);(!l||a.lastUpdatedAt>l.lastUpdatedAt)&&(await this.setUserData(c,JSON.stringify(a),n,a.lastUpdatedAt,h),this.performanceClient.incrementFields({migratedRTCount:1},n))}}this.setTokenKeys(r,n,e),this.setTokenKeys(o,n)}trackVersionChanges(e){const t=this.browserStorage.getItem(Si);t&&(this.logger.info("1wuc87",e),this.performanceClient.addFields({previousLibraryVersion:t},e)),t!==Pe&&this.setItem(Si,Pe,e)}validateAndParseJson(e){if(!e)return null;try{const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}setItem(e,t,n){const r=new Array(U+1).fill(0),o=[],s=20;for(let a=0;a<=s;a++)try{if(this.browserStorage.setItem(e,t),a>0)for(let c=0;c<=U;c++){const h=r.slice(0,c).reduce((d,g)=>d+g,0);if(h>=a)break;const l=a>h+r[c]?h+r[c]:a;a>h&&r[c]>0&&this.removeAccessTokenKeys(o.slice(h,l),n,c)}break}catch(c){const h=yn(c);if(h.errorCode===Cn&&a<s){if(!o.length)for(let l=0;l<=U;l++)if(e===Ve(this.clientId,l)){const d=JSON.parse(t).accessToken;o.push(...d),r[l]=d.length}else{const d=this.getTokenKeys(l).accessToken;o.push(...d),r[l]=d.length}if(o.length<=a)throw h;this.removeAccessToken(o[a],n,!1)}else throw h}}async setUserData(e,t,n,r,o){const s=new Array(U+1).fill(0),a=[],c=20;for(let h=0;h<=c;h++)try{if(await u(this.browserStorage.setUserData.bind(this.browserStorage),ch,this.logger,this.performanceClient,n)(e,t,n,r,o),h>0)for(let l=0;l<=U;l++){const d=s.slice(0,l).reduce((p,I)=>p+I,0);if(d>=h)break;const g=h>d+s[l]?d+s[l]:h;h>d&&s[l]>0&&this.removeAccessTokenKeys(a.slice(d,g),n,l)}break}catch(l){const d=yn(l);if(d.errorCode===Cn&&h<c){if(!a.length)for(let g=0;g<=U;g++){const p=this.getTokenKeys(g).accessToken;a.push(...p),s[g]=p.length}if(a.length<=h)throw d;this.removeAccessToken(a[h],n,!1)}else throw d}}getAccount(e,t){this.logger.trace("1lfvm6",t);const n=this.browserStorage.getUserData(e);if(!n)return this.removeAccountKeyFromMap(e,t),null;const r=this.validateAndParseJson(n);if(!r||!vc(r))return null;const o=In.toObject({},r);return this.performanceClient.addFields({accountCachedBy:xh(o.cachedByApiId)},t),o}async setAccount(e,t,n,r){this.logger.trace("1bz3wr",t);const o=this.generateAccountKey(ke(e)),s=Date.now().toString();e.lastUpdatedAt=s,e.cachedByApiId=r,await this.setUserData(o,JSON.stringify(e),t,s,n),this.addAccountKeyToMap(o,t),this.performanceClient.addFields({kmsi:n},t)}setAccountKeys(e,t,n=St){e.length===0?this.removeItem(Ge(n)):this.setItem(Ge(n),JSON.stringify(e),t)}getAccountKeys(){return ue(this.browserStorage)}addAccountKeyToMap(e,t){this.logger.trace("0rb85k",t),this.logger.tracePii("1l9bdo",t);const n=this.getAccountKeys();return n.indexOf(e)===-1?(n.push(e),this.setItem(Ge(),JSON.stringify(n),t),this.logger.verbose("0xia39",t),!0):(this.logger.verbose("0161kk",t),!1)}removeAccountKeyFromMap(e,t){this.logger.trace("1jpigu",t),this.logger.tracePii("1xzspl",t);const n=this.getAccountKeys(),r=n.indexOf(e);r>-1?(n.splice(r,1),this.setAccountKeys(n,t)):this.logger.trace("1dytu2",t)}removeAccount(e,t){const n=this.getActiveAccount(t);n?.homeAccountId===e.homeAccountId&&n?.environment===e.environment&&this.setActiveAccount(null,t),super.removeAccount(e,t),this.removeAccountKeyFromMap(this.generateAccountKey(e),t),this.browserStorage.getKeys().forEach(r=>{r.includes(e.homeAccountId)&&r.includes(e.environment)&&this.browserStorage.removeItem(r)})}removeIdToken(e,t){super.removeIdToken(e,t);const n=this.getTokenKeys(),r=n.idToken.indexOf(e);r>-1&&(this.logger.info("05udv9",t),n.idToken.splice(r,1),this.setTokenKeys(n,t))}removeAccessToken(e,t,n=!0){super.removeAccessToken(e,t),n&&this.removeAccessTokenKeys([e],t)}removeAccessTokenKeys(e,t,n=U){this.logger.trace("17o18n",t);const r=this.getTokenKeys(n);let o=0;if(e.forEach(s=>{const a=r.accessToken.indexOf(s);a>-1&&(r.accessToken.splice(a,1),o++)}),o>0){this.logger.info("15i5d5",t),this.setTokenKeys(r,t,n);return}}removeRefreshToken(e,t){super.removeRefreshToken(e,t);const n=this.getTokenKeys(),r=n.refreshToken.indexOf(e);r>-1&&(this.logger.info("1f4fq3",t),n.refreshToken.splice(r,1),this.setTokenKeys(n,t))}getTokenKeys(e=U){return X(this.clientId,this.browserStorage,e)}setTokenKeys(e,t,n=U){if(e.idToken.length===0&&e.accessToken.length===0&&e.refreshToken.length===0){this.removeItem(Ve(this.clientId,n));return}else this.setItem(Ve(this.clientId,n),JSON.stringify(e),t)}getIdTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("1jukz6",t),this.removeIdToken(e,t),null;const r=this.validateAndParseJson(n);return!r||!uh(r)?(this.logger.trace("1jukz6",t),null):(this.logger.trace("01ju66",t),r)}async setIdTokenCredential(e,t,n){this.logger.trace("13hjll",t);const r=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const s=this.getTokenKeys();s.idToken.indexOf(r)===-1&&(this.logger.info("07jy92",t),s.idToken.push(r),this.setTokenKeys(s,t))}getAccessTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("0bqvx8",t),this.removeAccessTokenKeys([e],t),null;const r=this.validateAndParseJson(n);return!r||!ni(r)?(this.logger.trace("0bqvx8",t),null):(this.logger.trace("1o81rl",t),r)}async setAccessTokenCredential(e,t,n){this.logger.trace("1pondb",t);const r=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const s=this.getTokenKeys(),a=s.accessToken.indexOf(r);a!==-1&&s.accessToken.splice(a,1),this.logger.trace("1onhey",t),s.accessToken.push(r),this.setTokenKeys(s,t)}getRefreshTokenCredential(e,t){const n=this.browserStorage.getUserData(e);if(!n)return this.logger.trace("0jlizt",t),this.removeRefreshToken(e,t),null;const r=this.validateAndParseJson(n);return!r||!ri(r)?(this.logger.trace("0jlizt",t),null):(this.logger.trace("0nokxi",t),r)}async setRefreshTokenCredential(e,t,n){this.logger.trace("0tcg8d",t);const r=this.generateCredentialKey(e),o=Date.now().toString();e.lastUpdatedAt=o,await this.setUserData(r,JSON.stringify(e),t,o,n);const s=this.getTokenKeys();s.refreshToken.indexOf(r)===-1&&(this.logger.info("0eckjs",t),s.refreshToken.push(r),this.setTokenKeys(s,t))}getAppMetadata(e,t){const n=this.browserStorage.getItem(e);if(!n)return this.logger.trace("1q101h",t),null;const r=this.validateAndParseJson(n);return!r||!mh(e,r)?(this.logger.trace("1q101h",t),null):(this.logger.trace("19pvg2",t),r)}setAppMetadata(e,t){this.logger.trace("0cyma6",t);const n=ph(e);this.setItem(n,JSON.stringify(e),t)}getServerTelemetry(e,t){const n=this.browserStorage.getItem(e);if(!n)return this.logger.trace("0jk19c",t),null;const r=this.validateAndParseJson(n);return!r||!gh(e,r)?(this.logger.trace("0jk19c",t),null):(this.logger.trace("12jguk",t),r)}setServerTelemetry(e,t,n){this.logger.trace("1poh61",n),this.setItem(e,JSON.stringify(t),n)}getAuthorityMetadata(e,t){const n=this.internalStorage.getItem(e);if(!n)return this.logger.trace("1r39oe",t),null;const r=this.validateAndParseJson(n);return r&&Ch(e,r)?(this.logger.trace("1ohvk3",t),r):null}getAuthorityMetadataKeys(){return this.internalStorage.getKeys().filter(t=>this.isAuthorityMetadata(t))}setWrapperMetadata(e,t){this.internalStorage.setItem(It.WRAPPER_SKU,e),this.internalStorage.setItem(It.WRAPPER_VER,t)}getWrapperMetadata(){const e=this.internalStorage.getItem(It.WRAPPER_SKU)||"",t=this.internalStorage.getItem(It.WRAPPER_VER)||"";return[e,t]}setAuthorityMetadata(e,t,n){this.logger.trace("07w8n2",n),this.internalStorage.setItem(e,JSON.stringify(t))}getActiveAccount(e){const t=this.generateCacheKey(Hr.ACTIVE_ACCOUNT_FILTERS),n=this.browserStorage.getItem(t);if(!n)return this.logger.trace("08gw0e",e),null;const r=this.validateAndParseJson(n);return r?(this.logger.trace("1t3ch7",e),this.getAccountInfoFilteredBy({homeAccountId:r.homeAccountId,localAccountId:r.localAccountId,tenantId:r.tenantId},e)):(this.logger.trace("0me1up",e),null)}setActiveAccount(e,t){const n=this.generateCacheKey(Hr.ACTIVE_ACCOUNT_FILTERS);if(e){this.logger.verbose("0rsj80",t);const r={homeAccountId:e.homeAccountId,localAccountId:e.localAccountId,tenantId:e.tenantId};this.setItem(n,JSON.stringify(r),t)}else this.logger.verbose("1bp5z5",t),this.browserStorage.removeItem(n);this.eventHandler.emitEvent(y.ACTIVE_ACCOUNT_CHANGED)}getThrottlingCache(e,t){const n=this.browserStorage.getItem(e);if(!n)return this.logger.trace("1h4wa6",t),null;const r=this.validateAndParseJson(n);return!r||!fh(e,r)?(this.logger.trace("1h4wa6",t),null):(this.logger.trace("0of6n8",t),r)}setThrottlingCache(e,t,n){this.logger.trace("0wfgh6",n),this.setItem(e,JSON.stringify(t),n)}getTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e,o=this.temporaryCacheStorage.getItem(r);if(!o){if(this.cacheConfig.cacheLocation===Q.LocalStorage){const s=this.browserStorage.getItem(r);if(s)return this.logger.trace("1yt61y",t),s}return this.logger.trace("1qhy81",t),null}return o}setTemporaryCache(e,t,n){const r=n?this.generateCacheKey(e):e;this.temporaryCacheStorage.setItem(r,t)}removeItem(e){this.browserStorage.removeItem(e)}removeTemporaryItem(e){this.temporaryCacheStorage.removeItem(e)}getKeys(){return this.browserStorage.getKeys()}clear(e){this.removeAllAccounts(e),this.removeAppMetadata(e),this.temporaryCacheStorage.getKeys().forEach(t=>{(t.indexOf(M)!==-1||t.indexOf(this.clientId)!==-1)&&this.removeTemporaryItem(t)}),this.browserStorage.getKeys().forEach(t=>{(t.indexOf(M)!==-1||t.indexOf(this.clientId)!==-1)&&this.browserStorage.removeItem(t)}),this.internalStorage.clear()}generateCacheKey(e){return W.startsWith(e,M)?e:`${M}.${this.clientId}.${e}`}generateCredentialKey(e){const t=e.credentialType===N.REFRESH_TOKEN&&e.familyId||e.clientId,n=e.tokenType&&e.tokenType.toLowerCase()!==S.BEARER.toLowerCase()?e.tokenType.toLowerCase():"";return[`${M}.${U}`,e.homeAccountId,e.environment,e.credentialType,t,e.realm||"",e.target||"",n].join(Ei).toLowerCase()}generateAccountKey(e){const t=e.homeAccountId.split(".")[1];return[`${M}.${St}`,e.homeAccountId,e.environment,t||e.tenantId||""].join(Ei).toLowerCase()}resetRequestCache(e){this.logger.trace("0h0ynu",e),this.removeTemporaryItem(this.generateCacheKey(R.REQUEST_PARAMS)),this.removeTemporaryItem(this.generateCacheKey(R.VERIFIER)),this.removeTemporaryItem(this.generateCacheKey(R.ORIGIN_URI)),this.removeTemporaryItem(this.generateCacheKey(R.URL_HASH)),this.removeTemporaryItem(this.generateCacheKey(R.NATIVE_REQUEST)),this.setInteractionInProgress(!1,void 0)}cacheAuthorizeRequest(e,t,n){this.logger.trace("1tzef5",t);const r=ht(JSON.stringify(e));if(this.setTemporaryCache(R.REQUEST_PARAMS,r,!0),n){const o=ht(n);this.setTemporaryCache(R.VERIFIER,o,!0)}}getCachedRequest(e){this.logger.trace("0uen20",e);const t=this.getTemporaryCache(R.REQUEST_PARAMS,e,!0);if(!t)throw m(tl);const n=this.getTemporaryCache(R.VERIFIER,e,!0);let r,o="";try{r=JSON.parse(V(t)),n&&(o=V(n))}catch{throw this.logger.errorPii("0ewsey",e),this.logger.error("0tvdic",e),m(nl)}return[r,o]}getCachedNativeRequest(){this.logger.trace("1yxcdm","");const e=this.getTemporaryCache(R.NATIVE_REQUEST,"",!0);if(!e)return this.logger.trace("0mnxd4",""),null;const t=this.validateAndParseJson(e);return t||(this.logger.error("0rrkip",""),null)}isInteractionInProgress(e){const t=this.getInteractionInProgress()?.clientId;return e?t===this.clientId:!!t}getInteractionInProgress(){const e=`${M}.${R.INTERACTION_STATUS_KEY}`,t=this.getTemporaryCache(e,"",!1);try{return t?JSON.parse(t):null}catch{return this.logger.error("0jjyys",""),this.removeTemporaryItem(e),this.resetRequestCache(""),Jo(window),null}}setInteractionInProgress(e,t=ge.SIGNIN,n=!1,r=""){const o=`${M}.${R.INTERACTION_STATUS_KEY}`;if(e){if(this.getInteractionInProgress())if(n)this.logger.warning("1pmscr",r),Dl(this.logger,r),this.removeTemporaryItem(o);else throw m($h);this.setTemporaryCache(o,JSON.stringify({clientId:this.clientId,type:t}),!1)}else!e&&this.getInteractionInProgress()?.clientId===this.clientId&&this.removeTemporaryItem(o)}async hydrateCache(e,t){const n=nr(e.account.homeAccountId,e.account.environment,e.idToken,this.clientId,e.tenantId),r=rr(e.account.homeAccountId,e.account.environment,e.accessToken,this.clientId,e.tenantId,e.scopes.join(" "),e.expiresOn?qr(e.expiresOn):0,e.extExpiresOn?qr(e.extExpiresOn):0,V,void 0,e.tokenType,void 0,t.sshKid),o={idToken:n,accessToken:r};return this.saveCacheRecord(o,e.correlationId,Se(ae(e.idToken,V)),w.hydrateCache)}async saveCacheRecord(e,t,n,r,o){try{await super.saveCacheRecord(e,t,n,r,o)}catch(s){if(s instanceof Be&&this.performanceClient&&t)try{const a=this.getTokenKeys();this.performanceClient.addFields({cacheRtCount:a.refreshToken.length,cacheIdCount:a.idToken.length,cacheAtCount:a.accessToken.length},t)}catch{}throw s}}}function bi(i,e,t,n){try{switch(e){case Q.LocalStorage:return new Md(i,t,n);case Q.SessionStorage:return new Ud;case Q.MemoryStorage:default:break}}catch(r){t.error(r,"")}return new en}const Ld=(i,e,t,n)=>{const r={cacheLocation:Q.MemoryStorage,cacheRetentionDays:5};return new kn(i,r,Nt,e,t,n)};function xd(i,e,t,n,r){return i.verbose("1yd030",n),t?e.getAllAccounts(r,n):[]}function Hd(i,e,t,n){if(e.trace("0u7b90",n),Object.keys(i).length===0)return e.warning("1kz0cu",n),null;const r=t.getAccountInfoFilteredBy(i,n);return r?(e.verbose("0btgll",n),r):(e.verbose("0ltaj5",n),null)}function Kd(i,e,t){e.setActiveAccount(i,t)}function Fd(i,e){return i.getActiveAccount(e)}const Bd="msal.broadcast.event";class zd{constructor(e){this.eventCallbacks=new Map,this.logger=e||new te({}),typeof BroadcastChannel<"u"&&(this.broadcastChannel=new BroadcastChannel(Bd)),this.invokeCrossTabCallbacks=this.invokeCrossTabCallbacks.bind(this)}addEventCallback(e,t,n){if(typeof window<"u"){const r=n||_n();return this.eventCallbacks.has(r)?(this.logger.error("1578i0",""),null):(this.eventCallbacks.set(r,[e,t||[]]),this.logger.verbose("1cnec4",""),r)}return null}removeEventCallback(e){this.eventCallbacks.delete(e),this.logger.verbose("12zotd","")}emitEvent(e,t,n,r){const o={eventType:e,interactionType:t||null,payload:n||null,error:r||null,timestamp:Date.now()};switch(e){case y.LOGIN_SUCCESS:case y.LOGOUT_SUCCESS:case y.ACTIVE_ACCOUNT_CHANGED:this.broadcastChannel?.postMessage(o)}this.invokeCallbacks(o)}invokeCallbacks(e){this.eventCallbacks.forEach(([t,n],r)=>{(n.length===0||n.includes(e.eventType))&&(this.logger.verbose("15jpwk",""),t.apply(null,[e]))})}invokeCrossTabCallbacks(e){const t=e.data;this.invokeCallbacks(t)}subscribeCrossTab(){this.broadcastChannel?.addEventListener("message",this.invokeCrossTabCallbacks)}unsubscribeCrossTab(){this.broadcastChannel?.removeEventListener("message",this.invokeCrossTabCallbacks)}}class es{constructor(e,t,n,r,o,s,a,c,h){this.config=e,this.browserStorage=t,this.browserCrypto=n,this.networkClient=this.config.system.networkClient,this.eventHandler=o,this.navigationClient=s,this.platformAuthProvider=h,this.correlationId=c,this.logger=r.clone($.MSAL_SKU,Pe),this.performanceClient=a}}function Kt(i,e,t,n){t.verbose("0bd1la",n);const r=i||e||"";return E.getAbsoluteUrl(r,pe())}function z(i,e,t,n,r,o){r.verbose("1p12tq",t);const s={clientId:e,correlationId:t,apiId:i,forceRefresh:!1,wrapperSKU:n.getWrapperMetadata()[0],wrapperVer:n.getWrapperMetadata()[1]};return new ct(s,n)}async function ce(i,e,t,n,r,o,s,a,c){const h=a&&a.hasOwnProperty("instance_aware")?a.instance_aware:void 0,l={protocolMode:i.system.protocolMode,OIDCOptions:i.auth.OIDCOptions,knownAuthorities:i.auth.knownAuthorities,cloudDiscoveryMetadata:i.auth.cloudDiscoveryMetadata,authorityMetadata:i.auth.authorityMetadata},d=o||i.auth.authority,g=h?.length?h==="true":i.auth.instanceAware,p=c&&g?i.auth.authority.replace(E.getDomainFromUrl(d),c.environment):d,I=K.generateAuthority(p,s||i.auth.azureCloudOptions),A=await u(bo,rd,r,t,e)(I,i.system.networkClient,n,l,r,e,t);if(c&&!A.isAlias(c.environment))throw v(Ua);return A}async function wr(i,e,t,n,r){if(r)try{i.removeAccount(r,n),t.verbose("0s4z6h",n)}catch{t.error("0mgg1d",n)}else try{t.verbose("0zj631",n),i.clear(n),await e.clearKeystore(n)}catch{t.error("12ih0c",n)}}async function Ar(i,e,t,n,r){const o=i.authority||e.auth.authority,s=[...i&&i.scopes||[]],a={...i,correlationId:i.correlationId,authority:o,scopes:s};if(!a.authenticationScheme)a.authenticationScheme=S.BEARER,n.verbose("1l4fwv",r);else{if(a.authenticationScheme===S.SSH){if(!i.sshJwk)throw v(Ln);if(!i.sshKid)throw v(Pa)}n.verbose("1ecmns",r)}return a}async function jd(i,e,t,n,r){const o=await u(Ar,Cr,r,n,i.correlationId)(i,t,n,r,i.correlationId);return{...i,...o,account:e,forceRefresh:i.forceRefresh||!1}}function ts(i,e){let t;const n=i.httpMethod;if(e===B.EAR){if(n&&n!==Fe.POST)throw v(Da);t=Fe.POST}else t=n||Fe.GET;return t}class qe extends es{initializeLogoutRequest(e){this.logger.verbose("0546u4",this.correlationId);const t={correlationId:this.correlationId,...e};if(e)if(e.logoutHint)this.logger.verbose("12k4l4",this.correlationId);else if(e.account){const n=this.getLogoutHintFromIdTokenClaims(e.account);n&&(this.logger.verbose("0st5di",this.correlationId),t.logoutHint=n)}else this.logger.verbose("0pdtc3",this.correlationId);else this.logger.verbose("07ndze",this.correlationId);return!e||e.postLogoutRedirectUri!==null?e&&e.postLogoutRedirectUri?(this.logger.verbose("1vamm6",t.correlationId),t.postLogoutRedirectUri=E.getAbsoluteUrl(e.postLogoutRedirectUri,pe())):this.config.auth.postLogoutRedirectUri===null?this.logger.verbose("15m5g7",t.correlationId):this.config.auth.postLogoutRedirectUri?(this.logger.verbose("1f4xlz",t.correlationId),t.postLogoutRedirectUri=E.getAbsoluteUrl(this.config.auth.postLogoutRedirectUri,pe())):(this.logger.verbose("17s5rf",t.correlationId),t.postLogoutRedirectUri=E.getAbsoluteUrl(pe(),pe())):this.logger.verbose("0ljv63",t.correlationId),t}getLogoutHintFromIdTokenClaims(e){const t=e.idTokenClaims;if(t){if(t.login_hint)return t.login_hint;this.logger.verbose("0mvp54",this.correlationId)}else this.logger.verbose("1e7bdp",this.correlationId);return null}async createAuthCodeClient(e){const t=await u(this.getClientConfiguration.bind(this),qt,this.logger,this.performanceClient,this.correlationId)(e);return new Ro(t,this.performanceClient)}async getClientConfiguration(e){const{serverTelemetryManager:t,requestAuthority:n,requestAzureCloudOptions:r,requestExtraQueryParameters:o,account:s}=e,a=e.authority||await u(ce,_e,this.logger,this.performanceClient,this.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,n,r,o,s),c=this.config.system.loggerOptions;return{authOptions:{clientId:this.config.auth.clientId,authority:a,clientCapabilities:this.config.auth.clientCapabilities,redirectUri:this.config.auth.redirectUri},systemOptions:{tokenRenewalOffsetSeconds:this.config.system.tokenRenewalOffsetSeconds,preventCorsPreflight:!0},loggerOptions:{loggerCallback:c.loggerCallback,piiLoggingEnabled:c.piiLoggingEnabled,logLevel:c.logLevel,correlationId:this.correlationId},cryptoInterface:this.browserCrypto,networkInterface:this.networkClient,storageInterface:this.browserStorage,serverTelemetryManager:t,libraryInfo:{sku:$.MSAL_SKU,version:Pe,cpu:"",os:""},telemetry:this.config.telemetry}}}async function tn(i,e,t,n,r,o,s,a){const c=Kt(i.redirectUri,t.auth.redirectUri,o,a),h={interactionType:e},l=Bc(n,i&&i.state||"",h),g={...await u(Ar,Cr,o,s,a)({...i,correlationId:a},t,s,o,a),redirectUri:c,state:l,nonce:i.nonce||Re(),responseMode:t.auth.OIDCOptions.responseMode},p={...g,httpMethod:ts(g,t.system.protocolMode)};if(i.loginHint||i.sid)return p;const I=i.account||r.getActiveAccount(a);return I&&(o.verbose("1eqlb3",a),o.verbosePii("0tf99t",a),p.account=I),p}function Gd(i,e){if(!e)return null;try{return ut(i.base64Decode,e).libraryState.meta}catch{throw f(st)}}function ot(i,e,t,n){const r=Pt(i);if(!r)throw ho(i)?(t.error("13pl0s",n),t.errorPii("1097vx",n),m(Gh)):(t.error("18h0l1",n),m(jh));return r}function Vd(i,e,t){if(!i.state)throw m(cr);const n=Gd(e,i.state);if(!n)throw m(Lo);if(n.interactionType!==t)throw m(Vh)}class ns{constructor(e,t,n,r,o){this.authModule=e,this.browserStorage=t,this.authCodeRequest=n,this.logger=r,this.performanceClient=o}async handleCodeResponse(e,t,n){let r;try{r=Rh(e,t.state)}catch(o){throw o instanceof Me&&o.subError===En?m(En):o}return u(this.handleCodeResponseFromServer.bind(this),wo,this.logger,this.performanceClient,t.correlationId)(r,t,n)}async handleCodeResponseFromServer(e,t,n,r=!0){if(this.logger.trace("0mf2hb",t.correlationId),this.authCodeRequest.code=e.code,r&&(e.nonce=t.nonce||void 0),e.state=t.state,e.client_info)this.authCodeRequest.clientInfo=e.client_info;else{const s=this.createCcsCredentials(t);s&&(this.authCodeRequest.ccsCredential=s)}return await u(this.authModule.acquireToken.bind(this.authModule),nd,this.logger,this.performanceClient,t.correlationId)(this.authCodeRequest,n,e)}createCcsCredentials(e){return e.account?{credential:e.account.homeAccountId,type:Z.HOME_ACCOUNT_ID}:e.loginHint?{credential:e.loginHint,type:Z.UPN}:null}}const $d="ContentError",Jd="PageException",Wd="user_switch";const Qd="USER_INTERACTION_REQUIRED",Yd="USER_CANCEL",Xd="NO_NETWORK",qd="PERSISTENT_ERROR",Zd="DISABLED",eu="ACCOUNT_UNAVAILABLE",tu="UX_NOT_ALLOWED";const nu=-2147186943;class oe extends _{constructor(e,t,n){super(e,t||Yt(e)),Object.setPrototypeOf(this,oe.prototype),this.name="NativeAuthError",this.ext=n}}function He(i){if(i.ext&&i.ext.status&&(i.ext.status===qd||i.ext.status===Zd)||i.ext&&i.ext.error&&i.ext.error===nu)return!0;switch(i.errorCode){case $d:case Jd:return!0;default:return!1}}function Ft(i,e,t){if(t&&t.status)switch(t.status){case eu:return Dt(Lc,Yt(i));case Qd:return new ne(i,e);case Yd:return m(En);case Xd:return m(Sn);case tu:return Dt(Io)}return new oe(i,e,t)}class rs extends qe{async acquireToken(e){const t=z(w.acquireTokenSilent_silentFlow,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),n=await u(this.getClientConfiguration.bind(this),qt,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:t,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,account:e.account}),r=new vh(n,this.performanceClient);this.logger.verbose("0wa871",this.correlationId);try{const s=(await u(r.acquireCachedToken.bind(r),Zl,this.logger,this.performanceClient,e.correlationId)(e))[0];return this.performanceClient.addFields({fromCache:!0},e.correlationId),s}catch(o){throw o instanceof ft&&o.errorCode===Ho&&this.logger.verbose("06wena",this.correlationId),o}}logout(e){this.logger.verbose("1rkurh",this.correlationId);const t=this.initializeLogoutRequest(e);return wr(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account)}}class vt extends es{constructor(e,t,n,r,o,s,a,c,h,l,d,g){super(e,t,n,r,o,s,c,g,h),this.apiId=a,this.accountId=l,this.platformAuthProvider=h,this.nativeStorageManager=d,this.silentCacheClient=new rs(e,this.nativeStorageManager,n,r,o,s,c,g,h);const p=this.platformAuthProvider.getExtensionName();this.skus=ct.makeExtraSkuString({libraryName:$.MSAL_SKU,libraryVersion:Pe,extensionName:p,extensionVersion:this.platformAuthProvider.getExtensionVersion()})}addRequestSKUs(e){e.extraParameters={...e.extraParameters,[Ta]:this.skus}}async acquireToken(e,t){this.logger.trace("03qeos",this.correlationId);const n=this.performanceClient.startMeasurement(Xo,e.correlationId),r=re(),o=z(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const s=await this.initializeNativeRequest(e);try{const c=await this.acquireTokensFromCache(this.accountId,s);return n.end({success:!0,isNativeBroker:!1,fromCache:!0}),c}catch(c){if(t===x.AccessToken)throw this.logger.info("0eitbc",this.correlationId),c;this.logger.info("0957j1",this.correlationId)}const a=await this.platformAuthProvider.sendMessage(s);return await this.handleNativeResponse(a,s,r).then(c=>(n.end({success:!0,isNativeBroker:!0,requestId:c.requestId}),o.clearNativeBrokerErrorCode(),c)).catch(c=>{throw n.end({success:!1,errorCode:c.errorCode,subErrorCode:c.subError,isNativeBroker:!0}),c})}catch(s){throw s instanceof oe&&o.setNativeBrokerErrorCode(s.errorCode),s}}createSilentCacheRequest(e,t){return{authority:e.authority,correlationId:this.correlationId,scopes:D.fromString(e.scope).asArray(),account:t,forceRefresh:!1}}async acquireTokensFromCache(e,t){if(!e)throw this.logger.warning("1ndf3e",this.correlationId),f(Gr);const n=this.browserStorage.getBaseAccountInfo({nativeAccountId:e},t.correlationId);if(!n)throw f(Gr);try{const r=this.createSilentCacheRequest(t,n),o=await this.silentCacheClient.acquireToken(r),s={...n,idTokenClaims:o?.idTokenClaims,idToken:o?.idToken};return{...o,account:s}}catch(r){throw r}}async acquireTokenRedirect(e,t,n){this.logger.trace("0luikq",this.correlationId);const r=await this.initializeNativeRequest(e),o=n?.navigateToLoginRequestUrl??!0;try{await this.platformAuthProvider.sendMessage(r)}catch(c){if(c instanceof oe&&(z(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).setNativeBrokerErrorCode(c.errorCode),He(c)))throw c}this.browserStorage.setTemporaryCache(R.NATIVE_REQUEST,JSON.stringify(r),!0);const s={apiId:w.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},a=o?window.location.href:Kt(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId);t.end({success:!0}),await this.navigationClient.navigateExternal(a,s)}async handleRedirectPromise(e,t){if(this.logger.trace("1c5lhw",this.correlationId),!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",this.correlationId),null;const n=this.browserStorage.getCachedNativeRequest();if(!n)return this.logger.verbose("0a6zjb",this.correlationId),e&&t&&e?.addFields({errorCode:"no_cached_request"},t),null;const{prompt:r,...o}=n;r&&this.logger.verbose("0ac34v",this.correlationId),this.browserStorage.removeItem(this.browserStorage.generateCacheKey(R.NATIVE_REQUEST));const s=re();try{this.logger.verbose("003x5a",this.correlationId);const a=await this.platformAuthProvider.sendMessage(o),c=await this.handleNativeResponse(a,o,s);return z(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger).clearNativeBrokerErrorCode(),c}catch(a){throw a}}logout(){return this.logger.trace("0u2sjm",this.correlationId),Promise.reject("Logout not implemented yet")}async handleNativeResponse(e,t,n){this.logger.trace("1bojln",this.correlationId);const r=ae(e.id_token,V),o=this.createHomeAccountIdentifier(e,r),s=this.browserStorage.getAccountInfoFilteredBy({nativeAccountId:t.accountId},this.correlationId)?.homeAccountId;if(t.extraParameters?.child_client_id&&e.account.id!==t.accountId)this.logger.info("1ub1in",this.correlationId);else if(o!==s&&e.account.id!==t.accountId)throw Ft(Wd);const a=await ce(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t.authority),c=Ao(this.browserStorage,a,o,V,this.correlationId,r,e.client_info,void 0,r.tid,void 0,e.account.id);e.expires_in=Number(e.expires_in);const h=await this.generateAuthenticationResult(e,t,r,c,a.canonicalAuthority,n);return await this.cacheAccount(c,Se(r)),await this.cacheNativeTokens(e,t,o,r,e.access_token,h.tenantId,n),h}createHomeAccountIdentifier(e,t){return fo(e.client_info||"",q.Default,this.logger,this.browserCrypto,this.correlationId,t)}generateScopes(e,t){return t?D.fromString(t):D.fromString(e)}async generatePopAccessToken(e,t){if(t.tokenType===S.POP&&t.signPopToken){if(e.shr)return this.logger.trace("0coqhu",this.correlationId),e.shr;const n=new Je(this.browserCrypto,this.performanceClient),r={resourceRequestMethod:t.resourceRequestMethod,resourceRequestUri:t.resourceRequestUri,shrClaims:t.shrClaims,shrNonce:t.shrNonce,correlationId:this.correlationId};if(!t.keyId)throw f(Zi);return n.signPopToken(e.access_token,t.keyId,r)}else return e.access_token}async generateAuthenticationResult(e,t,n,r,o,s){const a=this.addTelemetryFromNativeResponse(e.properties.MATS),c=this.generateScopes(t.scope,e.scope),h=e.account.properties||{},l=h.UID||n.oid||n.sub||"",d=h.TenantId||n.tid||"",g=Qn(ke(r),void 0,n,e.id_token);g.nativeAccountId!==e.account.id&&(g.nativeAccountId=e.account.id);const p=await this.generatePopAccessToken(e,t),I=t.tokenType===S.POP?S.POP:S.BEARER;return{authority:o,uniqueId:l,tenantId:d,scopes:c.asArray(),account:g,idToken:e.id_token,idTokenClaims:n,accessToken:p,fromCache:a?this.isResponseFromCache(a):!1,expiresOn:At(s+e.expires_in),tokenType:I,correlationId:this.correlationId,state:e.state,fromPlatformBroker:!0}}async cacheAccount(e,t){await this.browserStorage.setAccount(e,this.correlationId,t,this.apiId),this.browserStorage.removeAccountContext(ke(e),this.correlationId)}cacheNativeTokens(e,t,n,r,o,s,a){const c=nr(n,t.authority,e.id_token||"",t.clientId,r.tid||""),h=t.tokenType===S.POP?Ur:(typeof e.expires_in=="string"?parseInt(e.expires_in,10):e.expires_in)||0,l=a+h,d=this.generateScopes(e.scope,t.scope),g=rr(n,t.authority,o,t.clientId,r.tid||s,d.printScopes(),l,0,V,void 0,t.tokenType,void 0,t.keyId),p={idToken:c,accessToken:g};return this.nativeStorageManager.saveCacheRecord(p,this.correlationId,Se(r),this.apiId,t.storeInCache)}getExpiresInValue(e,t){return e===S.POP?Ur:(typeof t=="string"?parseInt(t,10):t)||0}addTelemetryFromNativeResponse(e){const t=this.getMATSFromResponse(e);return t?(this.performanceClient.addFields({extensionId:this.platformAuthProvider.getExtensionId(),extensionVersion:this.platformAuthProvider.getExtensionVersion(),matsBrokerVersion:t.broker_version,matsAccountJoinOnStart:t.account_join_on_start,matsAccountJoinOnEnd:t.account_join_on_end,matsDeviceJoin:t.device_join,matsPromptBehavior:t.prompt_behavior,matsApiErrorCode:t.api_error_code,matsUiVisible:t.ui_visible,matsSilentCode:t.silent_code,matsSilentBiSubCode:t.silent_bi_sub_code,matsSilentMessage:t.silent_message,matsSilentStatus:t.silent_status,matsHttpStatus:t.http_status,matsHttpEventCount:t.http_event_count},this.correlationId),t):null}getMATSFromResponse(e){if(e)try{return JSON.parse(e)}catch{this.logger.error("0b3l57",this.correlationId)}return null}isResponseFromCache(e){return typeof e.is_cached>"u"?(this.logger.verbose("1okqev",this.correlationId),!1):!!e.is_cached}async initializeNativeRequest(e){this.logger.trace("04j6wj",this.correlationId);const t=await this.getCanonicalAuthority(e),{scopes:n,...r}=e,o=new D(n||[]);o.appendScopes(Qe);const s={...r,accountId:this.accountId,clientId:this.config.auth.clientId,authority:t.urlString,scope:o.printScopes(),redirectUri:Kt(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId),prompt:this.getPrompt(e.prompt),correlationId:this.correlationId,tokenType:e.authenticationScheme,windowTitleSubstring:document.title,extraParameters:{...e.extraParameters},extendedExpiryToken:!1,keyId:e.popKid};if(s.signPopToken&&e.popKid)throw m(gl);if(this.handleExtraBrokerParams(s),s.extraParameters=s.extraParameters||{},s.extraParameters.telemetry=J.MATS_TELEMETRY,e.authenticationScheme===S.POP){const a={resourceRequestUri:e.resourceRequestUri,resourceRequestMethod:e.resourceRequestMethod,shrClaims:e.shrClaims,shrNonce:e.shrNonce,correlationId:this.correlationId},c=new Je(this.browserCrypto,this.performanceClient);let h;if(s.keyId)h=this.browserCrypto.base64UrlEncode(JSON.stringify({kid:s.keyId})),s.signPopToken=!1;else{const l=await u(c.generateCnf.bind(c),gt,this.logger,this.performanceClient,this.correlationId)(a,this.logger);h=l.reqCnfString,s.keyId=l.kid,s.signPopToken=!0}s.reqCnf=h}return this.addRequestSKUs(s),s}async getCanonicalAuthority(e){const t=e.authority||this.config.auth.authority,{azureCloudOptions:n,account:r}=e;r&&await ce(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,t,n,void 0,r);const o=new E(t);return o.validateAsUri(),o}getPrompt(e){switch(this.apiId){case w.ssoSilent:case w.acquireTokenSilent_silentFlow:return this.logger.trace("1hiwaz",this.correlationId),F.NONE}if(!e){this.logger.trace("1qlu04",this.correlationId);return}switch(e){case F.NONE:case F.CONSENT:case F.LOGIN:return this.logger.trace("1ynje4",this.correlationId),e;default:throw this.logger.trace("0nkr6q",this.correlationId),m(dl)}}handleExtraBrokerParams(e){const t=e.extraParameters&&e.extraParameters.hasOwnProperty(bt)&&e.extraParameters.hasOwnProperty(Rt)&&e.extraParameters.hasOwnProperty(ve);if(!e.embeddedClientId&&!t)return;let n="";const r=e.redirectUri;e.embeddedClientId?(e.redirectUri=this.config.auth.redirectUri,n=e.embeddedClientId):e.extraParameters&&(e.redirectUri=e.extraParameters[Rt],n=e.extraParameters[ve]),e.extraParameters={child_client_id:n,child_redirect_uri:r},this.performanceClient?.addFields({embeddedClientId:n,embeddedRedirectUri:r},e.correlationId)}}async function Er(i,e,t,n,r){const o=bh({...i.auth,authority:e},t,n,r);if(jn(o,{sku:$.MSAL_SKU,version:Pe,os:"",cpu:""}),i.system.protocolMode!==B.OIDC&&Gn(o,i.telemetry.application),t.platformBroker&&(ec(o),t.authenticationScheme===S.POP)){const s=new he(n,r),a=new Je(s,r);let c;t.popKid?c=s.encodeKid(t.popKid):c=(await u(a.generateCnf.bind(a),gt,n,r,t.correlationId)(t,n)).reqCnfString,Jn(o,c)}return jt(o,t.correlationId,r),o}async function Sr(i,e,t,n,r){if(!t.codeChallenge)throw v(Vi);const o=await u(Er,ed,n,r,t.correlationId)(i,e,t,n,r);return xn(o,On.CODE),Vn(o,t.codeChallenge,Rn),se(o,{...t.extraQueryParameters,...t.extraParameters}),ir(e,o)}async function _r(i,e,t,n,r,o){if(!n.earJwk)throw m(Do);const s=await Er(e,t,n,r,o);xn(s,On.IDTOKEN_TOKEN_REFRESHTOKEN),dc(s,n.earJwk),Vn(s,n.codeChallenge,Rn),se(s,{...n.extraParameters});const a=new Map;se(a,n.extraQueryParameters||{});const c=ir(t,a);return is(i,c,s)}async function vr(i,e,t,n,r,o){const s=await Er(e,t,n,r,o);xn(s,On.CODE),Vn(s,n.codeChallenge,n.codeChallengeMethod||Rn),se(s,{...n.extraParameters});const a=new Map;se(a,n.extraQueryParameters||{});const c=ir(t,a);return is(i,c,s)}function is(i,e,t){const n=i.createElement("form");return n.method="post",n.action=e,t.forEach((r,o)=>{const s=i.createElement("input");s.hidden=!0,s.name=o,s.value=r,n.appendChild(s)}),i.body.appendChild(n),n}async function os(i,e,t,n,r,o,s,a,c,h){if(a.verbose("11qcow",i.correlationId),!h)throw m(Fo);const l=new he(a,c),d=new vt(n,r,l,a,s,n.system.navigationClient,t,c,h,e,o,i.correlationId),{userRequestState:g}=ut(l.base64Decode,i.state);return u(d.acquireToken.bind(d),Xo,a,c,i.correlationId)({...i,state:g,prompt:void 0})}async function $e(i,e,t,n,r,o,s,a,c,h,l,d){if(ie.removeThrottle(s,r.auth.clientId,i),e.accountId)return u(os,qo,h,l,i.correlationId)(i,e.accountId,n,r,s,a,c,h,l,d);const g={...i,code:e.code||"",codeVerifier:t},p=new ns(o,s,g,h,l);return await u(p.handleCodeResponse.bind(p),td,h,l,i.correlationId)(e,i,n)}async function kr(i,e,t,n,r,o,s,a,c,h,l){if(ie.removeThrottle(o,n.auth.clientId,i),Oo(e,i.state),!e.ear_jwe)throw m(zh);if(!i.earJwk)throw m(Do);const d=JSON.parse(await u(bl,Cd,c,h,i.correlationId)(i.earJwk,e.ear_jwe));if(d.accountId)return u(os,qo,c,h,i.correlationId)(i,d.accountId,t,n,o,s,a,c,h,l);const g=new be(n.auth.clientId,o,new he(c,h),c,h,null,null);g.validateTokenResponse(d,i.correlationId);const p={code:"",state:i.state,nonce:i.nonce,client_info:d.client_info,cloud_graph_host_name:d.cloud_graph_host_name,cloud_instance_host_name:d.cloud_instance_host_name,cloud_instance_name:d.cloud_instance_name,msgraph_host:d.msgraph_host};return await u(g.handleServerTokenResponse.bind(g),tr,c,h,i.correlationId)(d,r,re(),i,t,p,void 0,void 0,void 0,void 0)}const ru=32;async function Ne(i,e,t){const n=ee(iu,hd,e,i,t)(i,e,t),r=await u(ou,ld,e,i,t)(n,i,e,t);return{verifier:n,challenge:r}}function iu(i,e,t){try{const n=new Uint8Array(ru);return ee(El,ud,e,i,t)(n),Ie(n)}catch{throw m(Uo)}}async function ou(i,e,t,n){try{const r=await u(jo,dd,t,e,n)(i);return Ie(new Uint8Array(r))}catch{throw m(Uo)}}class Bt{navigateInternal(e,t){return Bt.defaultNavigateWindow(e,t)}navigateExternal(e,t){return Bt.defaultNavigateWindow(e,t)}static defaultNavigateWindow(e,t){return t.noHistory?window.location.replace(e):window.location.assign(e),new Promise((n,r)=>{setTimeout(()=>{r(m(xt,"failed_to_redirect"))},t.timeout)})}}class su{async sendGetRequestAsync(e,t){let n,r={},o=0;const s=Ri(t);try{n=await fetch(e,{method:ci.GET,headers:s})}catch(a){throw nt(m(window.navigator.onLine?il:Sn),void 0,void 0,a)}r=Oi(n.headers);try{return o=n.status,{headers:r,body:await n.json(),status:o}}catch(a){throw nt(m(ui),o,r,a)}}async sendPostRequestAsync(e,t){const n=t&&t.body||"",r=Ri(t);let o,s=0,a={};try{o=await fetch(e,{method:ci.POST,headers:r,body:n})}catch(c){throw nt(m(window.navigator.onLine?rl:Sn),void 0,void 0,c)}a=Oi(o.headers);try{return s=o.status,{headers:a,body:await o.json(),status:s}}catch(c){throw nt(m(ui),s,a,c)}}}function Ri(i){try{const e=new Headers;if(!(i&&i.headers))return e;const t=i.headers;return Object.entries(t).forEach(([n,r])=>{e.append(n,r)}),e}catch(e){throw nt(m(fl),void 0,void 0,e)}}function Oi(i){try{const e={};return i.forEach((t,n)=>{e[n]=t}),e}catch{throw m(pl)}}const au=6e4,cu=1e4,hu=3e4,ss=2e3;function lu({auth:i,cache:e,system:t,telemetry:n},r){const o={clientId:"",authority:`${Pi}`,knownAuthorities:[],cloudDiscoveryMetadata:"",authorityMetadata:"",redirectUri:typeof window<"u"&&window.location?window.location.href.split("?")[0].split("#")[0]:"",postLogoutRedirectUri:"",clientCapabilities:[],OIDCOptions:{responseMode:Pn.FRAGMENT,defaultScopes:[Mi,Ui,bn]},azureCloudOptions:{azureCloudInstance:Wn.None,tenant:""},instanceAware:!1},s={cacheLocation:Q.SessionStorage,cacheRetentionDays:5},a={loggerCallback:()=>{},logLevel:k.Info,piiLoggingEnabled:!1},h={...{...mo,loggerOptions:a,networkClient:r?new su:kh,navigationClient:new Bt,popupBridgeTimeout:t?.popupBridgeTimeout||au,iframeBridgeTimeout:t?.iframeBridgeTimeout||cu,redirectNavigationTimeout:hu,allowRedirectInIframe:!1,navigatePopups:!0,allowPlatformBroker:!1,nativeBrokerHandshakeTimeout:t?.nativeBrokerHandshakeTimeout||ss,protocolMode:B.AAD},...t,loggerOptions:t?.loggerOptions||a},l={application:{appName:"",appVersion:""},client:new po};if(t?.protocolMode!==B.OIDC&&i?.OIDCOptions&&new te(h.loggerOptions).warning(JSON.stringify(v(Na)),""),t?.protocolMode&&t.protocolMode===B.OIDC&&h?.allowPlatformBroker)throw v(Ma);return{auth:{...o,...i,OIDCOptions:{...o.OIDCOptions,...i?.OIDCOptions}},cache:{...s,...e},system:h,telemetry:{...l,...n}}}class zt{constructor(e,t,n,r){this.logger=e,this.handshakeTimeoutMs=t,this.extensionId=r,this.resolvers=new Map,this.handshakeResolvers=new Map,this.messageChannel=new MessageChannel,this.windowListener=this.onWindowMessage.bind(this),this.performanceClient=n,this.handshakeEvent=n.startMeasurement(ad),this.platformAuthType=J.PLATFORM_EXTENSION_PROVIDER}async sendMessage(e){this.logger.trace("0on4p2",e.correlationId);const t={method:et.GetToken,request:e},n={channel:J.CHANNEL_ID,extensionId:this.extensionId,responseId:Re(),body:t};this.logger.trace("1qadfi",e.correlationId),this.logger.tracePii("1xm533",e.correlationId),this.messageChannel.port1.postMessage(n);const r=await new Promise((s,a)=>{this.resolvers.set(n.responseId,{resolve:s,reject:a})});return this.validatePlatformBrokerResponse(r)}static async createProvider(e,t,n,r){e.trace("15zfnw",r);try{const o=new zt(e,t,n,J.PREFERRED_EXTENSION_ID);return await o.sendHandshakeRequest(r),o}catch{const s=new zt(e,t,n);return await s.sendHandshakeRequest(r),s}}async sendHandshakeRequest(e){this.logger.trace("1dpg9o",e),window.addEventListener("message",this.windowListener,!1);const t={channel:J.CHANNEL_ID,extensionId:this.extensionId,responseId:Re(),body:{method:et.HandshakeRequest}};return this.handshakeEvent.add({extensionId:this.extensionId,extensionHandshakeTimeoutMs:this.handshakeTimeoutMs}),this.messageChannel.port1.onmessage=n=>{this.onChannelMessage(n)},window.postMessage(t,window.origin,[this.messageChannel.port2]),new Promise((n,r)=>{this.handshakeResolvers.set(t.responseId,{resolve:n,reject:r}),this.timeoutId=window.setTimeout(()=>{window.removeEventListener("message",this.windowListener,!1),this.messageChannel.port1.close(),this.messageChannel.port2.close(),this.handshakeEvent.end({extensionHandshakeTimedOut:!0,success:!1}),r(m(hl)),this.handshakeResolvers.delete(t.responseId)},this.handshakeTimeoutMs)})}onWindowMessage(e){const t=_n();if(this.logger.trace("0jpn5u",t),e.source!==window)return;const n=e.data;if(!(!n.channel||n.channel!==J.CHANNEL_ID)&&!(n.extensionId&&n.extensionId!==this.extensionId)&&n.body.method===et.HandshakeRequest){const r=this.handshakeResolvers.get(n.responseId);if(!r){this.logger.trace("07buhm",t);return}this.logger.verbose(n.extensionId?"0xrkug":"No extension installed",t),clearTimeout(this.timeoutId),this.messageChannel.port1.close(),this.messageChannel.port2.close(),window.removeEventListener("message",this.windowListener,!1),this.handshakeEvent.end({success:!1,extensionInstalled:!1}),r.reject(m(ll))}}onChannelMessage(e){const t=_n();this.logger.trace("1py8yf",t);const n=e.data,r=this.resolvers.get(n.responseId),o=this.handshakeResolvers.get(n.responseId);try{const s=n.body.method;if(s===et.Response){if(!r)return;const a=n.body.response;if(this.logger.trace("19hpgm",t),this.logger.tracePii("179a24",t),a.status!=="Success")r.reject(Ft(a.code,a.description,a.ext));else if(a.result)a.result.code&&a.result.description?r.reject(Ft(a.result.code,a.result.description,a.result.ext)):r.resolve(a.result);else throw mn(wn,"Event does not contain result.");this.resolvers.delete(n.responseId)}else if(s===et.HandshakeResponse){if(!o){this.logger.trace("082qnt",t);return}clearTimeout(this.timeoutId),window.removeEventListener("message",this.windowListener,!1),this.extensionId=n.extensionId,this.extensionVersion=n.body.version,this.logger.verbose("0yf5ib",t),this.handshakeEvent.end({extensionInstalled:!0,success:!0}),o.resolve(),this.handshakeResolvers.delete(n.responseId)}}catch(s){this.logger.error("0xf978",t),this.logger.errorPii("04i99o",t),this.logger.errorPii("0xdvsy",t),r?r.reject(s):o&&o.reject(s)}}validatePlatformBrokerResponse(e){if(e.hasOwnProperty("access_token")&&e.hasOwnProperty("id_token")&&e.hasOwnProperty("client_info")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scope")&&e.hasOwnProperty("expires_in"))return e;throw mn(wn,"Response missing expected properties.")}getExtensionId(){return this.extensionId}getExtensionVersion(){return this.extensionVersion}getExtensionName(){return this.getExtensionId()===J.PREFERRED_EXTENSION_ID?"chrome":this.getExtensionId()?.length?"unknown":void 0}}class br{constructor(e,t,n){this.logger=e,this.performanceClient=t,this.correlationId=n,this.platformAuthType=J.PLATFORM_DOM_PROVIDER}static async createProvider(e,t,n){if(e.trace("12mj4a",n),window.navigator?.platformAuthentication&&(await window.navigator.platformAuthentication.getSupportedContracts(J.MICROSOFT_ENTRA_BROKERID))?.includes(J.PLATFORM_DOM_APIS))return e.trace("1h5q1r",n),new br(e,t,n)}getExtensionId(){return J.MICROSOFT_ENTRA_BROKERID}getExtensionVersion(){return""}getExtensionName(){return J.DOM_API_NAME}async sendMessage(e){this.logger.trace("02bcil",e.correlationId);try{const t=this.initializePlatformDOMRequest(e),n=await window.navigator.platformAuthentication.executeGetToken(t);return this.validatePlatformBrokerResponse(n,e.correlationId)}catch(t){throw this.logger.error("11im7g",e.correlationId),t}}initializePlatformDOMRequest(e){this.logger.trace("15d6yv",e.correlationId);const{accountId:t,clientId:n,authority:r,scope:o,redirectUri:s,correlationId:a,state:c,storeInCache:h,embeddedClientId:l,extraParameters:d,...g}=e,p=this.getDOMExtraParams(g);return{accountId:t,brokerId:this.getExtensionId(),authority:r,clientId:n,correlationId:a||this.correlationId,extraParameters:{...d,...p},isSecurityTokenService:!1,redirectUri:s,scope:o,state:c,storeInCache:h,embeddedClientId:l}}validatePlatformBrokerResponse(e,t){if(e.hasOwnProperty("isSuccess")){if(e.hasOwnProperty("accessToken")&&e.hasOwnProperty("idToken")&&e.hasOwnProperty("clientInfo")&&e.hasOwnProperty("account")&&e.hasOwnProperty("scopes")&&e.hasOwnProperty("expiresIn"))return this.logger.trace("0h4vei",t),this.convertToPlatformBrokerResponse(e,t);if(e.hasOwnProperty("error")){const n=e;if(n.isSuccess===!1&&n.error&&n.error.code)throw this.logger.trace("0g92vm",t),Ft(n.error.code,n.error.description,{error:parseInt(n.error.errorCode),protocol_error:n.error.protocolError,status:n.error.status,properties:n.error.properties})}}throw mn(wn,"Response missing expected properties.")}convertToPlatformBrokerResponse(e,t){return this.logger.trace("14913t",t),{access_token:e.accessToken,id_token:e.idToken,client_info:e.clientInfo,account:e.account,expires_in:e.expiresIn,scope:e.scopes,state:e.state||"",properties:e.properties||{},extendedLifetimeToken:e.extendedLifetimeToken??!1,shr:e.proofOfPossessionPayload}}getDOMExtraParams(e){return{...Object.entries(e).reduce((r,[o,s])=>(r[o]=String(s),r),{})}}}async function du(i,e,t,n){i.trace("134j0v",t);const r=uu();i.trace("04c81g",t);let o;try{r&&(o=await br.createProvider(i,e,t)),o||(i.trace("0l3na8",t),o=await zt.createProvider(i,n||ss,e,t))}catch(s){i.trace("0icbd7",s)}return o}function uu(){let i;try{return i=window[Q.SessionStorage],i?.getItem(Rd)==="true"}catch{return!1}}function lt(i,e,t,n,r){if(e.trace("0uko3r",t),!i.system.allowPlatformBroker)return e.trace("04hozs",t),!1;if(!n)return e.trace("0kvv1r",t),!1;if(r)switch(r){case S.BEARER:case S.POP:return e.trace("18tev1",t),!0;default:return e.trace("1dd2nh",t),!1}return!0}class gu extends qe{constructor(e,t,n,r,o,s,a,c,h,l){super(e,t,n,r,o,s,a,h,l),this.nativeStorage=c,this.eventHandler=o}acquireToken(e,t){let n;try{if(n={popupName:this.generatePopupName(e.scopes||Qe,e.authority||this.config.auth.authority),popupWindowAttributes:e.popupWindowAttributes||{},popupWindowParent:e.popupWindowParent??window},this.performanceClient.addFields({isAsyncPopup:!this.config.system.navigatePopups},this.correlationId),this.config.system.navigatePopups){const o={...e,httpMethod:ts(e,this.config.system.protocolMode)};return this.logger.verbose("1f9ok3",this.correlationId),n.popup=this.openSizedPopup("about:blank",n),this.acquireTokenPopupAsync(o,n,t)}else return this.logger.verbose("162h4u",this.correlationId),this.acquireTokenPopupAsync(e,n,t)}catch(r){return Promise.reject(r)}}logout(e){try{this.logger.verbose("068rup",this.correlationId);const t=this.initializeLogoutRequest(e),n={popupName:this.generateLogoutPopupName(t),popupWindowAttributes:e?.popupWindowAttributes||{},popupWindowParent:e?.popupWindowParent??window},r=e&&e.authority,o=e&&e.mainWindowRedirectUri;return this.config.system.navigatePopups?(this.logger.verbose("1a28da",this.correlationId),n.popup=this.openSizedPopup("about:blank",n),this.logoutPopupAsync(t,n,r,o)):(this.logger.verbose("1phd8u",this.correlationId),this.logoutPopupAsync(t,n,r,o))}catch(t){return Promise.reject(t)}}async acquireTokenPopupAsync(e,t,n){this.logger.verbose("1g77pg",this.correlationId);const r=await u(tn,Zt,this.logger,this.performanceClient,this.correlationId)(e,C.Popup,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.popup&&Yo(r.authority);const o=lt(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);return r.platformBroker=o,this.config.system.protocolMode===B.EAR?this.executeEarFlow(r,t,n):this.executeCodeFlow(r,t,n)}async executeCodeFlow(e,t,n){const r=e.correlationId,o=z(w.acquireTokenPopup,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=n||await u(Ne,Oe,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),a={...e,codeChallenge:s.challenge};try{const c=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,r)({serverTelemetryManager:o,requestAuthority:a.authority,requestAzureCloudOptions:a.azureCloudOptions,requestExtraQueryParameters:a.extraQueryParameters,account:a.account});if(a.httpMethod===Fe.POST)return await this.executeCodeFlowWithPost(a,t,c,s.verifier);{const h=await u(Sr,er,this.logger,this.performanceClient,r)(this.config,c.authority,a,this.logger,this.performanceClient),l=this.initiateAuthRequest(h,t);this.eventHandler.emitEvent(y.POPUP_OPENED,C.Popup,{popupWindow:l},null);const d=await Ke(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),g=ee(ot,it,this.logger,this.performanceClient,this.correlationId)(d,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return await u($e,je,this.logger,this.performanceClient,r)(e,g,s.verifier,w.acquireTokenPopup,this.config,c,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}catch(c){throw t.popup?.close(),c instanceof _&&(c.setCorrelationId(this.correlationId),o.cacheFailedRequest(c)),c}}async executeEarFlow(e,t,n){const{correlationId:r,authority:o,azureCloudOptions:s,extraQueryParameters:a,account:c}=e,h=await u(ce,_e,this.logger,this.performanceClient,r)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,o,s,a,c),l=await u(fr,Ir,this.logger,this.performanceClient,r)(),d=n||await u(Ne,Oe,this.logger,this.performanceClient,r)(this.performanceClient,this.logger,r),g={...e,earJwk:l,codeChallenge:d.challenge},p=t.popup||this.openPopup("about:blank",t);(await _r(p.document,this.config,h,g,this.logger,this.performanceClient)).submit();const A=await u(Ke,Ht,this.logger,this.performanceClient,r)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,g),O=ee(ot,it,this.logger,this.performanceClient,this.correlationId)(A,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);if(!O.ear_jwe&&O.code){const j=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,r)({serverTelemetryManager:z(w.acquireTokenPopup,this.config.auth.clientId,r,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:h});return u($e,je,this.logger,this.performanceClient,r)(g,O,d.verifier,w.acquireTokenPopup,this.config,j,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return u(kr,yr,this.logger,this.performanceClient,r)(g,O,w.acquireTokenPopup,this.config,h,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async executeCodeFlowWithPost(e,t,n,r){const o=e.correlationId,s=await u(ce,_e,this.logger,this.performanceClient,o)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger),a=t.popup||this.openPopup("about:blank",t);(await vr(a.document,this.config,s,e,this.logger,this.performanceClient)).submit();const h=await u(Ke,Ht,this.logger,this.performanceClient,o)(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e),l=ee(ot,it,this.logger,this.performanceClient,this.correlationId)(h,this.config.auth.OIDCOptions.responseMode,this.logger,this.correlationId);return u($e,je,this.logger,this.performanceClient,o)(e,l,r,w.acquireTokenPopup,this.config,n,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async logoutPopupAsync(e,t,n,r){this.logger.verbose("0b7yrk",this.correlationId),this.eventHandler.emitEvent(y.LOGOUT_START,C.Popup,e);const o=z(w.logoutPopup,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{await wr(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,e.account);const s=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:o,requestAuthority:n,account:e.account||void 0});try{s.authority.endSessionEndpoint}catch{if(e.account?.homeAccountId&&e.postLogoutRedirectUri&&s.authority.protocolMode===B.OIDC){if(this.eventHandler.emitEvent(y.LOGOUT_SUCCESS,C.Popup,e),r){const h={apiId:w.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},l=E.getAbsoluteUrl(r,pe());await this.navigationClient.navigateInternal(l,h)}t.popup?.close();return}}const a=s.getLogoutUri(e);this.eventHandler.emitEvent(y.LOGOUT_SUCCESS,C.Popup,e);const c=this.openPopup(a,t);if(this.eventHandler.emitEvent(y.POPUP_OPENED,C.Popup,{popupWindow:c},null),await Ke(this.config.system.popupBridgeTimeout,this.logger,this.browserCrypto,e).catch(()=>{}),r){const h={apiId:w.logoutPopup,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},l=E.getAbsoluteUrl(r,pe());this.logger.verbose("0qcur2",this.correlationId),this.logger.verbosePii("0oj7lk",this.correlationId),await this.navigationClient.navigateInternal(l,h)}else this.logger.verbose("03zgcf",this.correlationId)}catch(s){throw t.popup?.close(),s instanceof _&&(s.setCorrelationId(this.correlationId),o.cacheFailedRequest(s)),this.eventHandler.emitEvent(y.LOGOUT_FAILURE,C.Popup,null,s),this.eventHandler.emitEvent(y.LOGOUT_END,C.Popup),s}this.eventHandler.emitEvent(y.LOGOUT_END,C.Popup)}initiateAuthRequest(e,t){if(e)return this.logger.infoPii("1kcr9k",this.correlationId),this.openPopup(e,t);throw this.logger.error("1l7hyp",this.correlationId),m(ar)}openPopup(e,t){try{let n;if(t.popup?(n=t.popup,this.logger.verbosePii("0cgeo7",this.correlationId),n.location.assign(e)):typeof t.popup>"u"&&(this.logger.verbosePii("0c2awd",this.correlationId),n=this.openSizedPopup(e,t)),!n)throw m(Qh);return n.focus&&n.focus(),this.currentWindow=n,n}catch{throw this.logger.error("0dxfb9",this.correlationId),m(Wh)}}openSizedPopup(e,{popupName:t,popupWindowAttributes:n,popupWindowParent:r}){const o=r.screenLeft?r.screenLeft:r.screenX,s=r.screenTop?r.screenTop:r.screenY,a=r.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,c=r.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;let h=n.popupSize?.width,l=n.popupSize?.height,d=n.popupPosition?.top,g=n.popupPosition?.left;return(!h||h<0||h>a)&&(this.logger.verbose("08vfmo",this.correlationId),h=$.POPUP_WIDTH),(!l||l<0||l>c)&&(this.logger.verbose("09cxa0",this.correlationId),l=$.POPUP_HEIGHT),(!d||d<0||d>c)&&(this.logger.verbose("1qh4wo",this.correlationId),d=Math.max(0,c/2-$.POPUP_HEIGHT/2+s)),(!g||g<0||g>a)&&(this.logger.verbose("1sz3en",this.correlationId),g=Math.max(0,a/2-$.POPUP_WIDTH/2+o)),r.open(e,t,`width=${h}, height=${l}, top=${d}, left=${g}, scrollbars=yes`)}generatePopupName(e,t){return`${$.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${e.join("-")}.${t}.${this.correlationId}`}generateLogoutPopupName(e){const t=e.account&&e.account.homeAccountId;return`${$.POPUP_NAME_PREFIX}.${this.config.auth.clientId}.${t}.${this.correlationId}`}}function fu(){if(typeof window>"u"||typeof window.performance>"u"||typeof window.performance.getEntriesByType!="function")return;const i=window.performance.getEntriesByType("navigation");return(i.length?i[0]:void 0)?.type}class pu extends qe{constructor(e,t,n,r,o,s,a,c,h,l){super(e,t,n,r,o,s,a,h,l),this.nativeStorage=c}async acquireToken(e){const t=await u(tn,Zt,this.logger,this.performanceClient,this.correlationId)(e,C.Redirect,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);t.platformBroker=lt(this.config,this.logger,this.correlationId,this.platformAuthProvider,e.authenticationScheme);const n=o=>{o.persisted&&(this.logger.verbose("0udvtt",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),this.eventHandler.emitEvent(y.RESTORE_FROM_BFCACHE,C.Redirect))},r=this.getRedirectStartPage(e.redirectStartPage);this.logger.verbosePii("0zao0a",this.correlationId),this.browserStorage.setTemporaryCache(R.ORIGIN_URI,r,!0),window.addEventListener("pageshow",n);try{this.config.system.protocolMode===B.EAR?await this.executeEarFlow(t):await this.executeCodeFlow(t)}catch(o){throw o instanceof _&&o.setCorrelationId(this.correlationId),window.removeEventListener("pageshow",n),o}}async executeCodeFlow(e){const t=e.correlationId,n=z(w.acquireTokenRedirect,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),r=await u(Ne,Oe,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),o={...e,codeChallenge:r.challenge};this.browserStorage.cacheAuthorizeRequest(o,this.correlationId,r.verifier);try{if(o.httpMethod===Fe.POST)return await this.executeCodeFlowWithPost(o);{const s=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:o.authority,requestAzureCloudOptions:o.azureCloudOptions,requestExtraQueryParameters:o.extraQueryParameters,account:o.account}),a=await u(Sr,er,this.logger,this.performanceClient,e.correlationId)(this.config,s.authority,o,this.logger,this.performanceClient);return await this.initiateAuthRequest(a)}}catch(s){throw s instanceof _&&(s.setCorrelationId(this.correlationId),n.cacheFailedRequest(s)),s}}async executeEarFlow(e){const{correlationId:t,authority:n,azureCloudOptions:r,extraQueryParameters:o,account:s}=e,a=await u(ce,_e,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,n,r,o,s),c=await u(fr,Ir,this.logger,this.performanceClient,t)(),h=await u(Ne,Oe,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),l={...e,earJwk:c,codeChallenge:h.challenge};return this.browserStorage.cacheAuthorizeRequest(l,this.correlationId,h.verifier),(await _r(document,this.config,a,l,this.logger,this.performanceClient)).submit(),new Promise((g,p)=>{setTimeout(()=>{p(m(xt,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async executeCodeFlowWithPost(e){const t=e.correlationId,n=await u(ce,_e,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger);return this.browserStorage.cacheAuthorizeRequest(e,this.correlationId),(await vr(document,this.config,n,e,this.logger,this.performanceClient)).submit(),new Promise((o,s)=>{setTimeout(()=>{s(m(xt,"failed_to_redirect"))},this.config.system.redirectNavigationTimeout)})}async handleRedirectPromise(e,t,n,r){const o=z(w.handleRedirectPromise,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),s=r?.navigateToLoginRequestUrl??!0;try{const[a,c]=this.getRedirectResponse(r?.hash||"");if(!a)return this.logger.info("1qmv0q",this.correlationId),this.browserStorage.resetRequestCache(this.correlationId),fu()!=="back_forward"?n.event.errorCode="no_server_response":this.logger.verbose("1eqegq",this.correlationId),null;const h=this.browserStorage.getTemporaryCache(R.ORIGIN_URI,this.correlationId,!0)||"",l=Jr(h),d=Jr(window.location.href);if(l===d&&s)return this.logger.verbose("11yred",this.correlationId),h.indexOf("#")>-1&&Ml(h),await this.handleResponse(a,e,t,o);if(s){if(!Xt()||this.config.system.allowRedirectInIframe){this.browserStorage.setTemporaryCache(R.URL_HASH,c,!0);const g={apiId:w.handleRedirectPromise,timeout:this.config.system.redirectNavigationTimeout,noHistory:!0};let p=!0;if(!h||h==="null"){const I=Ll();this.browserStorage.setTemporaryCache(R.ORIGIN_URI,I,!0),this.logger.warning("1dutq1",this.correlationId),p=await this.navigationClient.navigateInternal(I,g)}else this.logger.verbose("08jpy1",this.correlationId),p=await this.navigationClient.navigateInternal(h,g);if(!p)return await this.handleResponse(a,e,t,o)}}else return this.logger.verbose("0v4sdv",this.correlationId),await this.handleResponse(a,e,t,o);return null}catch(a){throw a instanceof _&&(a.setCorrelationId(this.correlationId),o.cacheFailedRequest(a)),a}}getRedirectResponse(e){this.logger.verbose("1c5i8m",this.correlationId);let t=e;t||(this.config.auth.OIDCOptions.responseMode===Pn.QUERY?t=window.location.search:t=window.location.hash);let n=Pt(t);if(n){try{Vd(n,this.browserCrypto,C.Redirect)}catch(o){return o instanceof _&&this.logger.error("0bkq6p",this.correlationId),[null,""]}return Jo(window),this.logger.verbose("00uvho",this.correlationId),[n,t]}const r=this.browserStorage.getTemporaryCache(R.URL_HASH,this.correlationId,!0);return this.browserStorage.removeItem(this.browserStorage.generateCacheKey(R.URL_HASH)),r&&(n=Pt(r),n)?(this.logger.verbose("001671",this.correlationId),[n,r]):[null,""]}async handleResponse(e,t,n,r){if(!e.state)throw m(cr);const{authority:s,azureCloudOptions:a,extraQueryParameters:c,account:h}=t;if(e.ear_jwe){const d=await u(ce,_e,this.logger,this.performanceClient,t.correlationId)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,s,a,c,h);return u(kr,yr,this.logger,this.performanceClient,t.correlationId)(t,e,w.acquireTokenRedirect,this.config,d,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}const l=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:r,requestAuthority:t.authority});return u($e,je,this.logger,this.performanceClient,t.correlationId)(t,e,n,w.acquireTokenRedirect,this.config,l,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}async initiateAuthRequest(e){if(this.logger.verbose("0yaw2e",this.correlationId),e){this.logger.infoPii("1luf83",this.correlationId);const t={apiId:w.acquireTokenRedirect,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},n=this.config.auth.onRedirectNavigate;if(typeof n=="function")if(this.logger.verbose("1nehvl",this.correlationId),n(e)!==!1){this.logger.verbose("1a0jxh",this.correlationId),await this.navigationClient.navigateExternal(e,t);return}else{this.logger.verbose("09k5h5",this.correlationId);return}else{this.logger.verbose("0klwf7",this.correlationId),await this.navigationClient.navigateExternal(e,t);return}}else throw this.logger.info("0rlh4e",this.correlationId),m(ar)}async logout(e){this.logger.verbose("1rkurh",this.correlationId);const t=this.initializeLogoutRequest(e),n=z(w.logout,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{this.eventHandler.emitEvent(y.LOGOUT_START,C.Redirect,e),await wr(this.browserStorage,this.browserCrypto,this.logger,this.correlationId,t.account);const r={apiId:w.logout,timeout:this.config.system.redirectNavigationTimeout,noHistory:!1},o=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:e&&e.authority,requestExtraQueryParameters:e?.extraQueryParameters,account:e&&e.account||void 0});if(o.authority.protocolMode===B.OIDC)try{o.authority.endSessionEndpoint}catch{if(t.account?.homeAccountId){this.eventHandler.emitEvent(y.LOGOUT_SUCCESS,C.Redirect,t);return}}const s=o.getLogoutUri(t);t.account?.homeAccountId&&this.eventHandler.emitEvent(y.LOGOUT_SUCCESS,C.Redirect,t);const a=this.config.auth.onRedirectNavigate;if(typeof a=="function")if(a(s)!==!1){this.logger.verbose("06v57e",this.correlationId),this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,ge.SIGNOUT),await this.navigationClient.navigateExternal(s,r);return}else this.browserStorage.setInteractionInProgress(!1),this.logger.verbose("0xqes1",this.correlationId);else{this.browserStorage.getInteractionInProgress()||this.browserStorage.setInteractionInProgress(!0,ge.SIGNOUT),await this.navigationClient.navigateExternal(s,r);return}}catch(r){throw r instanceof _&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),this.eventHandler.emitEvent(y.LOGOUT_FAILURE,C.Redirect,null,r),this.eventHandler.emitEvent(y.LOGOUT_END,C.Redirect),r}this.eventHandler.emitEvent(y.LOGOUT_END,C.Redirect)}getRedirectStartPage(e){const t=e||window.location.href;return E.getAbsoluteUrl(t,pe())}}async function mu(i,e,t,n){if(!i)throw t.info("1l7hyp",n),m(ar);return ee(Iu,ql,t,e,n)(i)}async function Cu(i,e,t,n,r){const o=Rr();if(!o.contentDocument)throw"No document associated with iframe!";return(await vr(o.contentDocument,i,e,t,n,r)).submit(),o}async function yu(i,e,t,n,r){const o=Rr();if(!o.contentDocument)throw"No document associated with iframe!";return(await _r(o.contentDocument,i,e,t,n,r)).submit(),o}function Iu(i){const e=Rr();return e.src=i,e}function Rr(){const i=document.createElement("iframe");return i.className="msalSilentIframe",i.style.visibility="hidden",i.style.position="absolute",i.style.width=i.style.height="0",i.style.border="0",i.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms"),i.setAttribute("allow","local-network-access *"),document.body.appendChild(i),i}class Tu extends qe{constructor(e,t,n,r,o,s,a,c,h,l,d){super(e,t,n,r,o,s,c,l,d),this.apiId=a,this.nativeStorage=h}async acquireToken(e){!e.loginHint&&!e.sid&&(!e.account||!e.account.username)&&this.logger.warning("1kl318",this.correlationId);const t={...e};t.prompt?t.prompt!==F.NONE&&t.prompt!==F.NO_SESSION&&(this.logger.warning("0bmctg",this.correlationId),t.prompt=F.NONE):t.prompt=F.NONE;const n=await u(tn,Zt,this.logger,this.performanceClient,this.correlationId)(t,C.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId);return n.platformBroker=lt(this.config,this.logger,this.correlationId,this.platformAuthProvider,n.authenticationScheme),Yo(n.authority),this.config.system.protocolMode===B.EAR?this.executeEarFlow(n):this.executeCodeFlow(n)}async executeCodeFlow(e){let t;const n=z(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{return t=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,e.correlationId)({serverTelemetryManager:n,requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account}),await u(this.silentTokenHelper.bind(this),Ii,this.logger,this.performanceClient,e.correlationId)(t,e)}catch(r){if(r instanceof _&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),!t||!(r instanceof _)||r.errorCode!==$.INVALID_GRANT_ERROR)throw r;return this.performanceClient.addFields({retryError:r.errorCode},this.correlationId),await u(this.silentTokenHelper.bind(this),Ii,this.logger,this.performanceClient,this.correlationId)(t,e)}}async executeEarFlow(e){const{correlationId:t,authority:n,azureCloudOptions:r,extraQueryParameters:o,account:s}=e,a=await u(ce,_e,this.logger,this.performanceClient,t)(this.config,this.correlationId,this.performanceClient,this.browserStorage,this.logger,n,r,o,s),c=await u(fr,Ir,this.logger,this.performanceClient,t)(),h=await u(Ne,Oe,this.logger,this.performanceClient,t)(this.performanceClient,this.logger,t),l={...e,earJwk:c,codeChallenge:h.challenge};await u(yu,hn,this.logger,this.performanceClient,t)(this.config,a,l,this.logger,this.performanceClient);const d=this.config.auth.OIDCOptions.responseMode,g=await u(Ke,Ht,this.logger,this.performanceClient,t)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,e),p=ee(ot,it,this.logger,this.performanceClient,t)(g,d,this.logger,this.correlationId);if(!p.ear_jwe&&p.code){const I=await u(this.createAuthCodeClient.bind(this),ye,this.logger,this.performanceClient,t)({serverTelemetryManager:z(this.apiId,this.config.auth.clientId,t,this.browserStorage,this.logger),requestAuthority:e.authority,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account,authority:a});return u($e,je,this.logger,this.performanceClient,t)(l,p,h.verifier,this.apiId,this.config,I,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}else return u(kr,yr,this.logger,this.performanceClient,t)(l,p,this.apiId,this.config,a,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}logout(){return Promise.reject(m(hr))}async silentTokenHelper(e,t){const n=t.correlationId,r=await u(Ne,Oe,this.logger,this.performanceClient,n)(this.performanceClient,this.logger,n),o={...t,codeChallenge:r.challenge};if(t.httpMethod===Fe.POST)await u(Cu,hn,this.logger,this.performanceClient,n)(this.config,e.authority,o,this.logger,this.performanceClient);else{const h=await u(Sr,er,this.logger,this.performanceClient,n)(this.config,e.authority,o,this.logger,this.performanceClient);await u(mu,hn,this.logger,this.performanceClient,n)(h,this.performanceClient,this.logger,n)}const s=this.config.auth.OIDCOptions.responseMode,a=await u(Ke,Ht,this.logger,this.performanceClient,n)(this.config.system.iframeBridgeTimeout,this.logger,this.browserCrypto,t),c=ee(ot,it,this.logger,this.performanceClient,n)(a,s,this.logger,this.correlationId);return u($e,je,this.logger,this.performanceClient,n)(t,c,r.verifier,this.apiId,this.config,e,this.browserStorage,this.nativeStorage,this.eventHandler,this.logger,this.performanceClient,this.platformAuthProvider)}}class wu extends qe{async acquireToken(e){const t=await u(Ar,Cr,this.logger,this.performanceClient,e.correlationId)(e,this.config,this.performanceClient,this.logger,this.correlationId),n={...e,...t};e.redirectUri&&(n.redirectUri=Kt(e.redirectUri,this.config.auth.redirectUri,this.logger,this.correlationId));const r=z(w.acquireTokenSilent_silentFlow,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger),o=await this.createRefreshTokenClient({serverTelemetryManager:r,authorityUrl:n.authority,azureCloudOptions:n.azureCloudOptions,account:n.account});return u(o.acquireTokenByRefreshToken.bind(o),Ql,this.logger,this.performanceClient,e.correlationId)(n,w.acquireTokenSilent_silentFlow).catch(s=>{throw s.setCorrelationId(this.correlationId),r.cacheFailedRequest(s),s})}logout(){return Promise.reject(m(hr))}async createRefreshTokenClient(e){const t=await u(this.getClientConfiguration.bind(this),qt,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:e.serverTelemetryManager,requestAuthority:e.authorityUrl,requestAzureCloudOptions:e.azureCloudOptions,requestExtraQueryParameters:e.extraQueryParameters,account:e.account});return new _h(t,this.performanceClient)}}class Au extends Ro{constructor(e,t){super(e,t),this.includeRedirectUri=!1}}class Eu extends qe{constructor(e,t,n,r,o,s,a,c,h,l){super(e,t,n,r,o,s,c,h,l),this.apiId=a}async acquireToken(e){if(!e.code)throw m(ol);const t=await u(tn,Zt,this.logger,this.performanceClient,this.correlationId)(e,C.Silent,this.config,this.browserCrypto,this.browserStorage,this.logger,this.performanceClient,this.correlationId),n=z(this.apiId,this.config.auth.clientId,this.correlationId,this.browserStorage,this.logger);try{const r={...t,code:e.code},o=await u(this.getClientConfiguration.bind(this),qt,this.logger,this.performanceClient,this.correlationId)({serverTelemetryManager:n,requestAuthority:t.authority,requestAzureCloudOptions:t.azureCloudOptions,requestExtraQueryParameters:t.extraQueryParameters,account:t.account}),s=new Au(o,this.performanceClient);this.logger.verbose("1uic5e",this.correlationId);const a=new ns(s,this.browserStorage,r,this.logger,this.performanceClient);return await u(a.handleCodeResponseFromServer.bind(a),wo,this.logger,this.performanceClient,this.correlationId)({code:e.code,msgraph_host:e.msGraphHost,cloud_graph_host_name:e.cloudGraphHostName,cloud_instance_host_name:e.cloudInstanceHostName},t,this.apiId,!1)}catch(r){throw r instanceof _&&(r.setCorrelationId(this.correlationId),n.cacheFailedRequest(r)),r}}logout(){return Promise.reject(m(hr))}}function Su(i,e,t,n){const r=window.msal?.clientIds||[],o=r.length,s=r.filter(a=>a===i).length;s>1&&t.warning("1e88vg",n),e.add({msalInstanceCount:o,sameClientIdInstanceCount:s})}function wt(i,e,t){try{mr(i)}catch(n){throw e.end({success:!1},n,t),n}}class Or{constructor(e){this.operatingContext=e,this.isBrowserEnvironment=this.operatingContext.isBrowserEnvironment(),this.config=e.getConfig(),this.initialized=!1,this.logger=this.operatingContext.getLogger(),this.networkClient=this.config.system.networkClient,this.navigationClient=this.config.system.navigationClient,this.redirectResponse=new Map,this.hybridAuthCodeResponses=new Map,this.performanceClient=this.config.telemetry.client,this.browserCrypto=this.isBrowserEnvironment?new he(this.logger,this.performanceClient):Nt,this.eventHandler=new zd(this.logger),this.browserStorage=this.isBrowserEnvironment?new kn(this.config.auth.clientId,this.config.cache,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler,Eh(this.config.auth)):Ld(this.config.auth.clientId,this.logger,this.performanceClient,this.eventHandler);const t={cacheLocation:Q.MemoryStorage,cacheRetentionDays:5};this.nativeInternalStorage=new kn(this.config.auth.clientId,t,this.browserCrypto,this.logger,this.performanceClient,this.eventHandler),this.activeSilentTokenRequests=new Map,this.trackPageVisibility=this.trackPageVisibility.bind(this),this.trackPageVisibilityWithMeasurement=this.trackPageVisibilityWithMeasurement.bind(this)}static async createController(e,t){const n=new Or(e);return await n.initialize(t),n}trackPageVisibility(e){e&&(this.logger.info("16v6hv",e),this.performanceClient.incrementFields({visibilityChangeCount:1},e))}async initialize(e){const t=this.getRequestCorrelationId(e);if(this.logger.trace("1f7joy",t),this.initialized){this.logger.info("061m5x",t);return}if(!this.isBrowserEnvironment){this.logger.info("19fvpi",t),this.initialized=!0,this.eventHandler.emitEvent(y.INITIALIZE_END);return}const n=e?.correlationId||this.getRequestCorrelationId(),r=this.config.system.allowPlatformBroker,o=this.performanceClient.startMeasurement(_d,n);if(this.eventHandler.emitEvent(y.INITIALIZE_START),this.logMultipleInstances(o,n),await u(this.browserStorage.initialize.bind(this.browserStorage),Xl,this.logger,this.performanceClient,n)(n),r)try{this.platformAuthProvider=await du(this.logger,this.performanceClient,n,this.config.system.nativeBrokerHandshakeTimeout)}catch(s){this.logger.verbose(s,n)}this.config.cache.cacheLocation===Q.LocalStorage&&this.eventHandler.subscribeCrossTab(),!this.config.system.navigatePopups&&await this.preGeneratePkceCodes(n),this.initialized=!0,this.eventHandler.emitEvent(y.INITIALIZE_END),o.end({allowPlatformBroker:r,success:!0})}async handleRedirectPromise(e){if(this.logger.verbose("02l8bm",""),Qo(this.initialized),this.isBrowserEnvironment){const t=e?.hash||"";let n=this.redirectResponse.get(t);return typeof n>"u"?(n=this.handleRedirectPromiseInternal(e),this.redirectResponse.set(t,n),this.logger.verbose("1wn9kp","")):this.logger.verbose("0w0gm3",""),n}return this.logger.verbose("12xi63",""),null}async handleRedirectPromiseInternal(e){if(!this.browserStorage.isInteractionInProgress(!0))return this.logger.info("0le6uv",""),null;if(this.browserStorage.getInteractionInProgress()?.type===ge.SIGNOUT)return this.logger.verbose("1ywcv2",""),this.browserStorage.setInteractionInProgress(!1),Promise.resolve(null);const n=this.getAllAccounts(),r=this.browserStorage.getCachedNativeRequest(),o=r&&this.platformAuthProvider&&!e?.hash;let s;this.eventHandler.emitEvent(y.HANDLE_REDIRECT_START,C.Redirect);let a;try{if(o&&this.platformAuthProvider){const c=r?.correlationId||"";s=this.performanceClient.startMeasurement(ln,c),this.logger.trace("12v7is",c);const h=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,w.handleRedirectPromise,this.performanceClient,this.platformAuthProvider,r.accountId,this.nativeInternalStorage,r.correlationId);a=u(h.handleRedirectPromise.bind(h),sd,this.logger,this.performanceClient,s.event.correlationId)(this.performanceClient,s.event.correlationId)}else{const[c,h]=this.browserStorage.getCachedRequest(""),l=c.correlationId;s=this.performanceClient.startMeasurement(ln,l),this.logger.trace("0znzs5",l);const d=this.createRedirectClient(l);a=u(d.handleRedirectPromise.bind(d),od,this.logger,this.performanceClient,s.event.correlationId)(c,h,s,e)}}catch(c){throw this.browserStorage.resetRequestCache(""),c}return a.then(c=>(c?(this.browserStorage.resetRequestCache(c.correlationId),this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_SUCCESS,C.Redirect,c),this.logger.verbose("0ui8f5",c.correlationId),n.length<this.getAllAccounts().length&&(this.eventHandler.emitEvent(y.LOGIN_SUCCESS,C.Redirect,c.account),this.logger.verbose("16im3l",c.correlationId)),s.end({success:!0},void 0,c.account)):s.event.errorCode?s.end({success:!1},void 0):s.discard(),this.eventHandler.emitEvent(y.HANDLE_REDIRECT_END,C.Redirect),c)).catch(c=>{this.browserStorage.resetRequestCache(s.event.correlationId);const h=c;throw this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Redirect,null,h),this.eventHandler.emitEvent(y.HANDLE_REDIRECT_END,C.Redirect),s.end({success:!1},h),c})}async acquireTokenRedirect(e){const t=this.getRequestCorrelationId(e);this.logger.verbose("0os66p",t);const n=this.performanceClient.startMeasurement(Ed,t);n.add({scenarioId:e.scenarioId});const r=this.config.auth.onRedirectNavigate;this.config.auth.onRedirectNavigate=o=>{const s=typeof r=="function"?r(o):void 0;return n.add({navigateCallbackResult:s!==!1}),n.event=n.end({success:!0},void 0,e.account)||n.event,s};try{Ci(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,ge.SIGNIN),this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_START,C.Redirect,e);let o;return this.platformAuthProvider&&this.canUsePlatformBroker(e)?o=new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,w.acquireTokenRedirect,this.performanceClient,this.platformAuthProvider,this.getNativeAccountId(e),this.nativeInternalStorage,t).acquireTokenRedirect(e,n).catch(a=>{if(a instanceof oe&&He(a))return this.platformAuthProvider=void 0,this.createRedirectClient(t).acquireToken(e);if(a instanceof ne)return this.logger.verbose("1ipyz4",t),this.createRedirectClient(t).acquireToken(e);throw a}):o=this.createRedirectClient(t).acquireToken(e),await o}catch(o){throw this.browserStorage.resetRequestCache(t),n.event.status===2?this.performanceClient.startMeasurement(ln,t).end({success:!1},o,e.account):n.end({success:!1},o,e.account),this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Redirect,null,o),o}}acquireTokenPopup(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(Ad,t);n.add({scenarioId:e.scenarioId});try{this.logger.verbose("0ch87b",t),wt(this.initialized,n,e.account),this.browserStorage.setInteractionInProgress(!0,ge.SIGNIN,e.overrideInteractionInProgress,t)}catch(a){return Promise.reject(a)}const r=this.getAllAccounts();this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_START,C.Popup,e);let o;const s=this.getPreGeneratedPkceCodes(t);return this.canUsePlatformBroker(e)?o=this.acquireTokenNative({...e,correlationId:t},w.acquireTokenPopup).then(a=>(n.end({success:!0,isNativeBroker:!0},void 0,a.account),a)).catch(a=>{if(a instanceof oe&&He(a))return this.platformAuthProvider=void 0,this.createPopupClient(t).acquireToken(e,s);if(a instanceof ne)return this.logger.verbose("0yy5fw",t),this.createPopupClient(t).acquireToken(e,s);throw a}):o=this.createPopupClient(t).acquireToken(e,s),o.then(a=>{const c=r.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_SUCCESS,C.Popup,a),c&&this.eventHandler.emitEvent(y.LOGIN_SUCCESS,C.Popup,a.account),n.end({success:!0,accessTokenSize:a.accessToken.length,idTokenSize:a.idToken.length},void 0,a.account),a}).catch(a=>(this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Popup,null,a),n.end({success:!1},a,e.account),Promise.reject(a))).finally(async()=>{this.browserStorage.setInteractionInProgress(!1),this.config.system.navigatePopups||await this.preGeneratePkceCodes(t)})}trackPageVisibilityWithMeasurement(){const e=this.ssoSilentMeasurement||this.acquireTokenByCodeAsyncMeasurement;e&&e.increment({visibilityChangeCount:1})}async ssoSilent(e){const t=this.getRequestCorrelationId(e),n={...e,prompt:e.prompt,correlationId:t};this.ssoSilentMeasurement=this.performanceClient.startMeasurement(Sd,t),this.ssoSilentMeasurement?.add({scenarioId:e.scenarioId}),wt(this.initialized,this.ssoSilentMeasurement,e.account),this.ssoSilentMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement);const r=this.getAllAccounts();this.logger.verbose("0w1b45",t),this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_START,C.Silent,n);let o;return this.canUsePlatformBroker(n)?o=this.acquireTokenNative(n,w.ssoSilent).catch(s=>{if(s instanceof oe&&He(s))return this.platformAuthProvider=void 0,this.createSilentIframeClient(n.correlationId).acquireToken(n);throw s}):o=this.createSilentIframeClient(n.correlationId).acquireToken(n),o.then(s=>{const a=r.length<this.getAllAccounts().length;return this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_SUCCESS,C.Silent,s),a&&this.eventHandler.emitEvent(y.LOGIN_SUCCESS,C.Silent,s.account),this.ssoSilentMeasurement?.end({success:!0,isNativeBroker:s.fromPlatformBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length},void 0,s.account),s}).catch(s=>{throw this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Silent,null,s),this.ssoSilentMeasurement?.end({success:!1},s,e.account),s}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenByCode(e){const t=this.getRequestCorrelationId(e);this.logger.trace("0ch6ga",t);const n=this.performanceClient.startMeasurement(wd,t);wt(this.initialized,n),this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_START,C.Silent,e),n.add({scenarioId:e.scenarioId});try{if(e.code&&e.nativeAccountId)throw m(al);if(e.code){const r=e.code;let o=this.hybridAuthCodeResponses.get(r);return o?(this.logger.verbose("0qgp28",t),n.discard()):(this.logger.verbose("06eh73",t),o=this.acquireTokenByCodeAsync({...e,correlationId:t}).then(s=>(this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_SUCCESS,C.Silent,s),this.hybridAuthCodeResponses.delete(r),n.end({success:!0,isNativeBroker:s.fromPlatformBroker,accessTokenSize:s.accessToken.length,idTokenSize:s.idToken.length},void 0,s.account),s)).catch(s=>{throw this.hybridAuthCodeResponses.delete(r),this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Silent,null,s),n.end({success:!1},s),s}),this.hybridAuthCodeResponses.set(r,o)),await o}else if(e.nativeAccountId)if(this.canUsePlatformBroker(e,e.nativeAccountId)){const r=await this.acquireTokenNative({...e,correlationId:t},w.acquireTokenByCode,e.nativeAccountId).catch(o=>{throw o instanceof oe&&He(o)&&(this.platformAuthProvider=void 0),o});return n.end({success:!0},void 0,r.account),r}else throw m(cl);else throw m(sl)}catch(r){throw this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Silent,null,r),n.end({success:!1},r),r}}async acquireTokenByCodeAsync(e){const t=this.getRequestCorrelationId(e);return this.logger.trace("10d9hy",t),this.acquireTokenByCodeAsyncMeasurement=this.performanceClient.startMeasurement(id,t),this.acquireTokenByCodeAsyncMeasurement?.increment({visibilityChangeCount:0}),document.addEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement),await this.createSilentAuthCodeClient(t).acquireToken(e).then(o=>(this.acquireTokenByCodeAsyncMeasurement?.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromPlatformBroker}),o)).catch(o=>{throw this.acquireTokenByCodeAsyncMeasurement?.end({success:!1},o),o}).finally(()=>{document.removeEventListener("visibilitychange",this.trackPageVisibilityWithMeasurement)})}async acquireTokenFromCache(e,t){switch(t){case x.Default:case x.AccessToken:case x.AccessTokenAndRefreshToken:const n=this.createSilentCacheClient(e.correlationId);return u(n.acquireToken.bind(n),Vl,this.logger,this.performanceClient,e.correlationId)(e);default:throw f(Ee)}}async acquireTokenByRefreshToken(e,t){switch(t){case x.Default:case x.AccessTokenAndRefreshToken:case x.RefreshToken:case x.RefreshTokenAndNetwork:const n=this.createSilentRefreshClient(e.correlationId);return u(n.acquireToken.bind(n),Wl,this.logger,this.performanceClient,e.correlationId)(e);default:throw f(Ee)}}async acquireTokenBySilentIframe(e){const t=this.createSilentIframeClient(e.correlationId);return u(t.acquireToken.bind(t),$l,this.logger,this.performanceClient,e.correlationId)(e)}async logoutRedirect(e){const t=this.getRequestCorrelationId(e);return Ci(this.initialized,this.config),this.browserStorage.setInteractionInProgress(!0,ge.SIGNOUT),this.createRedirectClient(t).logout(e)}logoutPopup(e){try{const t=this.getRequestCorrelationId(e);return mr(this.initialized),this.browserStorage.setInteractionInProgress(!0,ge.SIGNOUT),this.createPopupClient(t).logout(e).finally(()=>{this.browserStorage.setInteractionInProgress(!1)})}catch(t){return Promise.reject(t)}}async clearCache(e){if(!this.isBrowserEnvironment)return;const t=this.getRequestCorrelationId(e);return this.createSilentCacheClient(t).logout(e)}getAllAccounts(e){return xd(this.logger,this.browserStorage,this.isBrowserEnvironment,this.getRequestCorrelationId(),e)}getAccount(e){return Hd(e,this.logger,this.browserStorage,this.getRequestCorrelationId())}setActiveAccount(e){Kd(e,this.browserStorage,this.getRequestCorrelationId())}getActiveAccount(){return Fd(this.browserStorage,this.getRequestCorrelationId())}async hydrateCache(e,t){this.logger.verbose("16jycr",e.correlationId);const n=_c(e.account,e.cloudGraphHostName,e.msGraphHost);return await this.browserStorage.setAccount(n,e.correlationId,Se(e.idTokenClaims),w.hydrateCache),e.fromPlatformBroker?(this.logger.verbose("1fxyu8",e.correlationId),this.nativeInternalStorage.hydrateCache(e,t)):this.browserStorage.hydrateCache(e,t)}async acquireTokenNative(e,t,n,r){const o=this.getRequestCorrelationId(e);if(this.logger.trace("0b9y3p",o),!this.platformAuthProvider)throw m(Fo);return new vt(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,t,this.performanceClient,this.platformAuthProvider,n||this.getNativeAccountId(e),this.nativeInternalStorage,o).acquireToken(e,r)}canUsePlatformBroker(e,t){const n=this.getRequestCorrelationId(e);if(this.logger.trace("1n9lbl",n),!this.platformAuthProvider)return this.logger.trace("0vnu11",n),!1;if(!lt(this.config,this.logger,n,this.platformAuthProvider,e.authenticationScheme))return this.logger.trace("1m4bzf",n),!1;if(e.prompt)switch(e.prompt){case F.NONE:case F.CONSENT:case F.LOGIN:this.logger.trace("0vdv8e",n);break;default:return this.logger.trace("0pdzw6",n),!1}return!t&&!this.getNativeAccountId(e)?(this.logger.trace("16lbtk",n),!1):!0}getNativeAccountId(e){const t=e.account||this.getAccount({loginHint:e.loginHint,sid:e.sid})||this.getActiveAccount();return t&&t.nativeAccountId||""}createPopupClient(e){return new gu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createRedirectClient(e){return new pu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentIframeClient(e){return new Tu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,w.ssoSilent,this.performanceClient,this.nativeInternalStorage,e,this.platformAuthProvider)}createSilentCacheClient(e){return new rs(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentRefreshClient(e){return new wu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,this.performanceClient,e,this.platformAuthProvider)}createSilentAuthCodeClient(e){return new Eu(this.config,this.browserStorage,this.browserCrypto,this.logger,this.eventHandler,this.navigationClient,w.acquireTokenByCode,this.performanceClient,e,this.platformAuthProvider)}addEventCallback(e,t){return this.eventHandler.addEventCallback(e,t)}removeEventCallback(e){this.eventHandler.removeEventCallback(e)}addPerformanceCallback(e){return Wo(),this.performanceClient.addPerformanceCallback(e)}removePerformanceCallback(e){return this.performanceClient.removePerformanceCallback(e)}getLogger(){return this.logger}setLogger(e){this.logger=e}initializeWrapperLibrary(e,t){this.browserStorage.setWrapperMetadata(e,t)}setNavigationClient(e){this.navigationClient=e}getConfiguration(){return this.config}getPerformanceClient(){return this.performanceClient}isBrowserEnv(){return this.isBrowserEnvironment}getRequestCorrelationId(e){return e?.correlationId?e.correlationId:this.isBrowserEnvironment?Re():""}async loginRedirect(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0lz9hf",t),this.acquireTokenRedirect({correlationId:t,...e||li})}loginPopup(e){const t=this.getRequestCorrelationId(e);return this.logger.verbose("0qw7v5",t),this.acquireTokenPopup({correlationId:t,...e||li})}async acquireTokenSilent(e){const t=this.getRequestCorrelationId(e),n=this.performanceClient.startMeasurement(Td,t);n.add({cacheLookupPolicy:e.cacheLookupPolicy,scenarioId:e.scenarioId}),wt(this.initialized,n,e.account),this.logger.verbose("0x1c4s",t);const r=e.account||this.getActiveAccount();if(!r)throw m(el);return this.acquireTokenSilentDeduped(e,r,t).then(o=>(n.end({success:!0,fromCache:o.fromCache,isNativeBroker:o.fromPlatformBroker,accessTokenSize:o.accessToken.length,idTokenSize:o.idToken.length},void 0,o.account),{...o,state:e.state,correlationId:t})).catch(o=>{throw o instanceof _&&o.setCorrelationId(t),n.end({success:!1},o,r),o})}async acquireTokenSilentDeduped(e,t,n){const r=Jt(this.config.auth.clientId,{...e,authority:e.authority||this.config.auth.authority},t.homeAccountId),o=JSON.stringify(r),s=this.activeSilentTokenRequests.get(o);if(typeof s>"u"){this.logger.verbose("0fcjbk",n),this.performanceClient.addFields({deduped:!1},n);const a=u(this.acquireTokenSilentAsync.bind(this),zl,this.logger,this.performanceClient,n)({...e,correlationId:n},t);return this.activeSilentTokenRequests.set(o,a),a.finally(()=>{this.activeSilentTokenRequests.delete(o)})}else return this.logger.verbose("1yq7nb",n),this.performanceClient.addFields({deduped:!0},n),s}async acquireTokenSilentAsync(e,t){const n=()=>this.trackPageVisibility(e.correlationId);this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_START,C.Silent,e),e.correlationId&&this.performanceClient.incrementFields({visibilityChangeCount:0},e.correlationId),document.addEventListener("visibilitychange",n);const r=await u(jd,Yl,this.logger,this.performanceClient,e.correlationId)(e,t,this.config,this.performanceClient,this.logger),o=e.cacheLookupPolicy||x.Default;return this.acquireTokenSilentNoIframe(r,o).catch(async a=>{if(_u(a,o))if(this.activeIframeRequest)if(o!==x.Skip){const[h,l]=this.activeIframeRequest;this.logger.verbose("1w8fso",r.correlationId);const d=this.performanceClient.startMeasurement(Jl,r.correlationId);d.add({awaitIframeCorrelationId:l});const g=await h;if(d.end({success:g}),g)return this.logger.verbose("0ywzzi",r.correlationId),this.acquireTokenSilentNoIframe(r,o);throw this.logger.info("17y14q",r.correlationId),a}else return this.logger.warning("1bd4p8",r.correlationId),u(this.acquireTokenBySilentIframe.bind(this),yi,this.logger,this.performanceClient,r.correlationId)(r);else{let h;return this.activeIframeRequest=[new Promise(l=>{h=l}),r.correlationId],this.logger.verbose("0rh08z",r.correlationId),u(this.acquireTokenBySilentIframe.bind(this),yi,this.logger,this.performanceClient,r.correlationId)(r).then(l=>(h(!0),l)).catch(l=>{throw h(!1),l}).finally(()=>{this.activeIframeRequest=void 0})}else throw a}).then(a=>(this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_SUCCESS,C.Silent,a),e.correlationId&&this.performanceClient.addFields({fromCache:a.fromCache,isNativeBroker:a.fromPlatformBroker},e.correlationId),a)).catch(a=>{throw this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_FAILURE,C.Silent,null,a),a}).finally(()=>{document.removeEventListener("visibilitychange",n)})}async acquireTokenSilentNoIframe(e,t){return lt(this.config,this.logger,e.correlationId,this.platformAuthProvider,e.authenticationScheme)&&e.account.nativeAccountId?(this.logger.verbose("0sczo4",e.correlationId),this.acquireTokenNative(e,w.acquireTokenSilent_silentFlow,e.account.nativeAccountId,t).catch(async n=>{throw n instanceof oe&&He(n)?(this.logger.verbose("07rkmb",e.correlationId),this.platformAuthProvider=void 0,f(Ee)):n})):(this.logger.verbose("0ox81t",e.correlationId),t===x.AccessToken&&this.logger.verbose("0fvwxe",e.correlationId),u(this.acquireTokenFromCache.bind(this),Fl,this.logger,this.performanceClient,e.correlationId)(e,t).catch(n=>{if(t===x.AccessToken)throw n;return this.eventHandler.emitEvent(y.ACQUIRE_TOKEN_NETWORK_START,C.Silent,e),u(this.acquireTokenByRefreshToken.bind(this),Bl,this.logger,this.performanceClient,e.correlationId)(e,t)}))}async preGeneratePkceCodes(e){return this.logger.verbose("1x6uj6",e),this.pkceCode=await u(Ne,Oe,this.logger,this.performanceClient,e)(this.performanceClient,this.logger,e),Promise.resolve()}getPreGeneratedPkceCodes(e){const t=this.pkceCode?{...this.pkceCode}:void 0;return this.pkceCode=void 0,t?this.logger.verbose("12js1o",e):this.logger.verbose("1oe9ci",e),this.performanceClient.addFields({usePreGeneratedPkce:!!t},e),t}logMultipleInstances(e,t){const n=this.config.auth.clientId;if(!window)return;window.msal=window.msal||{},window.msal.clientIds=window.msal.clientIds||[],window.msal.clientIds.length>0&&this.logger.verbose("1qtz3l",t),window.msal.clientIds.push(n),Su(n,e,this.logger,t)}}function _u(i,e){const t=!(i instanceof ne&&i.subError!==Zn),n=i.errorCode===$.INVALID_GRANT_ERROR||i.errorCode===Ee,r=t&&n||i.errorCode===Tn||i.errorCode===yo,o=Bh.includes(e);return r&&o}class Pr{static loggerCallback(e,t){switch(e){case k.Error:console.error(t);return;case k.Info:console.info(t);return;case k.Verbose:console.debug(t);return;case k.Warning:console.warn(t);return;default:console.log(t);return}}constructor(e){this.browserEnvironment=typeof window<"u",this.config=lu(e,this.browserEnvironment);let t;try{t=window[Q.SessionStorage]}catch{}const n=t?.getItem(kd),r=t?.getItem(bd)?.toLowerCase(),o=r==="true"?!0:r==="false"?!1:void 0,s={...this.config.system.loggerOptions},a=n&&Object.keys(k).includes(n)?k[n]:void 0;a&&(s.loggerCallback=Pr.loggerCallback,s.logLevel=a),o!==void 0&&(s.piiLoggingEnabled=o),this.logger=new te(s,Dd,Pe),this.available=!1}getConfig(){return this.config}getLogger(){return this.logger}isAvailable(){return this.available}isBrowserEnvironment(){return this.browserEnvironment}}class We extends Pr{getModuleName(){return We.MODULE_NAME}getId(){return We.ID}async initialize(e){return this.available=typeof window<"u",this.available}}We.MODULE_NAME="";We.ID="StandardOperatingContext";class Ou{constructor(e,t){this.controller=t||new Or(new We(e))}async initialize(e){return this.controller.initialize(e)}async acquireTokenPopup(e){return this.controller.acquireTokenPopup(e)}acquireTokenRedirect(e){return this.controller.acquireTokenRedirect(e)}acquireTokenSilent(e){return this.controller.acquireTokenSilent(e)}acquireTokenByCode(e){return this.controller.acquireTokenByCode(e)}addEventCallback(e,t){return this.controller.addEventCallback(e,t)}removeEventCallback(e){return this.controller.removeEventCallback(e)}addPerformanceCallback(e){return this.controller.addPerformanceCallback(e)}removePerformanceCallback(e){return this.controller.removePerformanceCallback(e)}getAccount(e){return this.controller.getAccount(e)}getAllAccounts(e){return this.controller.getAllAccounts(e)}handleRedirectPromise(e){return this.controller.handleRedirectPromise(e)}loginPopup(e){return this.controller.loginPopup(e)}loginRedirect(e){return this.controller.loginRedirect(e)}logoutRedirect(e){return this.controller.logoutRedirect(e)}logoutPopup(e){return this.controller.logoutPopup(e)}ssoSilent(e){return this.controller.ssoSilent(e)}getLogger(){return this.controller.getLogger()}setLogger(e){this.controller.setLogger(e)}setActiveAccount(e){this.controller.setActiveAccount(e)}getActiveAccount(){return this.controller.getActiveAccount()}initializeWrapperLibrary(e,t){return this.controller.initializeWrapperLibrary(e,t)}setNavigationClient(e){this.controller.setNavigationClient(e)}getConfiguration(){return this.controller.getConfiguration()}async hydrateCache(e,t){return this.controller.hydrateCache(e,t)}clearCache(e){return this.controller.clearCache(e)}}const vu={initialize:()=>Promise.reject(P(L)),acquireTokenPopup:()=>Promise.reject(P(L)),acquireTokenRedirect:()=>Promise.reject(P(L)),acquireTokenSilent:()=>Promise.reject(P(L)),acquireTokenByCode:()=>Promise.reject(P(L)),getAllAccounts:()=>[],getAccount:()=>null,handleRedirectPromise:()=>Promise.reject(P(L)),loginPopup:()=>Promise.reject(P(L)),loginRedirect:()=>Promise.reject(P(L)),logoutRedirect:()=>Promise.reject(P(L)),logoutPopup:()=>Promise.reject(P(L)),ssoSilent:()=>Promise.reject(P(L)),addEventCallback:()=>null,removeEventCallback:()=>{},addPerformanceCallback:()=>"",removePerformanceCallback:()=>!1,getLogger:()=>{throw P(L)},setLogger:()=>{},setActiveAccount:()=>{},getActiveAccount:()=>null,initializeWrapperLibrary:()=>{},setNavigationClient:()=>{},getConfiguration:()=>{throw P(L)},hydrateCache:()=>Promise.reject(P(L)),clearCache:()=>Promise.reject(P(L))};const ku={instance:vu,inProgress:Hh.None,accounts:[],logger:new te({})},bu=as.createContext(ku);bu.Consumer;export{Ou as P};
